(self.webpackChunk=self.webpackChunk||[]).push([[7362],{67362:function(e,t,l){"use strict";l.r(t);var n=l(25359),a=l.n(n),r=l(57213),o=l.n(r),s=l(49811),i=l.n(s),c=l(54306),u=l.n(c),d=l(88265),p=l(63313),h=l(28756),Z=l(67393),x=l(9835),m=l(22159),g=l(55484),P=l(84163),f=l(84468),v=l(16861),b=l(57229),j=l(15207),C=l(11186),w=l.n(C),y=l(46207),k=l.n(y),I=l(11527),S=h.Z.Option,F=/([^\/\:]+\/[^\/]+)(?=\.git)/,R=/([^\/\:]+\/[^\/\.]+)\.[a-z]+$/;t.default=function(e){var t=e.subscription,l=e.handleCancel,n=e.visible,r=Z.Z.useForm(),s=u()(r,1)[0],c=(0,p.useState)(!1),C=u()(c,2),y=C[0],T=C[1],_=(0,p.useState)("public-repo"),E=u()(_,2),O=E[0],V=E[1],A=(0,p.useState)("crontab"),N=u()(A,2),q=N[0],D=N[1],z=(0,p.useState)("ssh-key"),K=u()(z,2),B=K[0],G=K[1],H=function(){var e=i()(a()().mark((function e(n){var r,s,i,c,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(!0),r=t?"put":"post",s=o()(o()({},n),{},{autoAddCron:Boolean(n.autoAddCron),autoDelCron:Boolean(n.autoDelCron)}),t&&(s.id=t.id),e.prev=4,e.next=7,b.W[r]("".concat(j.Z.apiPrefix,"subscriptions"),s);case 7:i=e.sent,c=i.code,u=i.data,200===c&&(x.ZP.success(t?d.ZP.get("更新订阅成功"):d.ZP.get("创建订阅成功")),l(u)),T(!1),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),T(!1);case 17:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}(),L=function(e,t){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O,n="",a="file"===l?R:F;return a.test(e)&&(n=e.match(a)[1].replaceAll("/","_").replaceAll(".","_")),t&&(n=n+"_"+t),n},W=function(e){var t=e.value,l=e.onChange,n=(0,p.useState)("days"),a=u()(n,2),r=a[0],o=a[1],s=(0,p.useState)(),i=u()(s,2),c=i[0],Z=i[1];return(0,p.useEffect)((function(){t&&(o(t.type),Z(t.value))}),[t]),(0,I.jsxs)(m.Z.Group,{compact:!0,children:[(0,I.jsx)(g.Z,{addonBefore:d.ZP.get("每"),precision:0,min:1,value:c,style:{width:"calc(100% - 58px)"},onChange:function(e){Z(e||1),e?null==l||l({type:r,value:e}):null==l||l(null)}}),(0,I.jsxs)(h.Z,{value:r,onChange:function(e){o(e),c&&c>0&&(null==l||l({type:e,value:c}))},children:[(0,I.jsx)(S,{value:"days",children:d.ZP.get("天")}),(0,I.jsx)(S,{value:"hours",children:d.ZP.get("时")}),(0,I.jsx)(S,{value:"minutes",children:d.ZP.get("分")}),(0,I.jsx)(S,{value:"seconds",children:d.ZP.get("秒")})]})]})},$=function(e){e.value,e.onChange;return"ssh-key"===e.type?(0,I.jsx)(Z.Z.Item,{name:["pull_option","private_key"],label:d.ZP.get("私钥"),rules:[{required:!0}],children:(0,I.jsx)(m.Z.TextArea,{rows:4,autoSize:{minRows:1,maxRows:6},placeholder:d.ZP.get("请输入私钥")})}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Z.Z.Item,{name:["pull_option","username"],label:d.ZP.get("用户名"),rules:[{required:!0}],children:(0,I.jsx)(m.Z,{placeholder:d.ZP.get("请输入认证用户名")})}),(0,I.jsx)(Z.Z.Item,{name:["pull_option","password"],tooltip:d.ZP.get("Github已不支持密码认证，请使用Token方式"),label:d.ZP.get("密码/Token"),rules:[{required:!0}],children:(0,I.jsx)(m.Z,{placeholder:d.ZP.get("请输入密码或者Token")})})]})},J=(0,p.useCallback)((function(e){var t=e.clipboardData.getData("text");if(t.startsWith("ql ")){var l=t.split(" ").map((function(e){return e.trim().replace(/\"/g,"").replace(/\'/,"")})),n=u()(l,8),a=n[1],r=n[2],o=n[3],i=n[4],c=n[5],d=n[6],p=n[7],h="raw"===a?"file":r.startsWith("http")?"public-repo":"private-repo";s.setFieldsValue({type:h,url:r,whitelist:o,blacklist:i,dependences:c,branch:d,extensions:p,alias:L(r,d,h)}),V(h)}}),[]),M=(0,p.useCallback)((function(e){var t=e.clipboardData.getData("text");(t.includes("ql repo")||t.includes("ql raw"))&&e.preventDefault()}),[]);return(0,p.useEffect)((function(){n?window.addEventListener("paste",J):window.removeEventListener("paste",J)}),[n]),(0,p.useEffect)((function(){var e;s.setFieldsValue(o()(o()({},t),(e=t,o()(o()({},e),{},{autoAddCron:!!k()(null==e?void 0:e.autoAddCron)||Boolean(null==e?void 0:e.autoAddCron),autoDelCron:!!k()(null==e?void 0:e.autoDelCron)||Boolean(null==e?void 0:e.autoDelCron)})))||{}),V(t&&t.type||"public-repo"),D(t&&t.schedule_type||"crontab"),G(t&&t.pull_type||"ssh-key"),t||s.resetFields()}),[t,n]),(0,I.jsx)(P.Z,{title:t?d.ZP.get("编辑订阅"):d.ZP.get("创建订阅"),open:n,forceRender:!0,centered:!0,maskClosable:!1,onOk:function(){s.validateFields().then((function(e){H(e)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){return l()},confirmLoading:y,children:(0,I.jsxs)(Z.Z,{form:s,name:"form_in_modal",layout:"vertical",children:[(0,I.jsx)(Z.Z.Item,{name:"name",label:d.ZP.get("名称"),rules:[{required:!0}],children:(0,I.jsx)(m.Z,{placeholder:d.ZP.get("支持拷贝 ql repo/raw 命令，粘贴导入"),onPaste:M})}),(0,I.jsx)(Z.Z.Item,{name:"type",label:d.ZP.get("类型"),rules:[{required:!0}],initialValue:"public-repo",children:(0,I.jsxs)(f.ZP.Group,{onChange:function(e){V(e.target.value);var t=s.getFieldValue("url"),l=s.getFieldValue("branch");s.setFieldsValue({alias:L(t,l,e.target.value)}),t&&s.validateFields(["url"])},children:[(0,I.jsx)(f.ZP,{value:"public-repo",children:d.ZP.get("公开仓库")}),(0,I.jsx)(f.ZP,{value:"private-repo",children:d.ZP.get("私有仓库")}),(0,I.jsx)(f.ZP,{value:"file",children:d.ZP.get("单文件")})]})}),(0,I.jsx)(Z.Z.Item,{name:"url",label:d.ZP.get("链接"),rules:[{required:!0},{pattern:"file"===O?R:F}],children:(0,I.jsx)(m.Z.TextArea,{autoSize:{minRows:1,maxRows:5},placeholder:d.ZP.get("请输入订阅链接"),onPaste:M,onChange:function(e){var t=s.getFieldValue("branch");s.setFieldsValue({alias:L(e.target.value,t)})}})}),"file"!==O&&(0,I.jsx)(Z.Z.Item,{name:"branch",label:d.ZP.get("分支"),children:(0,I.jsx)(m.Z,{placeholder:d.ZP.get("请输入分支"),onPaste:M,onChange:function(e){var t=s.getFieldValue("url");s.setFieldsValue({alias:L(t,e.target.value)})}})}),(0,I.jsx)(Z.Z.Item,{name:"alias",label:d.ZP.get("唯一值"),rules:[{required:!0,message:""}],tooltip:d.ZP.get("唯一值用于日志目录和私钥别名"),children:(0,I.jsx)(m.Z,{placeholder:d.ZP.get("自动生成"),disabled:!0})}),"private-repo"===O&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Z.Z.Item,{name:"pull_type",label:d.ZP.get("拉取方式"),initialValue:"ssh-key",rules:[{required:!0}],children:(0,I.jsxs)(f.ZP.Group,{onChange:function(e){G(e.target.value)},children:[(0,I.jsx)(f.ZP,{value:"ssh-key",children:d.ZP.get("私钥")}),(0,I.jsx)(f.ZP,{value:"user-pwd",children:d.ZP.get("用户名密码/Token")})]})}),(0,I.jsx)($,{type:B})]}),(0,I.jsx)(Z.Z.Item,{name:"schedule_type",label:d.ZP.get("定时类型"),initialValue:"crontab",rules:[{required:!0}],children:(0,I.jsxs)(f.ZP.Group,{onChange:function(e){D(e.target.value),s.setFieldsValue({schedule:""})},children:[(0,I.jsx)(f.ZP,{value:"crontab",children:"crontab"}),(0,I.jsx)(f.ZP,{value:"interval",children:"interval"})]})}),(0,I.jsx)(Z.Z.Item,{name:"crontab"===q?"schedule":"interval_schedule",label:d.ZP.get("定时规则"),rules:[{required:!0},{validator:function(e,t){return"interval"===q||!t||w().parseExpression(t).hasNext()?Promise.resolve():Promise.reject(d.ZP.get("Subscription表达式格式有误"))}}],children:"interval"===q?(0,I.jsx)(W,{}):(0,I.jsx)(m.Z,{onPaste:M,placeholder:d.ZP.get("秒(可选) 分 时 天 月 周")})}),"file"!==O&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Z.Z.Item,{name:"whitelist",label:d.ZP.get("白名单"),tooltip:d.ZP.get("多个关键词竖线分割，支持正则表达式"),children:(0,I.jsx)(m.Z.TextArea,{rows:4,autoSize:{minRows:1,maxRows:5},placeholder:d.ZP.get("请输入脚本筛选白名单关键词，多个关键词竖线分割"),onPaste:M})}),(0,I.jsx)(Z.Z.Item,{name:"blacklist",label:d.ZP.get("黑名单"),tooltip:d.ZP.get("多个关键词竖线分割，支持正则表达式"),children:(0,I.jsx)(m.Z.TextArea,{rows:4,autoSize:{minRows:1,maxRows:5},placeholder:d.ZP.get("请输入脚本筛选黑名单关键词，多个关键词竖线分割"),onPaste:M})}),(0,I.jsx)(Z.Z.Item,{name:"dependences",label:d.ZP.get("依赖文件"),tooltip:d.ZP.get("多个关键词竖线分割，支持正则表达式"),children:(0,I.jsx)(m.Z.TextArea,{rows:4,autoSize:{minRows:1,maxRows:5},placeholder:d.ZP.get("请输入脚本依赖文件关键词，多个关键词竖线分割"),onPaste:M})}),(0,I.jsx)(Z.Z.Item,{name:"extensions",label:d.ZP.get("文件后缀"),tooltip:d.ZP.get("仓库需要拉取的文件后缀，多个后缀空格分隔，默认使用配置文件中的RepoFileExtensions"),children:(0,I.jsx)(m.Z,{onPaste:M,placeholder:d.ZP.get("请输入文件后缀")})}),(0,I.jsx)(Z.Z.Item,{name:"sub_before",label:d.ZP.get("执行前"),tooltip:d.ZP.get("运行订阅前执行的命令，比如 cp/mv/python3 xxx.py/node xxx.js"),children:(0,I.jsx)(m.Z.TextArea,{onPaste:M,rows:4,autoSize:{minRows:1,maxRows:5},placeholder:d.ZP.get("请输入运行订阅前要执行的命令")})}),(0,I.jsx)(Z.Z.Item,{name:"sub_after",label:d.ZP.get("执行后"),tooltip:d.ZP.get("运行订阅后执行的命令，比如 cp/mv/python3 xxx.py/node xxx.js"),children:(0,I.jsx)(m.Z.TextArea,{onPaste:M,rows:4,autoSize:{minRows:1,maxRows:5},placeholder:d.ZP.get("请输入运行订阅后要执行的命令")})})]}),(0,I.jsx)(Z.Z.Item,{name:"proxy",label:d.ZP.get("代理"),tooltip:d.ZP.get("公开仓库支持HTTP/SOCK5代理，私有仓库支持SOCK5代理"),children:(0,I.jsx)(m.Z,{onPaste:M,placeholder:"private-repo"===O?"SOCK5代理，例如 IP:PORT":"HTTP/SOCK5代理，例如 http://127.0.0.1:1080"})}),(0,I.jsxs)(Z.Z.Item,{style:{marginBottom:0},className:"inline-form-item",children:[(0,I.jsx)(Z.Z.Item,{name:"autoAddCron",label:d.ZP.get("自动添加任务"),valuePropName:"checked",initialValue:!0,children:(0,I.jsx)(v.Z,{})}),(0,I.jsx)(Z.Z.Item,{name:"autoDelCron",label:d.ZP.get("自动删除任务"),valuePropName:"checked",initialValue:!0,children:(0,I.jsx)(v.Z,{})})]})]})})}},16861:function(e,t,l){"use strict";l.d(t,{Z:function(){return b}});var n=l(88028),a=l(22481),r=l(24090),o=l(84875),s=l.n(o),i=l(41171),c=l(4155),u=l(63313),d=l(16376),p=l(32602),h=u.forwardRef((function(e,t){var l,n=e.prefixCls,r=void 0===n?"rc-switch":n,o=e.className,h=e.checked,Z=e.defaultChecked,x=e.disabled,m=e.loadingIcon,g=e.checkedChildren,P=e.unCheckedChildren,f=e.onClick,v=e.onChange,b=e.onKeyDown,j=(0,c.Z)(e,["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"]),C=(0,d.Z)(!1,{value:h,defaultValue:Z}),w=(0,i.Z)(C,2),y=w[0],k=w[1];function I(e,t){var l=y;return x||(k(l=e),null==v||v(l,t)),l}var S=s()(r,o,(l={},(0,a.Z)(l,"".concat(r,"-checked"),y),(0,a.Z)(l,"".concat(r,"-disabled"),x),l));return u.createElement("button",Object.assign({},j,{type:"button",role:"switch","aria-checked":y,disabled:x,className:S,ref:t,onKeyDown:function(e){e.which===p.Z.LEFT?I(!1,e):e.which===p.Z.RIGHT&&I(!0,e),null==b||b(e)},onClick:function(e){var t=I(!y,e);null==f||f(t,e)}}),m,u.createElement("span",{className:"".concat(r,"-inner")},y?g:P))}));h.displayName="Switch";var Z=h,x=l(82259),m=l(7893),g=l(65189),P=l(1570),f=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(l[n[a]]=e[n[a]])}return l},v=u.forwardRef((function(e,t){var l,o=e.prefixCls,i=e.size,c=e.disabled,d=e.loading,p=e.className,h=void 0===p?"":p,v=f(e,["prefixCls","size","disabled","loading","className"]),b=u.useContext(x.E_),j=b.getPrefixCls,C=b.direction,w=u.useContext(g.Z),y=u.useContext(m.Z),k=(null!=c?c:y)||d,I=j("switch",o),S=u.createElement("div",{className:"".concat(I,"-handle")},d&&u.createElement(r.Z,{className:"".concat(I,"-loading-icon")})),F=s()((l={},(0,a.Z)(l,"".concat(I,"-small"),"small"===(i||w)),(0,a.Z)(l,"".concat(I,"-loading"),d),(0,a.Z)(l,"".concat(I,"-rtl"),"rtl"===C),l),h);return u.createElement(P.Z,{insertExtraNode:!0},u.createElement(Z,(0,n.Z)({},v,{prefixCls:I,className:F,disabled:k,ref:t,loadingIcon:S})))}));v.__ANT_SWITCH=!0;var b=v},46207:function(e){e.exports=function(e){return null==e}}}]);