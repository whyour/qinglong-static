(self.webpackChunk=self.webpackChunk||[]).push([[6534,9064,8673,440,833],{38582:function(e,t,n){"use strict";var r=(0,n(55258).Z)({scriptUrl:["//at.alicdn.com/t/c/font_3354854_ob5y15ewlyq.js"]});t.Z=r},51805:function(e,t,n){"use strict";var r=n(57213),a=n.n(r),i=n(63313);t.Z=function(e,t,n){var r=n.treeNodeFilterProp;return(0,i.useMemo)((function(){var n=[];if(!t)return{treeData:e,keys:n};var i=t.toUpperCase();function o(e,t){var n=t[r];return String(n).toUpperCase().includes(i)}return{treeData:function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.map((function(t){var i=t.children,s=r||o(0,t),l=e(i||[],s);return s||l.length?(l.length&&n.push(t.key),a()(a()({},t),{},{children:l})):null})).filter((function(e){return e}))}(e),keys:n}}),[e,t,r])}},98912:function(e,t,n){"use strict";n.r(t);var r=n(57213),a=n.n(r),i=n(54306),o=n.n(i),s=n(88265),l=n(63313),c=n(28756),u=n(60858),d=n(75310),p=n(24378),g=n(57229),h=n(15207),f=n(36035),m=n(82755),v=n(68793),Z=n(12417),P=n(3094),b=n(40141),y=n(21758),k=n(99120),x=n.n(k),w=n(11527),j=c.Z.Option;t.default=function(e){var t=e.treeData,n=e.currentNode,r=e.content,i=e.handleCancel,k=e.visible,S=(0,l.useState)(""),C=o()(S,2),q=C[0],_=C[1],E=(0,l.useState)("javascript"),I=o()(E,2),B=I[0],R=I[1],N=(0,l.useState)(),F=o()(N,2),T=F[0],M=F[1],A=(0,l.useState)(""),H=o()(A,2),D=H[0],V=H[1],O=(0,l.useState)(!1),W=o()(O,2),U=W[0],L=W[1],K=(0,l.useState)(!1),Q=o()(K,2),z=Q[0],X=Q[1],Y=(0,l.useState)(""),G=o()(Y,2),$=G[0],J=G[1],ee=(0,P.F)().theme,te=(0,l.useRef)(null),ne=(0,l.useState)(!1),re=o()(ne,2),ae=re[0],ie=re[1],oe=(0,l.useState)(null),se=o()(oe,2),le=se[0],ce=se[1],ue=function(e){g.W.get("".concat(h.Z.apiPrefix,"scripts/").concat(e.title,"?path=").concat(e.parent||"")).then((function(e){var t=e.code,n=e.data;200===t&&_(n)}))},de=function(){T&&T.title&&le&&g.W.put("".concat(h.Z.apiPrefix,"scripts/stop"),{filename:T.title,path:T.parent||"",pid:le}).then((function(e){var t=e.code;e.data;200===t&&ie(!1)}))},pe=(0,l.useCallback)((function(e){var t=e.message;(0,b.x$)(t)&&setTimeout((function(){ie(!1)}),300),J((function(e){return"".concat(e).concat(t)}))}),[]);return(0,l.useEffect)((function(){var e=y.Z.getInstance();return e.subscribe("manuallyRunScript",pe),function(){e.unsubscribe("manuallyRunScript",pe)}}),[]),(0,l.useEffect)((function(){if(J(""),n){M(n),_(r),V(n.key);var e=(0,b.H$)(n.title);R(e)}}),[r,n]),(0,w.jsxs)(u.Z,{className:"edit-modal",closable:!1,title:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(d.Z,{treeExpandAction:"click",style:{marginRight:8,width:150},value:D,dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:t,placeholder:s.ZP.get("请选择脚本文件"),fieldNames:{value:"key",label:"title"},showSearch:!0,onSelect:function(e,t){if(t.key!==D&&e&&"directory"!==t.type){var n=(0,b.H$)(e);M(t),R(n),ue(t),V(t.key)}}}),(0,w.jsxs)(c.Z,{value:B,style:{width:110,marginRight:8},onChange:function(e){R(e)},children:[(0,w.jsx)(j,{value:"javascript",children:"javascript"}),(0,w.jsx)(j,{value:"typescript",children:"typescript"}),(0,w.jsx)(j,{value:"shell",children:"shell"}),(0,w.jsx)(j,{value:"python",children:"python"})]}),(0,w.jsx)(p.Z,{type:"primary",style:{marginRight:8},onClick:ae?de:function(){J("");var e=te.current.getValue().replace(/\r\n/g,"\n");g.W.put("".concat(h.Z.apiPrefix,"scripts/run"),{filename:T.title,path:T.parent||"",content:e}).then((function(e){var t=e.code,n=e.data;200===t&&(ie(!0),ce(n))}))},children:ae?s.ZP.get("停止"):s.ZP.get("运行")}),(0,w.jsx)(p.Z,{type:"primary",style:{marginRight:8},onClick:function(){J("")},children:s.ZP.get("清空日志")}),(0,w.jsx)(p.Z,{type:"primary",style:{marginRight:8},onClick:function(){L(!0)},children:s.ZP.get("保存")}),(0,w.jsx)(p.Z,{type:"primary",style:{marginRight:8},onClick:function(){de(),i()},children:s.ZP.get("退出")})]}),width:"100%",headerStyle:{padding:"11px 24px"},onClose:function(){i()},open:k,children:[(0,w.jsxs)(f.Z,{split:"vertical",minSize:200,defaultSize:"50%",style:{height:"calc(100vh - 55px)"},pane2Style:{overflowY:"auto"},children:[(0,w.jsx)(m.ZP,{language:B,value:q,theme:ee,options:{fontSize:12,minimap:{enabled:!1},lineNumbersMinChars:3,glyphMargin:!1},onMount:function(e){te.current=e}}),(0,w.jsx)("pre",{style:{padding:"0 15px"},children:(0,w.jsx)(x(),{children:$})})]}),(0,w.jsx)(v.default,{visible:U,handleCancel:function(){L(!1)},file:a()({content:te.current&&te.current.getValue().replace(/\r\n/g,"\n")},T)}),(0,w.jsx)(Z.default,{visible:z,handleCancel:function(){X(!1)}})]})}},85472:function(e,t,n){"use strict";n.r(t);var r=n(57213),a=n.n(r),i=n(54689),o=n.n(i),s=n(25359),l=n.n(s),c=n(49811),u=n.n(c),d=n(54306),p=n.n(d),g=n(88265),h=n(63313),f=n(28756),m=n(67393),v=n(9835),Z=n(84163),P=n(84468),b=n(22159),y=n(75310),k=n(57679),x=n(57229),w=n(15207),j=n(59953),S=n(11527);f.Z.Option;t.default=function(e){var t=e.handleCancel,n=e.treeData,r=e.visible,i=m.Z.useForm(),s=p()(i,1)[0],c=(0,h.useState)(!1),d=p()(c,2),f=d[0],C=d[1],q=(0,h.useState)([]),_=p()(q,2),E=_[0],I=_[1],B=(0,h.useState)(),R=p()(B,2),N=R[0],F=R[1],T=(0,h.useState)("blank"),M=p()(T,2),A=M[0],H=M[1],D=function(){var e=u()(l()().mark((function e(n){var r,a,i,o,s,c;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C(!0),r=n.path,a=void 0===r?"":r,i=n.filename,o=n.directory,s=void 0===o?"":o,(c=new FormData).append("file",N),c.append("filename",i),c.append("path",a),c.append("content",""),c.append("directory",s),x.W.post("".concat(w.Z.apiPrefix,"scripts"),c).then((function(e){var n=e.code;e.data;if(200===n){v.ZP.success(s?g.ZP.get("创建文件夹成功"):g.ZP.get("创建文件成功"));var r=a?"".concat(a,"/"):"",o=N?N.name:i;t({filename:o,path:a,key:"".concat(r).concat(o)})}C(!1)})).finally((function(){return C(!1)}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function e(t){var n,r=o()(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.children&&i.children.length>0&&(i.children=i.children.filter((function(e){return"directory"===e.type})).map((function(e){return a()(a()({},e),{},{disabled:!1})})),e(i.children))}}catch(e){r.e(e)}finally{r.f()}return t};return(0,h.useEffect)((function(){var e=n.filter((function(e){return"directory"===e.type})).map((function(e){return a()(a()({},e),{},{disabled:!1})})),t=V(e);I(t)}),[n]),(0,h.useEffect)((function(){s.resetFields()}),[r]),(0,S.jsx)(Z.Z,{title:g.ZP.get("创建"),open:r,forceRender:!0,centered:!0,maskClosable:!1,onOk:function(){s.validateFields().then((function(e){D(e)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){return t()},confirmLoading:f,children:(0,S.jsxs)(m.Z,{form:s,layout:"vertical",name:"edit_name_modal",children:[(0,S.jsx)(m.Z.Item,{name:"type",label:g.ZP.get("类型"),rules:[{required:!0}],initialValue:"blank",children:(0,S.jsxs)(P.ZP.Group,{onChange:function(e){H(e.target.value)},children:[(0,S.jsx)(P.ZP,{value:"blank",children:g.ZP.get("空文件")}),(0,S.jsx)(P.ZP,{value:"upload",children:g.ZP.get("本地文件")}),(0,S.jsx)(P.ZP,{value:"directory",children:g.ZP.get("文件夹")})]})}),"blank"===A&&(0,S.jsx)(m.Z.Item,{name:"filename",label:g.ZP.get("文件名"),rules:[{required:!0,message:g.ZP.get("请输入文件名")},{validator:function(e,t){return t.includes("/")?Promise.reject(new Error(g.ZP.get("文件名不能包含斜杠"))):Promise.resolve()}}],children:(0,S.jsx)(b.Z,{placeholder:g.ZP.get("请输入文件名")})}),"directory"===A&&(0,S.jsx)(m.Z.Item,{name:"directory",label:g.ZP.get("文件夹名"),rules:[{required:!0,message:g.ZP.get("请输入文件夹名")}],children:(0,S.jsx)(b.Z,{placeholder:g.ZP.get("请输入文件夹名")})}),(0,S.jsx)(m.Z.Item,{label:g.ZP.get("父目录"),name:"path",children:(0,S.jsx)(y.Z,{allowClear:!0,treeData:E,fieldNames:{value:"key",label:"title"},placeholder:g.ZP.get("请选择父目录"),treeDefaultExpandAll:!0})}),"upload"===A&&(0,S.jsx)(m.Z.Item,{label:g.ZP.get("文件"),name:"file",children:(0,S.jsxs)(k.Z.Dragger,{beforeUpload:function(e){return F(e),!1},maxCount:1,children:[(0,S.jsx)("p",{className:"ant-upload-drag-icon",children:(0,S.jsx)(j.Z,{})}),(0,S.jsx)("p",{className:"ant-upload-text",children:g.ZP.get("点击或者拖拽文件到此区域上传")})]})})]})})}},66553:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var r=n(93525),a=n.n(r),i=n(54306),o=n.n(i),s=n(88265),l=n(63313),c=n(92260),u=n(84163),d=n(9835),p=n(75310),g=n(34133),h=n(24378),f=n(15367),m=n(22159),v=n(43209),Z=n(84540),P=n(15207),b=n(23435),y=n(82755),k=n(57229),x={"left-tree-container":"left-tree-container___z9VeF","left-tree-scroller":"left-tree-scroller___MRc8C","log-container":"log-container___Iva4k"},w=n(98912),j=n(31988),S=n(36035),C=n(26839),q=n(32132),_=n(13740),E=n(23831),I=n(85472),B=n(66292),R=n.n(B),N=n(14851),F=n(43977),T=n(40141),M=n(51805),A=n(4363),H=n.n(A),D=n(38582),V=n(38359),O=n(26747),W=n(11527),U=c.Z.Text,L=function(){var e=(0,N.useOutletContext)(),t=e.headerStyle,n=e.isPhone,r=e.theme,i=(0,l.useState)(s.ZP.get("请选择脚本文件")),c=o()(i,2),B=c[0],A=c[1],L=(0,l.useState)(""),K=o()(L,2),Q=K[0],z=K[1],X=(0,l.useState)([]),Y=o()(X,2),G=Y[0],$=Y[1],J=(0,l.useState)(!1),ee=o()(J,2),te=ee[0],ne=ee[1],re=(0,l.useState)(""),ae=o()(re,2),ie=ae[0],oe=ae[1],se=(0,l.useState)(),le=o()(se,2),ce=le[0],ue=le[1],de=(0,l.useRef)(),pe=(0,l.useState)(!1),ge=o()(pe,2),he=ge[0],fe=ge[1],me=(0,l.useState)(""),ve=o()(me,2),Ze=ve[0],Pe=ve[1],be=(0,l.useState)(!1),ye=o()(be,2),ke=ye[0],xe=ye[1],we=(0,l.useRef)(null),je=(0,l.useState)(!1),Se=o()(je,2),Ce=Se[0],qe=Se[1],_e=(0,l.useState)(!1),Ee=o()(_e,2),Ie=Ee[0],Be=Ee[1],Re=(0,l.useState)(),Ne=o()(Re,2),Fe=Ne[0],Te=Ne[1],Me=(0,l.useState)([]),Ae=o()(Me,2),He=Ae[0],De=Ae[1],Ve=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&ne(!0),k.W.get("".concat(P.Z.apiPrefix,"scripts")).then((function(e){var t=e.code,n=e.data;200===t&&($(n),rt(),We(n))})).finally((function(){return e&&ne(!1)}))},Oe=function(e){k.W.get("".concat(P.Z.apiPrefix,"scripts/").concat(encodeURIComponent(e.title),"?path=").concat(e.parent||"")).then((function(e){var t=e.code,n=e.data;200===t&&A(n)}))},We=function(e){var t=(0,F.parse)(N.history.location.search),n=t.p,r=t.s;if(r){var a="".concat(n,"/").concat(r),i={node:{title:r,key:n?a:r,parent:n}};(0,T.DY)(e,(function(e){return e.key===i.node.key}))&&(De([n]),Le([a],i))}},Ue=function(e,t){if(z(t.key),Te(t),t.key!==Q&&e)if("directory"!==t.type){var r=(0,T.H$)(e);oe(n&&"typescript"===r?"javascript":r),A(s.ZP.get("加载中...")),Oe(t)}else A(s.ZP.get("请选择脚本文件"))},Le=(0,l.useCallback)((function(e,t){(we.current?we.current.getValue().replace(/\r\n/g,"\n"):B)!==B?u.Z.confirm({title:"确认离开",content:(0,W.jsx)(W.Fragment,{children:s.ZP.get("当前修改未保存，确定离开吗")}),onOk:function(){Ue(e[0],t.node),xe(!1)},onCancel:function(){console.log("Cancel")}}):(xe(!1),Ue(e[0],t.node))}),[B]),Ke=(0,l.useCallback)((function(e){var t=e.target.value;Qe(t)}),[G]),Qe=(0,l.useCallback)(R()((function(e){Pe(e)}),300),[G]),ze=(0,M.Z)(G,Ze,{treeNodeFilterProp:"title"}),Xe=ze.treeData,Ye=ze.keys;(0,l.useEffect)((function(){De(H()([].concat(a()(He),a()(Ye))))}),[Ye]);var Ge=function(){setTimeout((function(){xe(!0)}),300)},$e=function(){xe(!1),A(s.ZP.get("加载中...")),Oe(Fe)},Je=function(){u.Z.confirm({title:"确认保存",content:(0,W.jsxs)(W.Fragment,{children:[s.ZP.get("确认保存文件"),(0,W.jsx)(U,{style:{wordBreak:"break-all"},type:"warning",children:Fe.title})," ",s.ZP.get("，保存后不可恢复")]}),onOk:function(){var e=we.current?we.current.getValue().replace(/\r\n/g,"\n"):B;return new Promise((function(t,n){k.W.put("".concat(P.Z.apiPrefix,"scripts"),{filename:Fe.title,path:Fe.parent||"",content:e}).then((function(n){var r=n.code;n.data;200===r&&(d.ZP.success("保存成功"),A(e),xe(!1)),t(null)})).catch((function(e){return n(e)}))}))},onCancel:function(){console.log("Cancel")}})},et=function(){u.Z.confirm({title:"确认删除",content:(0,W.jsxs)(W.Fragment,{children:[s.ZP.get("确认删除"),(0,W.jsx)(U,{style:{wordBreak:"break-all"},type:"warning",children:Q}),s.ZP.get("文件"),"directory"===Fe.type?s.ZP.get("夹及其子文件"):"",s.ZP.get("，删除后不可恢复")]}),onOk:function(){k.W.delete("".concat(P.Z.apiPrefix,"scripts"),{data:{filename:Fe.title,path:Fe.parent||"",type:Fe.type}}).then((function(e){if(200===e.code){d.ZP.success("删除成功");var t=a()(G);if(Fe.parent)t=(0,T.I1)(t,(function(e){return e.key===Fe.key}));else{var n=t.findIndex((function(e){return e.key===Fe.key}));-1!==n&&t.splice(n,1)}$(t),rt()}}))},onCancel:function(){console.log("Cancel")}})},tt=function(){Be(!0)},nt=function(){qe(!0)},rt=function(){z(""),Te(null),A(s.ZP.get("请选择脚本文件"))};(0,l.useEffect)((function(){Ve()}),[]),(0,l.useEffect)((function(){de.current&&ue(de.current.clientHeight)}),[de.current,G]);var at=ke?{items:[{label:s.ZP.get("保存"),key:"save",icon:(0,W.jsx)(C.Z,{})},{label:s.ZP.get("退出编辑"),key:"exit",icon:(0,W.jsx)(q.Z,{})}],onClick:function(e){var t=e.key;e.domEvent.stopPropagation(),function(e){switch(e){case"save":Je();break;case"exit":$e()}}(t)}}:{items:[{label:s.ZP.get("创建"),key:"add",icon:(0,W.jsx)(C.Z,{})},{label:s.ZP.get("编辑"),key:"edit",icon:(0,W.jsx)(q.Z,{}),disabled:!Q},{label:s.ZP.get("重命名"),key:"rename",icon:(0,W.jsx)(D.Z,{type:"ql-icon-rename"}),disabled:!Q},{label:s.ZP.get("删除"),key:"delete",icon:(0,W.jsx)(_.Z,{}),disabled:!Q}],onClick:function(e){var t=e.key;e.domEvent.stopPropagation(),function(e){switch(e){case"add":nt();break;case"edit":Ge();break;case"delete":et();break;case"rename":tt()}}(t)}};return(0,W.jsx)(b.ZP,{className:"ql-container-wrapper log-wrapper",title:Q,loading:te,extra:n?[(0,W.jsx)(p.Z,{treeExpandAction:"click",className:"log-select",value:Q,dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:G,placeholder:s.ZP.get("请选择脚本"),fieldNames:{value:"key"},treeNodeFilterProp:"title",showSearch:!0,allowClear:!0,onSelect:Ue}),(0,W.jsx)(g.Z,{menu:at,trigger:["click"],children:(0,W.jsx)(h.Z,{type:"primary",icon:(0,W.jsx)(E.Z,{})})})]:ke?[(0,W.jsx)(h.Z,{type:"primary",onClick:Je,children:s.ZP.get("保存")}),(0,W.jsx)(h.Z,{type:"primary",onClick:$e,children:s.ZP.get("退出编辑")})]:[(0,W.jsx)(f.Z,{title:s.ZP.get("创建"),children:(0,W.jsx)(h.Z,{type:"primary",onClick:nt,icon:(0,W.jsx)(C.Z,{})})}),(0,W.jsx)(f.Z,{title:s.ZP.get("编辑"),children:(0,W.jsx)(h.Z,{disabled:!Q,type:"primary",onClick:Ge,icon:(0,W.jsx)(q.Z,{})})}),(0,W.jsx)(f.Z,{title:s.ZP.get("重命名"),children:(0,W.jsx)(h.Z,{disabled:!Q,type:"primary",onClick:tt,icon:(0,W.jsx)(D.Z,{type:"ql-icon-rename"})})}),(0,W.jsx)(f.Z,{title:s.ZP.get("删除"),children:(0,W.jsx)(h.Z,{type:"primary",disabled:!Q,onClick:et,icon:(0,W.jsx)(_.Z,{})})}),(0,W.jsx)(h.Z,{type:"primary",onClick:function(){fe(!0)},children:s.ZP.get("调试")})],header:{style:t},children:(0,W.jsxs)("div",{className:"".concat(x["log-container"]," log-container"),children:[!n&&(0,W.jsxs)(S.Z,{split:"vertical",size:200,maxSize:-100,children:[(0,W.jsx)("div",{className:x["left-tree-container"],children:G.length>0?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(m.Z.Search,{className:x["left-tree-search"],onChange:Ke,placeholder:s.ZP.get("请输入脚本名"),allowClear:!0}),(0,W.jsx)("div",{className:x["left-tree-scroller"],ref:de,children:(0,W.jsx)(v.Z,{expandAction:"click",className:x["left-tree"],treeData:Xe,showIcon:!0,height:ce,selectedKeys:[Q],expandedKeys:He,onExpand:function(e){De(e)},showLine:{showLeafIcon:!0},onSelect:Le})})]}):(0,W.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,W.jsx)(Z.Z,{description:s.ZP.get("暂无脚本"),image:Z.Z.PRESENTED_IMAGE_SIMPLE})})}),(0,W.jsx)(y.ZP,{language:ie,value:B,theme:r,options:{readOnly:!ke,fontSize:12,lineNumbersMinChars:3,glyphMargin:!1},onMount:function(e){we.current=e}})]}),n&&(0,W.jsx)(j.ZP,{value:B,extensions:ie?[O.RI[ie]()]:void 0,theme:r.includes("dark")?"dark":"light",readOnly:!ke,onChange:function(e){A(e)}}),he&&(0,W.jsx)(w.default,{visible:he,treeData:G,currentNode:Fe,content:B,handleCancel:function(){fe(!1)}}),(0,W.jsx)(I.default,{visible:Ce,treeData:G,handleCancel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{filename:"",path:"",key:""},t=e.filename,n=e.path,r=e.key;if(t){var i=a()(G),o={title:t,key:r,parent:n};if(n){i=(0,T.I1)(i,(function(e){return e.key===n}),o);var s=n.split("/"),l=[];s.reduce((function(e,t){return l.push(e),"".concat(e,"/").concat(t)})),De([].concat(a()(He),l,[n]))}else i.unshift(o);$(i),Ue(o.title,o),xe(!0)}qe(!1)}}),(0,W.jsx)(V.default,{visible:Ie,handleCancel:function(){Be(!1),Ve(!1)},currentNode:Fe})]})})}},38359:function(e,t,n){"use strict";n.r(t);var r=n(25359),a=n.n(r),i=n(49811),o=n.n(i),s=n(54306),l=n.n(s),c=n(88265),u=n(63313),d=n(67393),p=n(9835),g=n(84163),h=n(22159),f=n(57229),m=n(15207),v=n(11527);t.default=function(e){var t=e.currentNode,n=e.handleCancel,r=e.visible,i=d.Z.useForm(),s=l()(i,1)[0],Z=(0,u.useState)(!1),P=l()(Z,2),b=P[0],y=P[1],k=function(){var e=o()(a()().mark((function e(r){var i,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),e.prev=1,e.next=4,f.W.put("".concat(m.Z.apiPrefix,"scripts/rename"),{filename:t.title,path:t.parent||"",newFilename:r.name});case 4:i=e.sent,o=i.code,i.data,200===o&&(p.ZP.success(c.ZP.get("更新名称成功")),n()),y(!1),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),y(!1);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}();return(0,u.useEffect)((function(){s.resetFields()}),[t,r]),(0,v.jsx)(g.Z,{title:c.ZP.get("重命名"),open:r,forceRender:!0,centered:!0,maskClosable:!1,onOk:function(){s.validateFields().then((function(e){k(e)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){return n()},confirmLoading:b,children:(0,v.jsx)(d.Z,{form:s,layout:"vertical",name:"edit_name_modal",children:(0,v.jsx)(d.Z.Item,{name:"name",rules:[{required:!0,message:c.ZP.get("请输入新名称")}],children:(0,v.jsx)(h.Z,{placeholder:c.ZP.get("请输入新名称")})})})})}},68793:function(e,t,n){"use strict";n.r(t);var r=n(25359),a=n.n(r),i=n(57213),o=n.n(i),s=n(49811),l=n.n(s),c=n(54306),u=n.n(c),d=n(88265),p=n(63313),g=n(67393),h=n(9835),f=n(84163),m=n(22159),v=n(57229),Z=n(15207),P=n(11527);t.default=function(e){var t=e.file,n=e.handleCancel,r=e.visible,i=g.Z.useForm(),s=u()(i,1)[0],c=(0,p.useState)(!1),b=u()(c,2),y=b[0],k=b[1],x=function(){var e=l()(a()().mark((function e(r){var i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k(!0),i=o()(o()(o()({},t),r),{},{originFilename:t.title}),v.W.post("".concat(Z.Z.apiPrefix,"scripts"),i).then((function(e){var t=e.code,r=e.data;200===t&&(h.ZP.success(d.ZP.get("保存文件成功")),n(r)),k(!1)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,p.useEffect)((function(){s.resetFields(),k(!1)}),[t,r]),(0,P.jsx)(f.Z,{title:d.ZP.get("保存文件"),open:r,forceRender:!0,centered:!0,maskClosable:!1,onOk:function(){s.validateFields().then((function(e){x(e)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){return n()},confirmLoading:y,children:(0,P.jsxs)(g.Z,{form:s,layout:"vertical",name:"script_modal",initialValues:{filename:null==t?void 0:t.title,path:(null==t?void 0:t.parent)||""},children:[(0,P.jsx)(g.Z.Item,{name:"filename",label:d.ZP.get("文件名"),rules:[{required:!0,message:d.ZP.get("请输入文件名")}],children:(0,P.jsx)(m.Z,{placeholder:d.ZP.get("请输入文件名")})}),(0,P.jsx)(g.Z.Item,{name:"path",label:d.ZP.get("保存目录"),children:(0,P.jsx)(m.Z,{placeholder:d.ZP.get("请输入保存目录，默认scripts目录")})})]})})}},12417:function(e,t,n){"use strict";n.r(t);n(25359),n(57213),n(49811);var r=n(54306),a=n.n(r),i=n(88265),o=n(63313),s=n(67393),l=(n(9835),n(84163)),c=n(22159),u=(n(57229),n(15207),n(11527));t.default=function(e){var t=e.file,n=e.handleCancel,r=e.visible,d=s.Z.useForm(),p=a()(d,1)[0],g=(0,o.useState)(!1),h=a()(g,2),f=(h[0],h[1]);return(0,o.useEffect)((function(){p.resetFields(),f(!1)}),[t,r]),(0,u.jsx)(l.Z,{title:i.ZP.get("运行设置"),open:r,forceRender:!0,centered:!0,onCancel:function(){return n()},children:(0,u.jsx)(s.Z,{form:p,layout:"vertical",name:"setting_modal",initialValues:t,children:(0,u.jsx)(s.Z.Item,{name:"filename",label:i.ZP.get("待开发"),rules:[{required:!0,message:i.ZP.get("待开发")}],children:(0,u.jsx)(c.Z,{placeholder:i.ZP.get("待开发")})})})})}},15207:function(e,t,n){"use strict";var r=n(88265),a=window.__ENV__QlBaseUrl||"/";t.Z={siteName:r.ZP.get("青龙"),apiPrefix:"".concat(a,"api/"),authKey:"token",layouts:[{name:"primary",include:[/.*/],exclude:[/(\/(en|zh))*\/login/]}],i18n:{languages:[{key:"pt-br",title:"Português",flag:"/portugal.svg"},{key:"en",title:"English",flag:"/america.svg"},{key:"zh",title:r.ZP.get("中文"),flag:"/china.svg"}],defaultLanguage:"en"},scopes:[{name:r.ZP.get("定时任务"),value:"crons"},{name:r.ZP.get("环境变量"),value:"envs"},{name:r.ZP.get("订阅管理"),value:"subscriptions"},{name:r.ZP.get("配置文件"),value:"configs"},{name:r.ZP.get("脚本管理"),value:"scripts"},{name:r.ZP.get("日志管理"),value:"logs"},{name:r.ZP.get("依赖管理"),value:"dependencies"},{name:r.ZP.get("系统信息"),value:"system"}],scopesMap:{crons:r.ZP.get("定时任务"),envs:r.ZP.get("环境变量"),subscriptions:r.ZP.get("订阅管理"),configs:r.ZP.get("配置文件"),scripts:r.ZP.get("脚本管理"),logs:r.ZP.get("日志管理"),dependencies:r.ZP.get("依赖管理"),system:r.ZP.get("系统信息")},notificationModes:[{value:"gotify",label:"Gotify"},{value:"goCqHttpBot",label:"GoCqHttpBot"},{value:"serverChan",label:r.ZP.get("Server酱")},{value:"pushDeer",label:"PushDeer"},{value:"bark",label:"Bark"},{value:"telegramBot",label:r.ZP.get("Telegram机器人")},{value:"dingtalkBot",label:r.ZP.get("钉钉机器人")},{value:"weWorkBot",label:r.ZP.get("企业微信机器人")},{value:"weWorkApp",label:r.ZP.get("企业微信应用")},{value:"aibotk",label:r.ZP.get("智能微秘书")},{value:"iGot",label:"IGot"},{value:"pushPlus",label:"PushPlus"},{value:"chat",label:r.ZP.get("群晖chat")},{value:"email",label:r.ZP.get("邮箱")},{value:"lark",label:r.ZP.get("飞书机器人")},{value:"pushMe",label:"PushMe"},{value:"chronocat",label:"Chronocat"},{value:"webhook",label:r.ZP.get("自定义通知")},{value:"closed",label:r.ZP.get("已关闭")}],notificationModeMap:{gotify:[{label:"gotifyUrl",tip:r.ZP.get("gotify的url地址，例如 https://push.example.de:8080"),required:!0},{label:"gotifyToken",tip:r.ZP.get("gotify的消息应用token码"),required:!0},{label:"gotifyPriority",tip:r.ZP.get("推送消息的优先级")}],chat:[{label:"chatUrl",tip:r.ZP.get("chat的url地址"),required:!0},{label:"chatToken",tip:r.ZP.get("chat的token码"),required:!0}],goCqHttpBot:[{label:"goCqHttpBotUrl",tip:r.ZP.get("推送到个人QQ: http://127.0.0.1/send_private_msg，群：http://127.0.0.1/send_group_msg"),required:!0},{label:"goCqHttpBotToken",tip:r.ZP.get("访问密钥"),required:!0},{label:"goCqHttpBotQq",tip:r.ZP.get("如果GOBOT_URL设置 /send_private_msg 则需要填入 user_id=个人QQ 相反如果是 /send_group_msg 则需要填入 group_id=QQ群"),required:!0}],serverChan:[{label:"serverChanKey",tip:r.ZP.get("Server酱SENDKEY"),required:!0}],pushDeer:[{label:"pushDeerKey",tip:r.ZP.get("PushDeer的Key，https://github.com/easychen/pushdeer"),required:!0},{label:"pushDeerUrl",tip:r.ZP.get("PushDeer的自架API endpoint，默认是 https://api2.pushdeer.com/message/push")}],bark:[{label:"barkPush",tip:r.ZP.get("Bark的信息IP/设备码，例如：https://api.day.app/XXXXXXXX"),required:!0},{label:"barkIcon",tip:r.ZP.get("BARK推送图标，自定义推送图标 (需iOS15或以上才能显示)")},{label:"barkSound",tip:r.ZP.get("BARK推送铃声，铃声列表去APP查看复制填写")},{label:"barkGroup",tip:r.ZP.get("BARK推送消息的分组，默认为qinglong")},{label:"barkLevel",tip:r.ZP.get("BARK推送消息的时效性，默认为active")},{label:"barkUrl",tip:r.ZP.get("BARK推送消息的跳转URL")}],telegramBot:[{label:"telegramBotToken",tip:r.ZP.get("telegram机器人的token，例如：1077xxx4424:AAFjv0FcqxxxxxxgEMGfi22B4yh15R5uw"),required:!0},{label:"telegramBotUserId",tip:r.ZP.get("telegram用户的id，例如：129xxx206"),required:!0},{label:"telegramBotProxyHost",tip:r.ZP.get("代理IP")},{label:"telegramBotProxyPort",tip:r.ZP.get("代理端口")},{label:"telegramBotProxyAuth",tip:r.ZP.get("telegram代理配置认证参数，用户名与密码用英文冒号连接 user:password")},{label:"telegramBotApiHost",tip:r.ZP.get("telegram api自建的反向代理地址，默认tg官方api")}],dingtalkBot:[{label:"dingtalkBotToken",tip:r.ZP.get("钉钉机器人webhook token，例如：5a544165465465645d0f31dca676e7bd07415asdasd"),required:!0},{label:"dingtalkBotSecret",tip:r.ZP.get("密钥，机器人安全设置页面，加签一栏下面显示的SEC开头的字符串")}],weWorkBot:[{label:"weWorkBotKey",tip:r.ZP.get("企业微信机器人的webhook(详见文档 https://work.weixin.qq.com/api/doc/90000/90136/91770)，例如：693a91f6-7xxx-4bc4-97a0-0ec2sifa5aaa"),required:!0},{label:"weWorkOrigin",tip:r.ZP.get("企业微信代理地址")}],weWorkApp:[{label:"weWorkAppKey",tip:r.ZP.get("corpid、corpsecret、touser(注:多个成员ID使用|隔开)、agentid、消息类型(选填，不填默认文本消息类型) 注意用,号隔开(英文输入法的逗号)，例如：wwcfrs,B-76WERQ,qinglong,1000001,2COat"),required:!0},{label:"weWorkOrigin",tip:r.ZP.get("企业微信代理地址")}],aibotk:[{label:"aibotkKey",tip:r.ZP.get("密钥key，智能微秘书个人中心获取apikey，申请地址：https://wechat.aibotk.com/signup?from=ql"),required:!0},{label:"aibotkType",tip:r.ZP.get("发送的目标，群组或者好友"),required:!0,placeholder:r.ZP.get("请输入要发送的目标"),items:[{value:"room",label:r.ZP.get("群聊")},{value:"contact",label:r.ZP.get("好友")}]},{label:"aibotkName",tip:r.ZP.get("要发送的用户昵称或群名，如果目标是群，需要填群名，如果目标是好友，需要填好友昵称"),required:!0}],iGot:[{label:"iGotPushKey",tip:r.ZP.get("iGot的信息推送key，例如：https://push.hellyw.com/XXXXXXXX"),required:!0}],pushPlus:[{label:"pushPlusToken",tip:r.ZP.get("微信扫码登录后一对一推送或一对多推送下面的token(您的Token)，不提供PUSH_PLUS_USER则默认为一对一推送，参考 https://www.pushplus.plus/"),required:!0},{label:"pushPlusUser",tip:r.ZP.get("一对多推送的“群组编码”（一对多推送下面->您的群组(如无则创建)->群组编码，如果您是创建群组人。也需点击“查看二维码”扫描绑定，否则不能接受群组消息推送）")}],lark:[{label:"larkKey",tip:r.ZP.get("飞书群组机器人：https://www.feishu.cn/hc/zh-CN/articles/360024984973"),required:!0}],email:[{label:"emailService",tip:r.ZP.get("邮箱服务名称，比如126、163、Gmail、QQ等，支持列表https://nodemailer.com/smtp/well-known/"),required:!0},{label:"emailUser",tip:r.ZP.get("邮箱地址"),required:!0},{label:"emailPass",tip:r.ZP.get("邮箱SMTP授权码"),required:!0}],pushMe:[{label:"pushMeKey",tip:r.ZP.get("PushMe的Key，https://push.i-i.me/"),required:!0}],chronocat:[{label:"chronocatURL",tip:r.ZP.get("Chronocat Red 服务的连接地址 https://chronocat.vercel.app/install/docker/official/"),required:!0},{label:"chronocatQQ",tip:r.ZP.get("个人:user_id=个人QQ 群则填入group_id=QQ群 多个用英文;隔开同时支持个人和群 如：user_id=xxx;group_id=xxxx;group_id=xxxxx"),required:!0},{label:"chronocatToken",tip:r.ZP.get("docker安装在持久化config目录下的chronocat.yml文件可找到"),required:!0}],webhook:[{label:"webhookMethod",tip:r.ZP.get("请求方法"),required:!0,items:[{value:"GET"},{value:"POST"},{value:"PUT"}]},{label:"webhookContentType",tip:r.ZP.get("请求头Content-Type"),required:!0,items:[{value:"application/json"},{value:"multipart/form-data"},{value:"application/x-www-form-urlencoded"}]},{label:"webhookUrl",tip:r.ZP.get("请求链接以http或者https开头。url或者body中必须包含$title，$content可选，对应api内容的位置"),required:!0,placeholder:"https://xxx.cn/api?content=$title\n"},{label:"webhookHeaders",tip:r.ZP.get("请求头格式Custom-Header1: Header1，多个换行分割"),placeholder:"Custom-Header1: Header1\nCustom-Header2: Header2"},{label:"webhookBody",tip:r.ZP.get("请求体格式key1: value1，多个换行分割。url或者body中必须包含$title，$content可选，对应api内容的位置"),placeholder:"key1: $title\nkey2: $content"}]},documentTitleMap:{"/login":r.ZP.get("登录"),"/initialization":r.ZP.get("初始化"),"/crontab":r.ZP.get("定时任务"),"/env":r.ZP.get("环境变量"),"/subscription":r.ZP.get("订阅管理"),"/config":r.ZP.get("配置文件"),"/script":r.ZP.get("脚本管理"),"/diff":r.ZP.get("对比工具"),"/log":r.ZP.get("日志管理"),"/setting":r.ZP.get("系统设置"),"/error":r.ZP.get("错误日志"),"/dependence":r.ZP.get("依赖管理")},dependenceTypes:["nodejs","python3","linux"]}},3094:function(e,t,n){"use strict";n.d(t,{F:function(){return l},e:function(){return s}});var r=n(54306),a=n.n(r),i=n(63313),o=n(40141),s=function(){var e=(0,i.useState)("100%"),t=a()(e,2),n=t[0],r=t[1],s=(0,i.useState)(0),l=a()(s,2),c=l[0],u=l[1],d=(0,i.useState)(-48),p=a()(d,2),g=p[0],h=p[1],f=(0,i.useState)(!1),m=a()(f,2),v=m[0],Z=m[1],P=(0,i.useMemo)((function(){return(0,o.ZP)()}),[]).platform;return(0,i.useEffect)((function(){"mobile"===P&&document.body.offsetWidth<768?(r("auto"),u(0),h(0),Z(!0),document.body.setAttribute("data-mode","phone")):(r("100%"),u(0),h(-48),Z(!1),document.body.setAttribute("data-mode","desktop"))}),[]),{headerStyle:{padding:"4px 16px 4px 15px",position:"sticky",top:0,left:0,zIndex:20,marginTop:g,width:n,marginLeft:c},isPhone:v}},l=function(){var e=(0,i.useState)(),t=a()(e,2),n=t[0],r=t[1];return(0,i.useEffect)((function(){var e=window.matchMedia("(prefers-color-scheme: dark)"),t=localStorage.getItem("qinglong_dark_theme"),n=e.matches&&"light"!==t||"dark"===t;r(n?"vs-dark":"vs");var a=function(e){"auto"!==t&&t||(e.matches?r("vs-dark"):r("vs"))};"function"==typeof e.addEventListener?e.addEventListener("change",a):"function"==typeof e.addListener&&e.addListener(a)}),[]),{theme:n,reloadTheme:function(){var e=window.matchMedia("(prefers-color-scheme: dark)"),t=localStorage.getItem("qinglong_dark_theme"),n=e.matches&&"light"!==t||"dark"===t;r(n?"vs-dark":"vs")}}}},57229:function(e,t,n){"use strict";n.d(t,{W:function(){return f}});var r=n(25359),a=n.n(r),i=n(49811),o=n.n(i),s=n(88265),l=n(9835),c=n(15207),u=n(14851),d=n(73669);l.ZP.config({duration:2});var p=Date.now(),g=d.Z.create({timeout:6e4,params:{t:p}}),h=["/api/user/login","/open/auth/token","/api/user/two-factor/login","/api/system","/api/user/init","/api/user/notification/init"];g.interceptors.request.use((function(e){var t=localStorage.getItem(c.Z.authKey);return t&&!h.includes(e.url)?(e.headers.Authorization="Bearer ".concat(t),e):e})),g.interceptors.response.use(function(){var e=o()(a()().mark((function e(t){var n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.status,![502,504].includes(n)){e.next=5;break}u.history.push("/error"),e.next=18;break;case 5:if(401!==n){e.next=9;break}"/login"!==u.history.location.pathname&&(localStorage.removeItem(c.Z.authKey),u.history.push("/login")),e.next=18;break;case 9:return e.prev=9,200!==(r=t.data).code&&(i=r.message||r.data)&&l.ZP.error({content:i,style:{maxWidth:500,margin:"0 auto"}}),e.abrupt("return",r);case 15:e.prev=15,e.t0=e.catch(9);case 17:case 18:return e.abrupt("return",t);case 19:case"end":return e.stop()}}),e,null,[[9,15]])})));return function(t){return e.apply(this,arguments)}}(),(function(e){if(e.response){var t=e.response.data?e.response.data.message||e.message||e.response.data:e.response.statusText,n=e.response.status;[502,504].includes(n)?u.history.push("/error"):401===n?"/login"!==u.history.location.pathname&&(l.ZP.error(s.ZP.get("登录已过期，请重新登录")),localStorage.removeItem(c.Z.authKey),u.history.push("/login")):l.ZP.error({content:t,style:{maxWidth:500,margin:"0 auto"}})}else console.log(e.message);return Promise.reject(e)}));var f=g},40141:function(e,t,n){"use strict";n.d(t,{ZP:function(){return c},I1:function(){return p},w7:function(){return d},DY:function(){return g},FA:function(){return f},rS:function(){return v},H$:function(){return Z},W9:function(){return u},x$:function(){return h}});var r=n(93525),a=n.n(r),i=n(88265),o={".py":"python",".js":"javascript",".mjs":"javascript",".sh":"shell",".ts":"typescript"},s=n(11186),l=n.n(s);function c(){var e=navigator.userAgent.toLowerCase(),t=function(t){return t.test(e)},n=function(t){return(e.match(t)||[]).toString().replace(/[^0-9|_.]/g,"").replace(/_/g,".")},r="unknow";t(/windows|win32|win64|wow32|wow64/g)?r="windows":t(/macintosh|macintel/g)?r="macos":t(/x11/g)?r="linux":t(/android|adr/g)?r="android":t(/ios|iphone|ipad|ipod|iwatch/g)&&(r="ios");var a="unknow";"windows"===r?t(/windows nt 5.0|windows 2000/g)?a="2000":t(/windows nt 5.1|windows xp/g)?a="xp":t(/windows nt 5.2|windows 2003/g)?a="2003":t(/windows nt 6.0|windows vista/g)?a="vista":t(/windows nt 6.1|windows 7/g)?a="7":t(/windows nt 6.2|windows 8/g)?a="8":t(/windows nt 6.3|windows 8.1/g)?a="8.1":t(/windows nt 10.0|windows 10/g)&&(a="10"):"macos"===r?a=n(/os x [\d._]+/g):"android"===r?a=n(/android [\d._]+/g):"ios"===r&&(a=n(/os [\d._]+/g));var i="unknow";"windows"===r||"macos"===r||"linux"===r?i="desktop":("android"===r||"ios"===r||t(/mobile/g))&&(i="mobile");var o="unknow",s="unknow";t(/applewebkit/g)?(o="webkit",t(/edge/g)?s="edge":t(/opr/g)?s="opera":t(/chrome/g)?s="chrome":t(/safari/g)&&(s="safari")):t(/gecko/g)&&t(/firefox/g)?(o="gecko",s="firefox"):t(/presto/g)?(o="presto",s="opera"):t(/trident|compatible|msie/g)&&(o="trident",s="iexplore");var l="unknow";"webkit"===o?l=n(/applewebkit\/[\d._]+/g):"gecko"===o?l=n(/gecko\/[\d._]+/g):"presto"===o?l=n(/presto\/[\d._]+/g):"trident"===o&&(l=n(/trident\/[\d._]+/g));var c="unknow";"chrome"===s?c=n(/chrome\/[\d._]+/g):"safari"===s?c=n(/version\/[\d._]+/g):"firefox"===s?c=n(/firefox\/[\d._]+/g):"opera"===s?c=n(/opr\/[\d._]+/g):"iexplore"===s?c=n(/(msie [\d._]+)|(rv:[\d._]+)/g):"edge"===s&&(c=n(/edge\/[\d._]+/g));var u="none",d="unknow";t(/micromessenger/g)?(u="wechat",d=n(/micromessenger\/[\d._]+/g)):t(/qqbrowser/g)?(u="qq",d=n(/qqbrowser\/[\d._]+/g)):t(/ucbrowser/g)?(u="uc",d=n(/ucbrowser\/[\d._]+/g)):t(/qihu 360se/g)?u="360":t(/2345explorer/g)?(u="2345",d=n(/2345explorer\/[\d._]+/g)):t(/metasr/g)?u="sougou":t(/lbbrowser/g)?u="liebao":t(/maxthon/g)&&(u="maxthon",d=n(/maxthon\/[\d._]+/g));var p=Object.assign({engine:o,engineVs:l,platform:i,supporter:s,supporterVs:c,system:r,systemVs:a},"none"===u?{}:{shell:u,shellVs:d});return console.log("%c\n .d88b.  d888888b d8b   db  d888b  db       .d88b.  d8b   db  d888b  \n.8P  Y8.   `88'   888o  88 88' Y8b 88      .8P  Y8. 888o  88 88' Y8b \n88    88    88    88V8o 88 88      88      88    88 88V8o 88 88      \n88    88    88    88 V8o88 88  ooo 88      88    88 88 V8o88 88  ooo \n`8P  d8'   .88.   88  V888 88. ~8~ 88booo. `8b  d8' 88  V888 88. ~8~ \n `Y88'Y8 Y888888P VP   V8P  Y888P  Y88888P  `Y88P'  VP   V8P  Y888P  \n                                                                     \n                                                                     \n","color: blue;font-size: 14px;"),console.log("%c忘形雨笠烟蓑，知心牧唱樵歌。明月清风共我，闲人三个，从他今古消磨。\n","color: yellow;font-size: 18px;"),console.log("%c青龙运行环境:\n\n系统：".concat(p.system,"/").concat(p.systemVs,"\n浏览器：").concat(p.supporter,"/").concat(p.supporterVs,"\n内核：").concat(p.engine,"/").concat(p.engineVs),"color: green;font-size: 14px;font-weight: bold;"),p}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.extraHeight,n=e.target;void 0===t&&(t=99);var r=null,a=0;(r=n||document.querySelector(".ant-table-wrapper"))&&(a=r.getBoundingClientRect().top);var i=document.body.clientHeight-a-t;return i}function d(e,t){var n,r,a=window.URL||window.webkitURL||window,i=new Blob([t]),o=document.createElementNS("http://www.w3.org/1999/xhtml","a");o.href=a.createObjectURL(i),o.download=e,n=o,(r=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)}function p(e,t,n){var r=a()(e),i=[];return function e(r){if(r)for(var a=0;a<(null==r?void 0:r.length);a++){if(t(r[a]))return n?void(r[a].children?r[a].children.unshift(n):r[a].children=[n]):void r.splice(a,1);r[a].children&&(i.push(r[a].key),e(r[a].children))}}(r),r}function g(e,t){var n;return function e(r){if(r)for(var a=0;a<(null==r?void 0:r.length);a++)t(r[a])?n=r[a]:r[a].children&&e(r[a].children)}(a()(e)),n}function h(e){return["　　　　　",i.ZP.get("执行结束")].some((function(t){return e.includes(t)}))}function f(e){var t=e.split(" ");if("repo"===t[1]||"raw"===t[1])return t[2];var n=t.find((function(e){return[".js",".ts",".sh",".py"].some((function(t){return e.endsWith(t)}))}));if(n){var r,a;n.startsWith("/ql/data/scripts")&&(n=n.replace("/ql/data/scripts/",""));var i=n.lastIndexOf("/");return i>=0?(a=n.slice(i+1),r=n.slice(0,i)):(a=n,r=""),[a,r]}}function m(e){try{var t=l().parseExpression(e);if(t)return t.next().toDate()}catch(e){}return null}function v(e,t){var n=m(e);return null!=t&&t.length&&t.forEach((function(e){var t=m(e);t&&(!n||t<n)&&(n=t)})),n}function Z(e){var t=function(e){if(!e)return"";var t=e.split(".");return".".concat(t[t.length-1])}(e);return o[t]}},21758:function(e,t,n){"use strict";var r=n(93525),a=n.n(r),i=n(12342),o=n.n(i),s=n(25359),l=n.n(s),c=n(49811),u=n.n(c),d=n(21140),p=n.n(d),g=n(63466),h=n.n(g),f=n(52510),m=n.n(f),v=n(78078),Z=n.n(v),P=["type"],b=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};p()(this,e),m()(this,"url",void 0),m()(this,"socket",null),m()(this,"subscriptions",new Map),m()(this,"options",void 0),m()(this,"reconnectAttempts",0),m()(this,"heartbeatTimeout",null),m()(this,"state","closed"),this.url=t,this.options={maxReconnectAttempts:n.maxReconnectAttempts||5,reconnectInterval:n.reconnectInterval||3e3,heartbeatInterval:n.heartbeatInterval||3e4},this.init()}var t,n;return h()(e,[{key:"init",value:(n=u()(l()().mark((function e(){var t=this;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.state="connecting",this.emit("connecting");case 3:if(!(this.reconnectAttempts<this.options.maxReconnectAttempts)){e.next=16;break}return this.socket=new(Z())(this.url),this.setupEventListeners(),this.startHeartbeat(),e.next=9,this.waitForClose();case 9:return this.stopHeartbeat(),this.socket=null,this.reconnectAttempts++,e.next=14,new Promise((function(e){return setTimeout(e,t.options.reconnectInterval)}));case 14:e.next=3;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.handleError(e.t0);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(){return n.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var e=this;this.socket&&(this.socket.onopen=function(){e.state="open",e.emit("open")},this.socket.onmessage=function(t){var n=JSON.parse(t.data);e.dispatchMessage(n)},this.socket.onclose=function(){e.state="closed",e.emit("close")})}},{key:"waitForClose",value:(t=u()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=this.socket)||void 0===t?void 0:t.readyState)===Z().CLOSED){e.next=5;break}return e.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"subscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(!n.has(t)){n.add(t),this.subscriptions.set(e,n);var r={action:"subscribe",topic:e};this.send(r)}}},{key:"unsubscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(n.has(t)){n.delete(t);var r={action:"unsubscribe",topic:e};this.send(r)}}},{key:"send",value:function(e){var t;(null===(t=this.socket)||void 0===t?void 0:t.readyState)===Z().OPEN&&this.socket.send(JSON.stringify(e))}},{key:"dispatchMessage",value:function(e){var t=e.type,n=o()(e,P),r=this.subscriptions.get(t)||new Set;a()(r).forEach((function(e){return e(n)}))}},{key:"startHeartbeat",value:function(){var e=this;this.heartbeatTimeout=setInterval((function(){var t;(null===(t=e.socket)||void 0===t?void 0:t.readyState)===Z().OPEN&&e.socket.send(JSON.stringify({type:"heartbeat"}))}),this.options.heartbeatInterval)}},{key:"stopHeartbeat",value:function(){this.heartbeatTimeout&&clearInterval(this.heartbeatTimeout)}},{key:"close",value:function(){this.socket&&(this.state="closed",this.stopHeartbeat(),this.socket.close(),this.emit("close"))}},{key:"handleError",value:function(e){console.error("WebSocket错误:",e),this.emit("error",e)}},{key:"on",value:function(e,t){}},{key:"emit",value:function(e,t){}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return e.instance||(e.instance=new e(t,n)),e.instance}}]),e}();m()(b,"instance",null),t.Z=b},38433:function(){}}]);