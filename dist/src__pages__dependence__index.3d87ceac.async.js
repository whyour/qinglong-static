"use strict";(self.webpackChunk_whyour_qinglong=self.webpackChunk_whyour_qinglong||[]).push([[9914],{44224:function(e,n,t){var i=(0,t(19919).Z)({scriptUrl:["//at.alicdn.com/t/c/font_3354854_lc939gab1iq.js"]});n.Z=i},43566:function(e,n,t){t.r(n),t.d(n,{default:function(){return N}});var i=t(15558),a=t.n(i),r=t(48305),c=t.n(r),l=t(26068),s=t.n(l),o=t(72317),u=t(75271),d=t(50691),f=t(17082),p=t(63505),Z=t(47667),x=t(59816),g=t(45520),h=t(93481),m=t(10948),j=t(46035),P=t(42483),v=t(44084),y=t(86935),k=t(15631),S=t(37559),w=t(70564),b=t(36053),C=t(88939),D=t(14946),I=t(3475),F=t(47508),q=t(16314),W=t(77831),A=t(78637),B=t(4690),O=t(8826),Y=t(98783),T=t(16483),_=t.n(T),z=t(65814),E=t(57113),L=t(44224),R=t(30502),H=t(52676),V=d.Z.Text,M=f.Z.Search,K={0:{icon:(0,H.jsx)(P.Z,{spin:!0}),color:"processing"},1:{icon:(0,H.jsx)(v.Z,{}),color:"success"},2:{icon:(0,H.jsx)(y.Z,{}),color:"error"},3:{icon:(0,H.jsx)(P.Z,{spin:!0}),color:"processing"},4:{icon:(0,H.jsx)(v.Z,{}),color:"success"},5:{icon:(0,H.jsx)(y.Z,{}),color:"error"},6:{icon:(0,H.jsx)(k.Z,{}),color:"default"},7:{icon:(0,H.jsx)(S.Z,{}),color:"default"}},N=function(){var e=(0,Y.useOutletContext)(),n=e.headerStyle,t=e.isPhone,i=[{title:o.ZP.get("序号"),width:90,render:function(e,n,t){return(0,H.jsxs)("span",{style:{cursor:"text"},children:[t+1," "]})}},{title:o.ZP.get("名称"),dataIndex:"name",width:180,key:"name"},{title:o.ZP.get("状态"),key:"status",width:120,dataIndex:"status",filters:[{text:o.ZP.get("队列中"),value:E.DependenceStatus.queued},{text:o.ZP.get("安装中"),value:E.DependenceStatus.installing},{text:o.ZP.get("已安装"),value:E.DependenceStatus.installed},{text:o.ZP.get("安装失败"),value:E.DependenceStatus.installFailed},{text:o.ZP.get("删除中"),value:E.DependenceStatus.removing},{text:o.ZP.get("已删除"),value:E.DependenceStatus.removed},{text:o.ZP.get("删除失败"),value:E.DependenceStatus.removeFailed},{text:o.ZP.get("已取消"),value:E.DependenceStatus.cancelled}],render:function(e,n,t){var i,a;return(0,H.jsx)(p.Z,{size:"middle",style:{cursor:"text"},children:(0,H.jsx)(Z.Z,{color:null===(i=K[n.status])||void 0===i?void 0:i.color,icon:null===(a=K[n.status])||void 0===a?void 0:a.icon,style:{marginRight:0},children:o.ZP.get(E.Status[n.status])})})}},{title:o.ZP.get("备注"),dataIndex:"remark",width:100,key:"remark"},{title:o.ZP.get("更新时间"),key:"updatedAt",dataIndex:"updatedAt",width:150,render:function(e){return(0,H.jsx)("span",{children:_()(e).format("YYYY-MM-DD HH:mm:ss")})}},{title:o.ZP.get("创建时间"),key:"createdAt",dataIndex:"createdAt",width:150,render:function(e){return(0,H.jsx)("span",{children:_()(e).format("YYYY-MM-DD HH:mm:ss")})}},{title:o.ZP.get("操作"),key:"action",width:140,render:function(e,n,i){var a=!t;return(0,H.jsxs)(p.Z,{size:"middle",children:[![E.Status.队列中,E.Status.已取消].includes(n.status)&&(0,H.jsx)(x.Z,{title:a?o.ZP.get("日志"):"",children:(0,H.jsx)("a",{onClick:function(){ue(s()(s()({},n),{},{timestamp:Date.now()}))},children:(0,H.jsx)(w.Z,{})})}),[E.Status.队列中,E.Status.安装中,E.Status.删除中].includes(n.status)?(0,H.jsx)(x.Z,{title:a?o.ZP.get("取消安装"):"",children:(0,H.jsx)("a",{onClick:function(){return Ce(n)},children:(0,H.jsx)(L.Z,{type:"ql-icon-quxiaoanzhuang"})})}):(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(x.Z,{title:a?o.ZP.get("重新安装"):"",children:(0,H.jsx)("a",{onClick:function(){return be(n,i)},children:(0,H.jsx)(b.Z,{})})}),E.Status.已安装===n.status&&(0,H.jsx)(x.Z,{title:a?o.ZP.get("删除"):"",children:(0,H.jsx)("a",{onClick:function(){return we(n,i)},children:(0,H.jsx)(C.Z,{})})}),(0,H.jsx)(x.Z,{title:a?o.ZP.get("强制删除"):"",children:(0,H.jsx)("a",{onClick:function(){return we(n,i,!0)},children:(0,H.jsx)(D.Z,{})})})]})]})}}],r=(0,u.useState)([]),l=c()(r,2),d=l[0],f=l[1],P=(0,u.useState)(!0),v=c()(P,2),y=v[0],k=v[1],S=(0,u.useState)(!1),T=c()(S,2),N=T[0],G=T[1],J=(0,u.useState)(),U=c()(J,2),Q=U[0],X=U[1],$=(0,u.useState)([]),ee=c()($,2),ne=ee[0],te=ee[1],ie=(0,u.useState)(""),ae=c()(ie,2),re=ae[0],ce=ae[1],le=(0,u.useState)(),se=c()(le,2),oe=se[0],ue=se[1],de=(0,u.useState)(!1),fe=c()(de,2),pe=fe[0],Ze=fe[1],xe=(0,u.useState)("nodejs"),ge=c()(xe,2),he=ge[0],me=ge[1],je=(0,u.useRef)(null),Pe=(0,u.useState)(0),ve=c()(Pe,2),ye=ve[0],ke=ve[1];(0,R.Z)(je,(function(e){var n,t=null===(n=e.target)||void 0===n||null===(n=n.parentElement)||void 0===n||null===(n=n.parentElement)||void 0===n||null===(n=n.parentElement)||void 0===n?void 0:n.offsetHeight,i=113;ne.length&&(i+=53),t&&ye!==t-i&&ke(t-i)}));var Se=function(e){k(!0),q.W.get("".concat(I.Z.apiPrefix,"dependencies?searchValue=").concat(re,"&type=").concat(he,"&status=").concat(e||"")).then((function(e){var n=e.code,t=e.data;200===n&&f(t)})).finally((function(){return k(!1)}))},we=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];g.Z.confirm({title:o.ZP.get("确认删除"),content:(0,H.jsxs)(H.Fragment,{children:[o.ZP.get("确认删除依赖")," ",(0,H.jsx)(V,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",o.ZP.get("吗")]}),onOk:function(){q.W.delete("".concat(I.Z.apiPrefix,"dependencies").concat(t?"/force":""),{data:[e.id]}).then((function(e){var n=e.code,i=e.data;if(200===n&&t){var r=d.findIndex((function(e){return e.id===i[0].id}));if(-1!==r){var c=a()(d);c.splice(r,1),f(c)}}}))}})},be=function(e,n){g.Z.confirm({title:o.ZP.get("确认重新安装"),content:(0,H.jsxs)(H.Fragment,{children:[o.ZP.get("确认重新安装")," ",(0,H.jsx)(V,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",o.ZP.get("吗")]}),onOk:function(){q.W.put("".concat(I.Z.apiPrefix,"dependencies/reinstall"),[e.id]).then((function(e){var n=e.code,t=e.data;200===n&&De(t[0])}))}})},Ce=function(e){g.Z.confirm({title:o.ZP.get("确认取消安装"),content:(0,H.jsxs)(H.Fragment,{children:[o.ZP.get("确认取消安装")," ",(0,H.jsx)(V,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",o.ZP.get("吗")]}),onOk:function(){q.W.put("".concat(I.Z.apiPrefix,"dependencies/cancel"),[e.id]).then((function(){Se()}))}})},De=function(e){var n=a()(d);if(Array.isArray(e))n.unshift.apply(n,a()(e));else{var t=d.findIndex((function(n){return n.id===e.id}));-1!==t&&n.splice(t,1,s()({},e))}f(n)},Ie={selectedRowKeys:ne,onChange:function(e){te(e)}},Fe=function(e){var n=e?"/force":"";g.Z.confirm({title:o.ZP.get("确认删除"),content:(0,H.jsx)(H.Fragment,{children:o.ZP.get("确认删除选中的依赖吗")}),onOk:function(){q.W.delete("".concat(I.Z.apiPrefix,"dependencies").concat(n),{data:ne}).then((function(e){var n=e.code;e.data;200===n&&(te([]),Se())}))}})};(0,u.useEffect)((function(){Se()}),[re,he]),(0,u.useEffect)((function(){oe&&(localStorage.setItem("logDependence",oe.id),Ze(!0))}),[oe]);var qe=(0,u.useCallback)((function(e){var n=e.message,t=e.references,i=void 0;n.includes("开始时间")&&t.length>0&&(i=n.includes("安装")?E.Status.安装中:E.Status.删除中),n.includes("结束时间")&&t.length>0&&(i=n.includes("安装")?n.includes("成功")?E.Status.已安装:E.Status.安装失败:n.includes("成功")?E.Status.已删除:E.Status.删除失败)===E.Status.已删除?setTimeout((function(){f((function(e){for(var n=a()(e),i=function(i){var a=e.findIndex((function(e){return e.id===t[i]}));-1!==a&&n.splice(a,1)},r=0;r<t.length;r++)i(r);return n}))}),300):"number"==typeof i&&f((function(e){for(var n=a()(e),r=function(a){var r=e.findIndex((function(e){return e.id===t[a]}));-1!==r&&n.splice(r,1,s()(s()({},e[r]),{},{status:i}))},c=0;c<t.length;c++)r(c);return n}))}),[]);(0,u.useEffect)((function(){var e=z.Z.getInstance();return e.subscribe("installDependence",qe),e.subscribe("uninstallDependence",qe),function(){e.unsubscribe("installDependence",qe),e.unsubscribe("uninstallDependence",qe)}}),[]);var We=(0,H.jsxs)("div",{ref:je,children:[ne.length>0&&(0,H.jsxs)("div",{style:{marginBottom:16},children:[(0,H.jsx)(h.Z,{type:"primary",style:{marginBottom:5,marginLeft:8},onClick:function(){g.Z.confirm({title:o.ZP.get("确认重新安装"),content:(0,H.jsx)(H.Fragment,{children:o.ZP.get("确认重新安装选中的依赖吗")}),onOk:function(){q.W.put("".concat(I.Z.apiPrefix,"dependencies/reinstall"),ne).then((function(e){var n=e.code;e.data,200===n&&(te([]),Se())}))}})},children:o.ZP.get("批量安装")}),(0,H.jsx)(h.Z,{type:"primary",style:{marginBottom:5,marginLeft:8},onClick:function(){return Fe(!1)},children:o.ZP.get("批量删除")}),(0,H.jsx)(h.Z,{type:"primary",style:{marginBottom:5,marginLeft:8},onClick:function(){return Fe(!0)},children:o.ZP.get("批量强制删除")}),(0,H.jsxs)("span",{style:{marginLeft:8},children:[o.ZP.get("已选择"),(0,H.jsx)("a",{children:null==ne?void 0:ne.length}),o.ZP.get("项")]})]}),(0,H.jsx)(A.W,{backend:B.PD,children:(0,H.jsx)(m.Z,{columns:i,rowSelection:Ie,pagination:!1,dataSource:d,rowKey:"id",size:"middle",scroll:{x:768,y:ye},loading:y,onChange:function(e,n){Se(null==n?void 0:n.status)}})})]});return(0,H.jsxs)(F.ZP,{className:"ql-container-wrapper dependence-wrapper ql-container-wrapper-has-tab",title:o.ZP.get("依赖管理"),extra:[(0,H.jsx)(M,{placeholder:o.ZP.get("请输入名称"),style:{width:"auto"},enterButton:!0,loading:y,onSearch:function(e){ce(e.trim())}}),(0,H.jsx)(h.Z,{type:"primary",onClick:function(){return X(null),void G(!0)},children:o.ZP.get("创建依赖")},"2")],header:{style:n},children:[(0,H.jsx)(j.Z,{defaultActiveKey:"nodejs",size:"small",tabPosition:"top",destroyInactiveTabPane:!0,onChange:function(e){te([]),me(e)},items:[{key:"nodejs",label:"NodeJs"},{key:"python3",label:"Python3"},{key:"linux",label:"Linux"}]}),We,N&&(0,H.jsx)(W.default,{handleCancel:function(e){G(!1),e&&De(e)},dependence:Q,defaultType:he}),oe&&pe&&(0,H.jsx)(O.default,{handleCancel:function(e){if(Ze(!1),e){var n=d.findIndex((function(e){return e.id===oe.id})),t=a()(d);-1!==n&&(t.splice(n,1),f(t))}else a()(d).map((function(e){return e.id})).includes(oe.id)&&function(e){q.W.get("".concat(I.Z.apiPrefix,"dependencies/").concat(e.id)).then((function(n){var t=n.code,i=n.data;if(200===t){var r=d.findIndex((function(n){return n.id===e.id})),c=a()(d);-1!==r&&(c.splice(r,1,s()(s()({},e),i)),f(c))}})).finally((function(){return k(!1)}))}(oe)},dependence:oe})]})}},77831:function(e,n,t){t.r(n);var i=t(90228),a=t.n(i),r=t(26068),c=t.n(r),l=t(87999),s=t.n(l),o=t(48305),u=t.n(o),d=t(72317),f=t(75271),p=t(35181),Z=t(72338),x=t(45520),g=t(94747),h=t(17082),m=t(16314),j=t(3475),P=t(52676),v=p.Z.Option,y=function(e){return e[e.nodejs=0]="nodejs",e[e.python3=1]="python3",e[e.linux=2]="linux",e}(y||{});n.default=function(e){var n=e.dependence,t=e.handleCancel,i=e.defaultType,r=Z.Z.useForm(),l=u()(r,1)[0],o=(0,f.useState)(!1),k=u()(o,2),S=k[0],w=k[1],b=function(){var e=s()(a()().mark((function e(i){var r,l,s,o,u,d,f,p,Z,x;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),r=i.name,l=i.split,s=i.type,o=i.remark,u=n?"put":"post",n?d=c()(c()({},i),{},{id:n.id}):"1"===l?(f=r.includes("&")?"&":"\n",d=r.split(f).map((function(e){return{name:e,type:s,remark:o}}))):d=[{name:r,type:s,remark:o}],e.prev=4,e.next=7,m.W[u]("".concat(j.Z.apiPrefix,"dependencies"),d);case 7:p=e.sent,Z=p.code,x=p.data,200===Z&&t(x),w(!1),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),w(!1);case 17:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(n){return e.apply(this,arguments)}}();return(0,P.jsx)(x.Z,{title:n?d.ZP.get("编辑依赖"):d.ZP.get("创建依赖"),open:!0,forceRender:!0,centered:!0,maskClosable:!1,onOk:function(){l.validateFields().then((function(e){b(e)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){return t()},confirmLoading:S,children:(0,P.jsxs)(Z.Z,{form:l,layout:"vertical",name:"dependence_modal",initialValues:n,children:[(0,P.jsx)(Z.Z.Item,{name:"type",label:d.ZP.get("依赖类型"),initialValue:y[i],children:(0,P.jsx)(p.Z,{children:j.Z.dependenceTypes.map((function(e,n){return(0,P.jsx)(v,{value:n,children:e},n)}))})}),!n&&(0,P.jsx)(Z.Z.Item,{name:"split",label:d.ZP.get("自动拆分"),initialValue:"0",tooltip:d.ZP.get("多个依赖是否换行分割"),children:(0,P.jsxs)(g.ZP.Group,{children:[(0,P.jsx)(g.ZP,{value:"1",children:d.ZP.get("是")}),(0,P.jsx)(g.ZP,{value:"0",children:d.ZP.get("否")})]})}),(0,P.jsx)(Z.Z.Item,{name:"name",label:d.ZP.get("名称"),rules:[{required:!0,message:d.ZP.get("请输入依赖名称，支持指定版本"),whitespace:!0}],children:(0,P.jsx)(h.Z.TextArea,{rows:4,autoSize:{minRows:1,maxRows:5},placeholder:d.ZP.get("请输入依赖名称")})}),(0,P.jsx)(Z.Z.Item,{name:"remark",label:d.ZP.get("备注"),children:(0,P.jsx)(h.Z,{placeholder:d.ZP.get("请输入备注")})})]})})}}}]);