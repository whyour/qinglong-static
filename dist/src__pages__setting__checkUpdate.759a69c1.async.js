(self.webpackChunk=self.webpackChunk||[]).push([[3830],{78008:function(t,e,n){"use strict";n.r(e);var i=n(54306),o=n.n(i),r=n(40141),s=n(15207),c=n(57229),a=n(21758),u=n(99120),l=n.n(u),f=n(89065),h=n(9835),d=n(84163),p=n(24378),v=n(63313),m=n(88265),g=n(11527),k=f.Z.Countdown;e.default=function(t){var e=t.systemInfo,n=(0,v.useState)(!1),i=o()(n,2),u=i[0],f=i[1],b=(0,v.useState)(""),y=o()(b,2),x=y[0],Z=y[1],P=(0,v.useRef)(),w=function(t){d.Z.confirm({width:500,title:m.ZP.get("更新"),content:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{children:m.ZP.get("已经是最新版了！")}),(0,g.jsxs)("div",{style:{fontSize:12,fontWeight:400,marginTop:5},children:[m.ZP.get("青龙")," ",t.lastVersion," ",m.ZP.get("是目前检测到的最新可用版本了。")]})]}),okText:m.ZP.get("重新下载"),onOk:function(){S(),c.W.put("".concat(s.Z.apiPrefix,"system/update")).then((function(t){})).catch((function(t){console.log(t)}))}})},C=function(t){var n=t.lastVersion,i=t.lastLog;d.Z.confirm({width:500,title:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{children:m.ZP.get("更新可用")}),(0,g.jsxs)("div",{style:{fontSize:12,fontWeight:400,marginTop:5},children:[m.ZP.get("新版本")," ",n," ",m.ZP.get("可用，你使用的版本为")," ",e.version,"。"]})]}),content:(0,g.jsx)("pre",{children:(0,g.jsx)(l(),{children:i})}),okText:m.ZP.get("下载更新"),cancelText:m.ZP.get("以后再说"),onOk:function(){S(),c.W.put("".concat(s.Z.apiPrefix,"system/update")).then((function(t){})).catch((function(t){console.log(t)}))}})},S=function(){Z(""),P.current=d.Z.info({width:600,maskClosable:!1,closable:!1,keyboard:!1,okButtonProps:{disabled:!0},title:m.ZP.get("下载更新中..."),centered:!0,content:(0,g.jsx)("pre",{children:(0,g.jsx)(l(),{children:x})})})},E=function(t){c.W.put("".concat(s.Z.apiPrefix,"update/").concat(t)).then((function(t){h.ZP.success({content:(0,g.jsxs)("span",{children:[m.ZP.get("系统将在"),(0,g.jsx)(k,{className:"inline-countdown",format:"ss",value:Date.now()+3e4}),m.ZP.get("秒后自动刷新")]}),duration:30}),(0,r.o4)(),setTimeout((function(){window.location.reload()}),3e4)})).catch((function(t){console.log(t)}))};(0,v.useEffect)((function(){if(x){var t=x.includes("失败，请检查");P.current.update({maskClosable:t,closable:t,okButtonProps:{disabled:!t},content:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("pre",{children:(0,g.jsx)(l(),{children:x})}),(0,g.jsx)("div",{id:"log-identifier",style:{paddingBottom:5}})]})})}}),[x]);var j=(0,v.useCallback)((function(t){var e=t.message;e.includes("失败，请检查")&&h.ZP.error(m.ZP.get("更新失败，请检查网络及日志或稍后再试")),setTimeout((function(){document.querySelector("#log-identifier").scrollIntoView({behavior:"smooth"})}),600),e.includes("更新包下载成功")&&setTimeout((function(){d.Z.confirm({width:600,maskClosable:!1,title:m.ZP.get("确认重启"),centered:!0,content:m.ZP.get("系统安装包下载成功，确认重启"),okText:m.ZP.get("重启"),onOk:function(){E("system")},onCancel:function(){P.current.update({maskClosable:!0,closable:!0,okButtonProps:{disabled:!1}})}})}),1e3),Z((function(t){return"".concat(t).concat(e)}))}),[]);return(0,v.useEffect)((function(){var t=a.Z.getInstance();return t.subscribe("updateSystemVersion",j),function(){t.unsubscribe("updateSystemVersion",j)}}),[]),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(p.Z,{type:"primary",onClick:function(){u||(f(!0),h.ZP.loading(m.ZP.get("检查更新中..."),0),c.W.put("".concat(s.Z.apiPrefix,"system/update-check")).then((function(t){var e=t.code,n=t.data;h.ZP.destroy(),200===e&&(n.hasNewVersion?C(n):w(n))})).catch((function(t){h.ZP.destroy(),console.log(t)})).finally((function(){f(!1)})))},children:m.ZP.get("检查更新")}),(0,g.jsx)(p.Z,{type:"primary",onClick:function(){return E("reload")},style:{marginLeft:8},children:m.ZP.get("重新启动")})]})}},21758:function(t,e,n){"use strict";var i=n(93525),o=n.n(i),r=n(12342),s=n.n(r),c=n(25359),a=n.n(c),u=n(49811),l=n.n(u),f=n(21140),h=n.n(f),d=n(63466),p=n.n(d),v=n(52510),m=n.n(v),g=n(78078),k=n.n(g),b=["type"],y=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h()(this,t),m()(this,"url",void 0),m()(this,"socket",null),m()(this,"subscriptions",new Map),m()(this,"options",void 0),m()(this,"reconnectAttempts",0),m()(this,"heartbeatTimeout",null),m()(this,"state","closed"),this.url=e,this.options={maxReconnectAttempts:n.maxReconnectAttempts||5,reconnectInterval:n.reconnectInterval||3e3,heartbeatInterval:n.heartbeatInterval||3e4},this.init()}var e,n;return p()(t,[{key:"init",value:(n=l()(a()().mark((function t(){var e=this;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,this.state="connecting",this.emit("connecting");case 3:if(!(this.reconnectAttempts<this.options.maxReconnectAttempts)){t.next=16;break}return this.socket=new(k())(this.url),this.setupEventListeners(),this.startHeartbeat(),t.next=9,this.waitForClose();case 9:return this.stopHeartbeat(),this.socket=null,this.reconnectAttempts++,t.next=14,new Promise((function(t){return setTimeout(t,e.options.reconnectInterval)}));case 14:t.next=3;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),this.handleError(t.t0);case 21:case"end":return t.stop()}}),t,this,[[0,18]])}))),function(){return n.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var t=this;this.socket&&(this.socket.onopen=function(){t.state="open",t.emit("open")},this.socket.onmessage=function(e){var n=JSON.parse(e.data);t.dispatchMessage(n)},this.socket.onclose=function(){t.state="closed",t.emit("close")})}},{key:"waitForClose",value:(e=l()(a()().mark((function t(){var e;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((null===(e=this.socket)||void 0===e?void 0:e.readyState)===k().CLOSED){t.next=5;break}return t.next=3,new Promise((function(t){return setTimeout(t,100)}));case 3:t.next=0;break;case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"subscribe",value:function(t,e){var n=this.subscriptions.get(t)||new Set;if(!n.has(e)){n.add(e),this.subscriptions.set(t,n);var i={action:"subscribe",topic:t};this.send(i)}}},{key:"unsubscribe",value:function(t,e){var n=this.subscriptions.get(t)||new Set;if(n.has(e)){n.delete(e);var i={action:"unsubscribe",topic:t};this.send(i)}}},{key:"send",value:function(t){var e;(null===(e=this.socket)||void 0===e?void 0:e.readyState)===k().OPEN&&this.socket.send(JSON.stringify(t))}},{key:"dispatchMessage",value:function(t){var e=t.type,n=s()(t,b),i=this.subscriptions.get(e)||new Set;o()(i).forEach((function(t){return t(n)}))}},{key:"startHeartbeat",value:function(){var t=this;this.heartbeatTimeout=setInterval((function(){var e;(null===(e=t.socket)||void 0===e?void 0:e.readyState)===k().OPEN&&t.socket.send(JSON.stringify({type:"heartbeat"}))}),this.options.heartbeatInterval)}},{key:"stopHeartbeat",value:function(){this.heartbeatTimeout&&clearInterval(this.heartbeatTimeout)}},{key:"close",value:function(){this.socket&&(this.state="closed",this.stopHeartbeat(),this.socket.close(),this.emit("close"))}},{key:"handleError",value:function(t){console.error("WebSocket错误:",t),this.emit("error",t)}},{key:"on",value:function(t,e){}},{key:"emit",value:function(t,e){}}],[{key:"getInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return t.instance||(t.instance=new t(e,n)),t.instance}}]),t}();m()(y,"instance",null),e.Z=y},92235:function(t,e,n){"use strict";n.d(e,{Z:function(){return r}});var i=n(41171),o=n(63313);function r(){var t=o.useReducer((function(t){return t+1}),0);return(0,i.Z)(t,2)[1]}},16082:function(t,e,n){"use strict";n.d(e,{mL:function(){return a},q0:function(){return c}});var i=function(){return{height:0,opacity:0}},o=function(t){return{height:t.scrollHeight,opacity:1}},r=function(t,e){return!0===(null==e?void 0:e.deadline)||"height"===e.propertyName},s={motionName:"ant-motion-collapse",onAppearStart:i,onEnterStart:i,onAppearActive:o,onEnterActive:o,onLeaveStart:function(t){return{height:t?t.offsetHeight:0}},onLeaveActive:i,onAppearEnd:r,onEnterEnd:r,onLeaveEnd:r,motionDeadline:500},c=((0,n(20341).b)("bottomLeft","bottomRight","topLeft","topRight"),function(t){return void 0===t||"topLeft"!==t&&"topRight"!==t?"slide-up":"slide-down"}),a=function(t,e,n){return void 0!==n?n:"".concat(t,"-").concat(e)};e.ZP=s},76737:function(t,e,n){"use strict";n.d(e,{RV:function(){return u},Rk:function(){return l},Ux:function(){return h},aM:function(){return f},q3:function(){return c},qI:function(){return a}});var i=n(88028),o=n(14542),r=n(54331),s=n(63313),c=s.createContext({labelAlign:"right",vertical:!1,itemRef:function(){}}),a=s.createContext(null),u=function(t){var e=(0,r.Z)(t,["prefixCls"]);return s.createElement(o.FormProvider,(0,i.Z)({},e))},l=s.createContext({prefixCls:""}),f=s.createContext({}),h=function(t){var e=t.children,n=t.status,o=t.override,r=(0,s.useContext)(f),c=(0,s.useMemo)((function(){var t=(0,i.Z)({},r);return o&&delete t.isFormItemInput,n&&(delete t.status,delete t.hasFeedback,delete t.feedbackIcon),t}),[n,o,r]);return s.createElement(f.Provider,{value:c},e)}},24669:function(t){var e=Array.isArray;t.exports=e},12334:function(t,e,n){"use strict";n.d(e,{o:function(){return s}});var i=n(63313),o=(0,n(46594).Z)()?i.useLayoutEffect:i.useEffect,r=function(t,e){var n=i.useRef(!0);o((function(){return t(n.current)}),e),o((function(){return n.current=!1,function(){n.current=!0}}),[])},s=function(t,e){r((function(e){if(!e)return t()}),e)};e.Z=r}}]);