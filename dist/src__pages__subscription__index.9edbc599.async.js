"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7953],{49385:function(e,t){t.Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"}}]},name:"clock-circle",theme:"outlined"}},44084:function(e,t,n){var r=n(2053),i=n(75271),c=n(15618),o=n(48881),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:c.Z}))},s=i.forwardRef(a);t.Z=s},15631:function(e,t,n){var r=n(2053),i=n(75271),c=n(49385),o=n(48881),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:c.Z}))},s=i.forwardRef(a);t.Z=s},86935:function(e,t,n){var r=n(2053),i=n(75271),c=n(22260),o=n(48881),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:c.Z}))},s=i.forwardRef(a);t.Z=s},88939:function(e,t,n){var r=n(2053),i=n(75271),c=n(19579),o=n(48881),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:c.Z}))},s=i.forwardRef(a);t.Z=s},28423:function(e,t,n){var r=n(2053),i=n(75271),c=n(17338),o=n(48881),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:c.Z}))},s=i.forwardRef(a);t.Z=s},97953:function(e,t,n){var r=n(2053),i=n(75271),c=n(38930),o=n(48881),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:c.Z}))},s=i.forwardRef(a);t.Z=s},56958:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(2053),i=n(75271),c={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 1024c-69.1 0-136.2-13.5-199.3-40.2C251.7 958 197 921 150 874c-47-47-84-101.7-109.8-162.7C13.5 648.2 0 581.1 0 512c0-19.9 16.1-36 36-36s36 16.1 36 36c0 59.4 11.6 117 34.6 171.3 22.2 52.4 53.9 99.5 94.3 139.9 40.4 40.4 87.5 72.2 139.9 94.3C395 940.4 452.6 952 512 952c59.4 0 117-11.6 171.3-34.6 52.4-22.2 99.5-53.9 139.9-94.3 40.4-40.4 72.2-87.5 94.3-139.9C940.4 629 952 571.4 952 512c0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.2C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3s-13.5 136.2-40.2 199.3C958 772.3 921 827 874 874c-47 47-101.8 83.9-162.7 109.7-63.1 26.8-130.2 40.3-199.3 40.3z"}}]},name:"loading-3-quarters",theme:"outlined"},o=n(48881),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:c}))};var s=i.forwardRef(a)},1704:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(2053),i=n(75271),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"},o=n(48881),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:c}))};var s=i.forwardRef(a)},30502:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(75271);var i=r["undefined"!=typeof document&&void 0!==document.createElement?"useLayoutEffect":"useEffect"];var c=e=>{const t=r.useRef(e);return r.useEffect((()=>{t.current=e})),t};function o(){}let a;const s=e=>a||(a=function(e){let t=!1,n=[];const r=new Map,i=new(e||window.ResizeObserver)(((e,i)=>{n=n.concat(e),t||window.requestAnimationFrame((function(){const e=new Set;for(let t=0;t<n.length;t++){if(e.has(n[t].target))continue;e.add(n[t].target);const c=r.get(n[t].target);null==c||c.forEach((e=>e(n[t],i)))}n=[],t=!1})),t=!0}));return{observer:i,subscribe(e,t){var n;i.observe(e);const c=null!==(n=r.get(e))&&void 0!==n?n:[];c.push(t),r.set(e,c)},unsubscribe(e,t){var n;const c=null!==(n=r.get(e))&&void 0!==n?n:[];if(1===c.length)return i.unobserve(e),void r.delete(e);const o=c.indexOf(t);-1!==o&&c.splice(o,1),r.set(e,c)}}}(e));var l=function(e,t,n={}){const r=s(n.polyfill),a=c(t);return i((()=>{let t=!1;const n=e&&"current"in e?e.current:e;if(!n)return o;function i(e,n){t||a.current(e,n)}return r.subscribe(n,i),()=>{t=!0,r.unsubscribe(n,i)}}),[e,r,a]),r.observer}},72439:function(e,t,n){var r=n(48305),i=n.n(r),c=n(75271),o=n(30502),a=n(52076);t.Z=function(e,t){var n=(0,c.useState)(0),r=i()(n,2),s=r[0],l=r[1];return(0,o.Z)(e,(function(e){var n=e.target;n.classList.contains("ant-table-wrapper")||(n=e.target.querySelector(".ant-table-wrapper")),l((0,a.W9)({extraHeight:t,target:n}))})),s}},95921:function(e,t,n){n.r(t),n.d(t,{IntervalSchedule:function(){return H},SubscriptionStatus:function(){return A},SubscriptionType:function(){return q},default:function(){return D}});var r=n(15558),i=n.n(r),c=n(48305),o=n.n(c),a=n(26068),s=n.n(a),l=n(72317),u=n(75271),f=n(50691),d=n(17082),p=n(47667),h=n(63505),g=n(45520),v=n(32253),b=n(61508),m=n(85950),Z=n(93481),x=n(10948),y=n(15631),k=n(56958),P=n(86935),w=n(28423),C=n(44084),S=n(1704),j=n(88939),E=n(97953),O=n(3475),I=n(47508),R=n(16314),z=n(23191),N=n(98783),_=n(1558),F=n(72439),T=n(65814),B=n(52676),W=f.Z.Text,L=f.Z.Paragraph,M=d.Z.Search,A=function(e){return e[e.running=0]="running",e[e.idle=1]="idle",e[e.disabled=2]="disabled",e[e.queued=3]="queued",e}({}),H=function(e){return e.days="天",e.hours="时",e.minutes="分",e.seconds="秒",e}({}),q=function(e){return e["private-repo"]="私有仓库",e["public-repo"]="公开仓库",e.file="单文件",e}({}),D=function(){var e=(0,N.useOutletContext)(),t=e.headerStyle,n=e.isPhone,r=[{title:l.ZP.get("名称"),dataIndex:"name",key:"name",width:150,sorter:{compare:function(e,t){return e.name.localeCompare(t.name)},multiple:2}},{title:l.ZP.get("链接"),dataIndex:"url",key:"url",sorter:{compare:function(e,t){return e.name.localeCompare(t.name)},multiple:2},render:function(e,t){return(0,B.jsx)(L,{style:{wordBreak:"break-all",marginBottom:0},ellipsis:{tooltip:e,rows:2},children:e})}},{title:l.ZP.get("类型"),dataIndex:"type",key:"type",width:130,render:function(e,t){return q[t.type]}},{title:l.ZP.get("分支"),dataIndex:"branch",key:"branch",width:130,render:function(e,t){return t.branch||"-"}},{title:l.ZP.get("定时规则"),width:180,render:function(e,t){if("interval"===t.schedule_type){var n=t.interval_schedule,r=n.type,i=n.value;return"每".concat(i).concat(H[r])}return t.schedule}},{title:l.ZP.get("状态"),key:"status",dataIndex:"status",width:110,filters:[{text:l.ZP.get("运行中"),value:0},{text:l.ZP.get("空闲中"),value:1},{text:l.ZP.get("已禁用"),value:2}],onFilter:function(e,t){return t.is_disabled&&0!==t.status?2===e:t.status===e},render:function(e,t){return(0,B.jsxs)(B.Fragment,{children:[(!t.is_disabled||t.status!==A.idle)&&(0,B.jsxs)(B.Fragment,{children:[t.status===A.idle&&(0,B.jsx)(p.Z,{icon:(0,B.jsx)(y.Z,{}),color:"default",children:l.ZP.get("空闲中")}),t.status===A.running&&(0,B.jsx)(p.Z,{icon:(0,B.jsx)(k.Z,{spin:!0}),color:"processing",children:l.ZP.get("运行中")})]}),1===t.is_disabled&&t.status===A.idle&&(0,B.jsx)(p.Z,{icon:(0,B.jsx)(P.Z,{}),color:"error",children:l.ZP.get("已禁用")})]})}},{title:l.ZP.get("操作"),key:"action",width:140,render:function(e,t,n){return(0,B.jsxs)(h.Z,{size:"middle",children:[t.status===A.idle&&(0,B.jsx)("a",{onClick:function(e){e.stopPropagation(),Ce(t,n)},children:l.ZP.get("运行")}),t.status!==A.idle&&(0,B.jsx)("a",{onClick:function(e){e.stopPropagation(),Se(t,n)},children:l.ZP.get("停止")}),(0,B.jsx)("a",{onClick:function(e){e.stopPropagation(),ye(s()(s()({},t),{},{timestamp:Date.now()}))},children:l.ZP.get("日志")}),(0,B.jsx)(Ee,{record:t,index:n},"more")]})}}],c=(0,u.useState)([]),a=o()(c,2),f=a[0],d=a[1],D=(0,u.useState)(!0),$=o()(D,2),J=$[0],V=$[1],K=(0,u.useState)(!1),U=o()(K,2),Y=U[0],G=U[1],Q=(0,u.useState)(),X=o()(Q,2),ee=X[0],te=X[1],ne=(0,u.useState)(""),re=o()(ne,2),ie=re[0],ce=re[1],oe=(0,u.useState)(1),ae=o()(oe,2),se=ae[0],le=ae[1],ue=(0,u.useState)(20),fe=o()(ue,2),de=fe[0],pe=fe[1],he=(0,u.useState)(!1),ge=o()(he,2),ve=ge[0],be=ge[1],me=(0,u.useState)(),Ze=o()(me,2),xe=Ze[0],ye=Ze[1],ke=(0,u.useRef)(null),Pe=(0,F.Z)(ke),we=(0,u.useRef)(!1),Ce=function(e,t){g.Z.confirm({title:l.ZP.get("确认运行"),content:(0,B.jsxs)(B.Fragment,{children:[l.ZP.get("确认运行定时任务")," ",(0,B.jsx)(W,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗")]}),onOk:function(){R.W.put("".concat(O.Z.apiPrefix,"subscriptions/run"),[e.id]).then((function(t){var n=t.code;t.data;if(200===n){var r=i()(f),c=r.findIndex((function(t){return t.id===e.id}));-1!==c&&(r.splice(c,1,s()(s()({},e),{},{status:A.running})),d(r))}}))},onCancel:function(){console.log("Cancel")}})},Se=function(e,t){g.Z.confirm({title:l.ZP.get("确认停止"),content:(0,B.jsxs)(B.Fragment,{children:[l.ZP.get("确认停止定时任务")," ",(0,B.jsx)(W,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗")]}),onOk:function(){R.W.put("".concat(O.Z.apiPrefix,"subscriptions/stop"),[e.id]).then((function(t){var n=t.code;t.data;if(200===n){var r=i()(f),c=r.findIndex((function(t){return t.id===e.id}));-1!==c&&(r.splice(c,1,s()(s()({},e),{},{pid:null,status:A.idle})),d(r))}}))},onCancel:function(){console.log("Cancel")}})},je=function(e){we.current=e.target.checked},Ee=function(e){var t=e.record,n=e.index;return(0,B.jsx)(m.Z,{placement:"bottomRight",trigger:["click"],menu:{items:[{label:l.ZP.get("编辑"),key:"edit",icon:(0,B.jsx)(w.Z,{})},{label:1===t.is_disabled?l.ZP.get("启用"):l.ZP.get("禁用"),key:"enableOrDisable",icon:1===t.is_disabled?(0,B.jsx)(C.Z,{}):(0,B.jsx)(S.Z,{})},{label:l.ZP.get("删除"),key:"delete",icon:(0,B.jsx)(j.Z,{})}],onClick:function(e){var r=e.key;e.domEvent.stopPropagation(),Oe(r,t,n)}},children:(0,B.jsx)("a",{onClick:function(e){return e.stopPropagation()},children:(0,B.jsx)(E.Z,{})})})},Oe=function(e,t,n){switch(e){case"edit":!function(e,t){te(e),G(!0)}(t);break;case"enableOrDisable":!function(e,t){g.Z.confirm({title:"确认".concat(1===e.is_disabled?l.ZP.get("启用"):l.ZP.get("禁用")),content:(0,B.jsxs)(B.Fragment,{children:[l.ZP.get("确认"),1===e.is_disabled?l.ZP.get("启用"):l.ZP.get("禁用"),l.ZP.get("定时订阅")," ",(0,B.jsx)(W,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗")]}),onOk:function(){R.W.put("".concat(O.Z.apiPrefix,"subscriptions/").concat(1===e.is_disabled?"enable":"disable"),[e.id]).then((function(t){var n=t.code;if(t.data,200===n){var r=1===e.is_disabled?0:1,c=i()(f),o=c.findIndex((function(t){return t.id===e.id}));-1!==o&&(c.splice(o,1,s()(s()({},e),{},{is_disabled:r})),d(c))}}))},onCancel:function(){console.log("Cancel")}})}(t);break;case"delete":!function(e,t){g.Z.confirm({title:l.ZP.get("确认删除"),content:(0,B.jsxs)(B.Fragment,{children:[l.ZP.get("确认删除定时订阅")," ",(0,B.jsx)(W,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗"),(0,B.jsx)("div",{style:{marginTop:20},children:(0,B.jsx)(v.Z,{onChange:je,children:l.ZP.get("同时删除关联任务和脚本")})})]}),onOk:function(){R.W.delete("".concat(O.Z.apiPrefix,"subscriptions"),{data:[e.id],params:{force:we.current}}).then((function(t){var n=t.code;if(t.data,200===n){b.ZP.success(l.ZP.get("删除成功"));var r=i()(f),c=r.findIndex((function(t){return t.id===e.id}));-1!==c&&(r.splice(c,1),d(r))}}))},onCancel:function(){console.log("Cancel")}})}(t)}},Ie=function(e){var t=f.findIndex((function(t){return t.id===e.id})),n=i()(f);-1===t?n.unshift(e):n.splice(t,1,s()({},e)),d(n)},Re=(0,u.useCallback)((function(e){e.message;var t=e.references;d((function(e){for(var n=i()(e),r=function(r){var i=e.findIndex((function(e){return e.id===t[r]}));-1!==i&&n.splice(i,1,s()(s()({},e[i]),{},{status:A.idle}))},c=0;c<t.length;c++)r(c);return n}))}),[]);return(0,u.useEffect)((function(){var e=T.Z.getInstance();return e.subscribe("runSubscriptionEnd",Re),function(){e.unsubscribe("runSubscriptionEnd",Re)}}),[]),(0,u.useEffect)((function(){xe&&(localStorage.setItem("logSubscription",xe.id),be(!0))}),[xe]),(0,u.useEffect)((function(){V(!0),R.W.get("".concat(O.Z.apiPrefix,"subscriptions?searchValue=").concat(ie)).then((function(e){var t=e.code,n=e.data;200===t&&(d(n),le(1))})).finally((function(){return V(!1)}))}),[ie]),(0,u.useEffect)((function(){pe(parseInt(localStorage.getItem("pageSize")||"20"))}),[]),(0,B.jsxs)(I.ZP,{className:"ql-container-wrapper subscriptiontab-wrapper",title:l.ZP.get("订阅管理"),extra:[(0,B.jsx)(M,{placeholder:l.ZP.get("请输入名称或者关键词"),style:{width:"auto"},enterButton:!0,allowClear:!0,loading:J,onSearch:function(e){ce(e.trim())}}),(0,B.jsx)(Z.Z,{type:"primary",onClick:function(){return te(null),void G(!0)},children:l.ZP.get("创建订阅")},"2")],header:{style:t},children:[(0,B.jsx)(x.Z,{ref:ke,columns:r,pagination:{current:se,onChange:function(e,t){le(e),pe(t),localStorage.setItem("pageSize",t+"")},pageSize:de,showSizeChanger:!0,simple:n,defaultPageSize:20,showTotal:function(e,t){return"第 ".concat(t[0],"-").concat(t[1]," 条/总共 ").concat(e," 条")},pageSizeOptions:[20,100,500,1e3]},dataSource:f,rowKey:"id",size:"middle",scroll:{x:1e3,y:Pe},loading:J,rowClassName:function(e,t){return e.isPinned?"pinned-subscription subscription":"subscription"}}),(0,B.jsx)(z.default,{visible:Y,handleCancel:function(e){G(!1),e&&Ie(e)},subscription:ee}),(0,B.jsx)(_.default,{visible:ve,handleCancel:function(){be(!1)},subscription:xe})]})}},1558:function(e,t,n){n.r(t);var r=n(48305),i=n.n(r),c=n(72317),o=n(75271),a=n(45520),s=n(93481),l=n(16314),u=n(3475),f=n(56958),d=n(44084),p=n(34014),h=n(52076),g=n(78060),v=n.n(g),b=n(52676);t.default=function(e){var t=e.subscription,n=e.handleCancel,r=e.visible,g=e.data,m=e.logUrl,Z=(0,o.useState)(c.ZP.get("启动中...")),x=i()(Z,2),y=x[0],k=x[1],P=(0,o.useState)(!0),w=i()(P,2),C=w[0],S=w[1],j=(0,o.useState)(!0),E=i()(j,2),O=E[0],I=E[1],R=(0,o.useState)(!1),z=i()(R,2),N=z[0],_=z[1],F=function e(n){n&&S(!0),l.W.get(m||"".concat(u.Z.apiPrefix,"subscriptions/").concat(t.id,"/log")).then((function(n){var r=n.code,i=n.data;if(200===r&&localStorage.getItem("logSubscription")===String(t.id)){var o=i;k(o||c.ZP.get("暂无日志")),I(o&&!(0,h.x$)(o)),o&&!(0,h.x$)(o)&&setTimeout((function(){e()}),2e3)}})).finally((function(){n&&S(!1)}))},T=function(){localStorage.removeItem("logSubscription"),n()};return(0,o.useEffect)((function(){t&&t.id&&r&&F(!0)}),[t,r]),(0,o.useEffect)((function(){g&&k(g)}),[g]),(0,o.useEffect)((function(){_(document.body.clientWidth<768)}),[]),(0,b.jsx)(a.Z,{title:(0,b.jsxs)(b.Fragment,{children:[(O||C)&&(0,b.jsx)(f.Z,{spin:!0}),!O&&!C&&(0,b.jsx)(d.Z,{}),(0,b.jsx)("span",{style:{marginLeft:5},children:t&&t.name})]}),open:r,centered:!0,className:"log-modal",forceRender:!0,onOk:function(){return T()},onCancel:function(){return T()},footer:[(0,b.jsx)(s.Z,{type:"primary",onClick:function(){return T()},children:c.ZP.get("知道了")})],children:(0,b.jsx)("div",{className:"log-container",children:C?(0,b.jsx)(p.Z,{}):(0,b.jsx)("pre",{style:N?{fontFamily:"Source Code Pro",zoom:.83}:{},children:(0,b.jsx)(v(),{children:y})})})})}},65814:function(e,t,n){var r=n(15558),i=n.n(r),c=n(67825),o=n.n(c),a=n(90228),s=n.n(a),l=n(87999),u=n.n(l),f=n(25298),d=n.n(f),p=n(17069),h=n.n(p),g=n(82092),v=n.n(g),b=n(78078),m=n.n(b),Z=["type"],x=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d()(this,e),v()(this,"url",void 0),v()(this,"socket",null),v()(this,"subscriptions",new Map),v()(this,"options",void 0),v()(this,"reconnectAttempts",0),v()(this,"heartbeatTimeout",null),v()(this,"state","closed"),this.url=t,this.options={maxReconnectAttempts:n.maxReconnectAttempts||5,reconnectInterval:n.reconnectInterval||3e3,heartbeatInterval:n.heartbeatInterval||3e4},this.init()}var t,n;return h()(e,[{key:"init",value:(n=u()(s()().mark((function e(){var t=this;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.state="connecting",this.emit("connecting");case 3:if(!(this.reconnectAttempts<this.options.maxReconnectAttempts)){e.next=16;break}return this.socket=new(m())(this.url),this.setupEventListeners(),this.startHeartbeat(),e.next=9,this.waitForClose();case 9:return this.stopHeartbeat(),this.socket=null,this.reconnectAttempts++,e.next=14,new Promise((function(e){return setTimeout(e,t.options.reconnectInterval)}));case 14:e.next=3;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.handleError(e.t0);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(){return n.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var e=this;this.socket&&(this.socket.onopen=function(){e.state="open",e.emit("open")},this.socket.onmessage=function(t){var n=JSON.parse(t.data);e.dispatchMessage(n)},this.socket.onclose=function(){e.state="closed",e.emit("close")})}},{key:"waitForClose",value:(t=u()(s()().mark((function e(){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=this.socket)||void 0===t?void 0:t.readyState)===m().CLOSED){e.next=5;break}return e.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"subscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(!n.has(t)){n.add(t),this.subscriptions.set(e,n);var r={action:"subscribe",topic:e};this.send(r)}}},{key:"unsubscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(n.has(t)){n.delete(t);var r={action:"unsubscribe",topic:e};this.send(r)}}},{key:"send",value:function(e){var t;(null===(t=this.socket)||void 0===t?void 0:t.readyState)===m().OPEN&&this.socket.send(JSON.stringify(e))}},{key:"dispatchMessage",value:function(e){var t=e.type,n=o()(e,Z),r=this.subscriptions.get(t)||new Set;i()(r).forEach((function(e){return e(n)}))}},{key:"startHeartbeat",value:function(){var e=this;this.heartbeatTimeout=setInterval((function(){var t;(null===(t=e.socket)||void 0===t?void 0:t.readyState)===m().OPEN&&e.socket.send(JSON.stringify({type:"heartbeat"}))}),this.options.heartbeatInterval)}},{key:"stopHeartbeat",value:function(){this.heartbeatTimeout&&clearInterval(this.heartbeatTimeout)}},{key:"close",value:function(){this.socket&&(this.state="closed",this.stopHeartbeat(),this.socket.close(),this.emit("close"))}},{key:"handleError",value:function(e){console.error("WebSocket错误:",e),this.emit("error",e)}},{key:"on",value:function(e,t){}},{key:"emit",value:function(e,t){}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return e.instance||(e.instance=new e(t,n)),e.instance}}]),e}();v()(x,"instance",null),t.Z=x},47667:function(e,t,n){n.d(t,{Z:function(){return y}});var r=n(57904),i=n(2053),c=n(99459),o=n(32324),a=n(82187),s=n.n(a),l=n(2021),u=n(75271),f=n(96820),d=n(1667),p=n(74244),h=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},g=function(e){var t=e.prefixCls,n=e.className,c=e.checked,o=e.onChange,a=e.onClick,l=h(e,["prefixCls","className","checked","onChange","onClick"]),d=(0,u.useContext(f.E_).getPrefixCls)("tag",t),p=s()(d,(0,r.Z)((0,r.Z)({},"".concat(d,"-checkable"),!0),"".concat(d,"-checkable-checked"),c),n);return u.createElement("span",(0,i.Z)({},l,{className:p,onClick:function(e){null==o||o(!c),null==a||a(e)}}))},v=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},b=new RegExp("^(".concat(d.Y.join("|"),")(-inverse)?$")),m=new RegExp("^(".concat(d.E.join("|"),")$")),Z=function(e,t){var n=e.prefixCls,a=e.className,d=e.style,h=e.children,g=e.icon,Z=e.color,x=e.onClose,y=e.closeIcon,k=e.closable,P=void 0!==k&&k,w=v(e,["prefixCls","className","style","children","icon","color","onClose","closeIcon","closable"]),C=u.useContext(f.E_),S=C.getPrefixCls,j=C.direction,E=u.useState(!0),O=(0,c.Z)(E,2),I=O[0],R=O[1];u.useEffect((function(){"visible"in w&&R(w.visible)}),[w.visible]);var z=function(){return!!Z&&(b.test(Z)||m.test(Z))},N=(0,i.Z)({backgroundColor:Z&&!z()?Z:void 0},d),_=z(),F=S("tag",n),T=s()(F,(0,r.Z)((0,r.Z)((0,r.Z)((0,r.Z)({},"".concat(F,"-").concat(Z),_),"".concat(F,"-has-color"),Z&&!_),"".concat(F,"-hidden"),!I),"".concat(F,"-rtl"),"rtl"===j),a),B=function(e){e.stopPropagation(),null==x||x(e),e.defaultPrevented||"visible"in w||R(!1)},W="onClick"in w||h&&"a"===h.type,L=(0,l.Z)(w,["visible"]),M=g||null,A=M?u.createElement(u.Fragment,null,M,u.createElement("span",null,h)):h,H=u.createElement("span",(0,i.Z)({},L,{ref:t,className:T,style:N}),A,P?y?u.createElement("span",{className:"".concat(F,"-close-icon"),onClick:B},y):u.createElement(o.Z,{className:"".concat(F,"-close-icon"),onClick:B}):null);return W?u.createElement(p.Z,null,H):H},x=u.forwardRef(Z);x.CheckableTag=g;var y=x}}]);