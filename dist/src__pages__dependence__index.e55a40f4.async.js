"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9914],{44224:function(e,n,t){var i=(0,t(19919).Z)({scriptUrl:["//at.alicdn.com/t/c/font_3354854_lc939gab1iq.js"]});n.Z=i},43566:function(e,n,t){t.r(n),t.d(n,{default:function(){return N}});var i=t(15558),a=t.n(i),c=t(48305),r=t.n(c),l=t(26068),s=t.n(l),o=t(72317),u=t(75271),d=t(50691),f=t(17082),p=t(63505),Z=t(47667),g=t(59816),x=t(45520),h=t(93481),m=t(10948),v=t(46035),j=t(42483),P=t(44084),y=t(86935),k=t(15631),S=t(37559),b=t(70564),C=t(36053),w=t(88939),D=t(14946),I=t(3475),F=t(47508),W=t(16314),A=t(77831),B=t(78637),O=t(4690),Y=t(8826),q=t(98783),E=t(16483),T=t.n(E),z=t(65814),L=t(57113),R=t(44224),H=t(30502),V=t(52676),M=d.Z.Text,K=f.Z.Search,_={0:{icon:(0,V.jsx)(j.Z,{spin:!0}),color:"processing"},1:{icon:(0,V.jsx)(P.Z,{}),color:"success"},2:{icon:(0,V.jsx)(y.Z,{}),color:"error"},3:{icon:(0,V.jsx)(j.Z,{spin:!0}),color:"processing"},4:{icon:(0,V.jsx)(P.Z,{}),color:"success"},5:{icon:(0,V.jsx)(y.Z,{}),color:"error"},6:{icon:(0,V.jsx)(k.Z,{}),color:"default"},7:{icon:(0,V.jsx)(S.Z,{}),color:"default"}},N=function(){var e=(0,q.useOutletContext)(),n=e.headerStyle,t=e.isPhone,i=[{title:o.ZP.get("序号"),width:90,render:function(e,n,t){return(0,V.jsxs)("span",{style:{cursor:"text"},children:[t+1," "]})}},{title:o.ZP.get("名称"),dataIndex:"name",width:180,key:"name"},{title:o.ZP.get("状态"),key:"status",width:120,dataIndex:"status",filters:[{text:o.ZP.get("队列中"),value:L.DependenceStatus.queued},{text:o.ZP.get("安装中"),value:L.DependenceStatus.installing},{text:o.ZP.get("已安装"),value:L.DependenceStatus.installed},{text:o.ZP.get("安装失败"),value:L.DependenceStatus.installFailed},{text:o.ZP.get("删除中"),value:L.DependenceStatus.removing},{text:o.ZP.get("已删除"),value:L.DependenceStatus.removed},{text:o.ZP.get("删除失败"),value:L.DependenceStatus.removeFailed},{text:o.ZP.get("已取消"),value:L.DependenceStatus.cancelled}],render:function(e,n,t){var i,a;return(0,V.jsx)(p.Z,{size:"middle",style:{cursor:"text"},children:(0,V.jsx)(Z.Z,{color:null===(i=_[n.status])||void 0===i?void 0:i.color,icon:null===(a=_[n.status])||void 0===a?void 0:a.icon,style:{marginRight:0},children:o.ZP.get(L.Status[n.status])})})}},{title:o.ZP.get("备注"),dataIndex:"remark",width:100,key:"remark"},{title:o.ZP.get("更新时间"),key:"updatedAt",dataIndex:"updatedAt",width:150,render:function(e){return(0,V.jsx)("span",{children:T()(e).format("YYYY-MM-DD HH:mm:ss")})}},{title:o.ZP.get("创建时间"),key:"createdAt",dataIndex:"createdAt",width:150,render:function(e){return(0,V.jsx)("span",{children:T()(e).format("YYYY-MM-DD HH:mm:ss")})}},{title:o.ZP.get("操作"),key:"action",width:140,render:function(e,n,i){var a=!t;return(0,V.jsxs)(p.Z,{size:"middle",children:[![L.Status.队列中,L.Status.已取消].includes(n.status)&&(0,V.jsx)(g.Z,{title:a?o.ZP.get("日志"):"",children:(0,V.jsx)("a",{onClick:function(){ue(s()(s()({},n),{},{timestamp:Date.now()}))},children:(0,V.jsx)(b.Z,{})})}),[L.Status.队列中,L.Status.安装中,L.Status.删除中].includes(n.status)?(0,V.jsx)(g.Z,{title:a?o.ZP.get("取消安装"):"",children:(0,V.jsx)("a",{onClick:function(){return we(n)},children:(0,V.jsx)(R.Z,{type:"ql-icon-quxiaoanzhuang"})})}):(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(g.Z,{title:a?o.ZP.get("重新安装"):"",children:(0,V.jsx)("a",{onClick:function(){return Ce(n,i)},children:(0,V.jsx)(C.Z,{})})}),L.Status.已安装===n.status&&(0,V.jsx)(g.Z,{title:a?o.ZP.get("删除"):"",children:(0,V.jsx)("a",{onClick:function(){return be(n,i)},children:(0,V.jsx)(w.Z,{})})}),(0,V.jsx)(g.Z,{title:a?o.ZP.get("强制删除"):"",children:(0,V.jsx)("a",{onClick:function(){return be(n,i,!0)},children:(0,V.jsx)(D.Z,{})})})]})]})}}],c=(0,u.useState)([]),l=r()(c,2),d=l[0],f=l[1],j=(0,u.useState)(!0),P=r()(j,2),y=P[0],k=P[1],S=(0,u.useState)(!1),E=r()(S,2),N=E[0],G=E[1],J=(0,u.useState)(),U=r()(J,2),Q=U[0],X=U[1],$=(0,u.useState)([]),ee=r()($,2),ne=ee[0],te=ee[1],ie=(0,u.useState)(""),ae=r()(ie,2),ce=ae[0],re=ae[1],le=(0,u.useState)(),se=r()(le,2),oe=se[0],ue=se[1],de=(0,u.useState)(!1),fe=r()(de,2),pe=fe[0],Ze=fe[1],ge=(0,u.useState)("nodejs"),xe=r()(ge,2),he=xe[0],me=xe[1],ve=(0,u.useRef)(null),je=(0,u.useState)(0),Pe=r()(je,2),ye=Pe[0],ke=Pe[1];(0,H.Z)(ve,(function(e){var n,t=null===(n=e.target)||void 0===n||null===(n=n.parentElement)||void 0===n||null===(n=n.parentElement)||void 0===n||null===(n=n.parentElement)||void 0===n?void 0:n.offsetHeight,i=113;ne.length&&(i+=53),t&&ye!==t-i&&ke(t-i)}));var Se=function(e){k(!0),W.W.get("".concat(I.Z.apiPrefix,"dependencies?searchValue=").concat(ce,"&type=").concat(he,"&status=").concat(e||"")).then((function(e){var n=e.code,t=e.data;200===n&&f(t)})).finally((function(){return k(!1)}))},be=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];x.Z.confirm({title:o.ZP.get("确认删除"),content:(0,V.jsxs)(V.Fragment,{children:[o.ZP.get("确认删除依赖")," ",(0,V.jsx)(M,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",o.ZP.get("吗")]}),onOk:function(){W.W.delete("".concat(I.Z.apiPrefix,"dependencies").concat(t?"/force":""),{data:[e.id]}).then((function(e){var n=e.code,i=e.data;if(200===n&&t){var c=d.findIndex((function(e){return e.id===i[0].id}));if(-1!==c){var r=a()(d);r.splice(c,1),f(r)}}}))},onCancel:function(){console.log("Cancel")}})},Ce=function(e,n){x.Z.confirm({title:o.ZP.get("确认重新安装"),content:(0,V.jsxs)(V.Fragment,{children:[o.ZP.get("确认重新安装")," ",(0,V.jsx)(M,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",o.ZP.get("吗")]}),onOk:function(){W.W.put("".concat(I.Z.apiPrefix,"dependencies/reinstall"),[e.id]).then((function(e){var n=e.code,t=e.data;200===n&&De(t[0])}))},onCancel:function(){console.log("Cancel")}})},we=function(e){x.Z.confirm({title:o.ZP.get("确认取消安装"),content:(0,V.jsxs)(V.Fragment,{children:[o.ZP.get("确认取消安装")," ",(0,V.jsx)(M,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",o.ZP.get("吗")]}),onOk:function(){W.W.put("".concat(I.Z.apiPrefix,"dependencies/cancel"),[e.id]).then((function(){Se()}))},onCancel:function(){console.log("Cancel")}})},De=function(e){var n=a()(d);if(Array.isArray(e))n.unshift.apply(n,a()(e));else{var t=d.findIndex((function(n){return n.id===e.id}));-1!==t&&n.splice(t,1,s()({},e))}f(n)},Ie={selectedRowKeys:ne,onChange:function(e){te(e)}},Fe=function(e){var n=e?"/force":"";x.Z.confirm({title:o.ZP.get("确认删除"),content:(0,V.jsx)(V.Fragment,{children:o.ZP.get("确认删除选中的依赖吗")}),onOk:function(){W.W.delete("".concat(I.Z.apiPrefix,"dependencies").concat(n),{data:ne}).then((function(e){var n=e.code;e.data;200===n&&(te([]),Se())}))},onCancel:function(){console.log("Cancel")}})};(0,u.useEffect)((function(){Se()}),[ce,he]),(0,u.useEffect)((function(){oe&&(localStorage.setItem("logDependence",oe.id),Ze(!0))}),[oe]);var We=(0,u.useCallback)((function(e){var n=e.message,t=e.references,i=void 0;n.includes("开始时间")&&t.length>0&&(i=n.includes("安装")?L.Status.安装中:L.Status.删除中),n.includes("结束时间")&&t.length>0&&(i=n.includes("安装")?n.includes("成功")?L.Status.已安装:L.Status.安装失败:n.includes("成功")?L.Status.已删除:L.Status.删除失败)===L.Status.已删除?setTimeout((function(){f((function(e){for(var n=a()(e),i=function(i){var a=e.findIndex((function(e){return e.id===t[i]}));-1!==a&&n.splice(a,1)},c=0;c<t.length;c++)i(c);return n}))}),300):"number"==typeof i&&f((function(e){for(var n=a()(e),c=function(a){var c=e.findIndex((function(e){return e.id===t[a]}));-1!==c&&n.splice(c,1,s()(s()({},e[c]),{},{status:i}))},r=0;r<t.length;r++)c(r);return n}))}),[]);(0,u.useEffect)((function(){var e=z.Z.getInstance();return e.subscribe("installDependence",We),e.subscribe("uninstallDependence",We),function(){e.unsubscribe("installDependence",We),e.unsubscribe("uninstallDependence",We)}}),[]);var Ae=(0,V.jsxs)("div",{ref:ve,children:[ne.length>0&&(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsx)(h.Z,{type:"primary",style:{marginBottom:5,marginLeft:8},onClick:function(){x.Z.confirm({title:o.ZP.get("确认重新安装"),content:(0,V.jsx)(V.Fragment,{children:o.ZP.get("确认重新安装选中的依赖吗")}),onOk:function(){W.W.put("".concat(I.Z.apiPrefix,"dependencies/reinstall"),ne).then((function(e){var n=e.code;e.data,200===n&&(te([]),Se())}))},onCancel:function(){console.log("Cancel")}})},children:o.ZP.get("批量安装")}),(0,V.jsx)(h.Z,{type:"primary",style:{marginBottom:5,marginLeft:8},onClick:function(){return Fe(!1)},children:o.ZP.get("批量删除")}),(0,V.jsx)(h.Z,{type:"primary",style:{marginBottom:5,marginLeft:8},onClick:function(){return Fe(!0)},children:o.ZP.get("批量强制删除")}),(0,V.jsxs)("span",{style:{marginLeft:8},children:[o.ZP.get("已选择"),(0,V.jsx)("a",{children:null==ne?void 0:ne.length}),o.ZP.get("项")]})]}),(0,V.jsx)(B.W,{backend:O.PD,children:(0,V.jsx)(m.Z,{columns:i,rowSelection:Ie,pagination:!1,dataSource:d,rowKey:"id",size:"middle",scroll:{x:768,y:ye},loading:y,onChange:function(e,n){Se(null==n?void 0:n.status)}})})]});return(0,V.jsxs)(F.ZP,{className:"ql-container-wrapper dependence-wrapper ql-container-wrapper-has-tab",title:o.ZP.get("依赖管理"),extra:[(0,V.jsx)(K,{placeholder:o.ZP.get("请输入名称"),style:{width:"auto"},enterButton:!0,loading:y,onSearch:function(e){re(e.trim())}}),(0,V.jsx)(h.Z,{type:"primary",onClick:function(){return X(null),void G(!0)},children:o.ZP.get("创建依赖")},"2")],header:{style:n},children:[(0,V.jsx)(v.Z,{defaultActiveKey:"nodejs",size:"small",tabPosition:"top",destroyInactiveTabPane:!0,onChange:function(e){te([]),me(e)},items:[{key:"nodejs",label:"NodeJs"},{key:"python3",label:"Python3"},{key:"linux",label:"Linux"}]}),Ae,(0,V.jsx)(A.default,{visible:N,handleCancel:function(e){G(!1),e&&De(e)},dependence:Q,defaultType:he}),oe&&(0,V.jsx)(Y.default,{visible:pe,handleCancel:function(e){if(Ze(!1),e){var n=d.findIndex((function(e){return e.id===oe.id})),t=a()(d);-1!==n&&(t.splice(n,1),f(t))}else a()(d).map((function(e){return e.id})).includes(oe.id)&&function(e){W.W.get("".concat(I.Z.apiPrefix,"dependencies/").concat(e.id)).then((function(n){var t=n.code,i=n.data;if(200===t){var c=d.findIndex((function(n){return n.id===e.id})),r=a()(d);-1!==c&&(r.splice(c,1,s()(s()({},e),i)),f(r))}})).finally((function(){return k(!1)}))}(oe)},dependence:oe})]})}},77831:function(e,n,t){t.r(n);var i=t(90228),a=t.n(i),c=t(26068),r=t.n(c),l=t(87999),s=t.n(l),o=t(48305),u=t.n(o),d=t(72317),f=t(75271),p=t(35181),Z=t(72338),g=t(45520),x=t(94747),h=t(17082),m=t(16314),v=t(3475),j=t(52676),P=p.Z.Option,y=function(e){return e[e.nodejs=0]="nodejs",e[e.python3=1]="python3",e[e.linux=2]="linux",e}(y||{});n.default=function(e){var n=e.dependence,t=e.handleCancel,i=e.visible,c=e.defaultType,l=Z.Z.useForm(),o=u()(l,1)[0],k=(0,f.useState)(!1),S=u()(k,2),b=S[0],C=S[1],w=function(){var e=s()(a()().mark((function e(i){var c,l,s,o,u,d,f,p,Z,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C(!0),c=i.name,l=i.split,s=i.type,o=i.remark,u=n?"put":"post",n?d=r()(r()({},i),{},{id:n.id}):"1"===l?(f=c.includes("&")?"&":"\n",d=c.split(f).map((function(e){return{name:e,type:s,remark:o}}))):d=[{name:c,type:s,remark:o}],e.prev=4,e.next=7,m.W[u]("".concat(v.Z.apiPrefix,"dependencies"),d);case 7:p=e.sent,Z=p.code,g=p.data,200===Z&&t(g),C(!1),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),C(!1);case 17:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(n){return e.apply(this,arguments)}}();return(0,f.useEffect)((function(){o.resetFields()}),[n,i]),(0,j.jsx)(g.Z,{title:n?d.ZP.get("编辑依赖"):d.ZP.get("创建依赖"),open:i,forceRender:!0,centered:!0,maskClosable:!1,onOk:function(){o.validateFields().then((function(e){w(e)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){return t()},confirmLoading:b,children:(0,j.jsxs)(Z.Z,{form:o,layout:"vertical",name:"dependence_modal",initialValues:n,children:[(0,j.jsx)(Z.Z.Item,{name:"type",label:d.ZP.get("依赖类型"),initialValue:y[c],children:(0,j.jsx)(p.Z,{children:v.Z.dependenceTypes.map((function(e,n){return(0,j.jsx)(P,{value:n,children:e},n)}))})}),!n&&(0,j.jsx)(Z.Z.Item,{name:"split",label:d.ZP.get("自动拆分"),initialValue:"0",tooltip:d.ZP.get("多个依赖是否换行分割"),children:(0,j.jsxs)(x.ZP.Group,{children:[(0,j.jsx)(x.ZP,{value:"1",children:d.ZP.get("是")}),(0,j.jsx)(x.ZP,{value:"0",children:d.ZP.get("否")})]})}),(0,j.jsx)(Z.Z.Item,{name:"name",label:d.ZP.get("名称"),rules:[{required:!0,message:d.ZP.get("请输入依赖名称，支持指定版本"),whitespace:!0}],children:(0,j.jsx)(h.Z.TextArea,{rows:4,autoSize:{minRows:1,maxRows:5},placeholder:d.ZP.get("请输入依赖名称")})}),(0,j.jsx)(Z.Z.Item,{name:"remark",label:d.ZP.get("备注"),children:(0,j.jsx)(h.Z,{placeholder:d.ZP.get("请输入备注")})})]})})}}}]);