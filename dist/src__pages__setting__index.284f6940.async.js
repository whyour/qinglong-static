(self.webpackChunk=self.webpackChunk||[]).push([[2340],{9532:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var r=n(88265),a=n(63313),i=n(92260),o=n(87807),s=n(17079),c=n(18790),l=n(84875),u=n.n(l),d=n(52604),f=n(82259),h=n(25515),m=n(11847),p=function(e){return e.children},g=n(60795);function Z(e){return null!=e}var y=function(e){var t,n=e.itemPrefixCls,r=e.component,i=e.span,s=e.className,c=e.style,l=e.labelStyle,d=e.contentStyle,f=e.bordered,h=e.label,m=e.content,p=e.colon,g=r;return f?a.createElement(g,{className:u()((t={},(0,o.Z)(t,"".concat(n,"-item-label"),Z(h)),(0,o.Z)(t,"".concat(n,"-item-content"),Z(m)),t),s),style:c,colSpan:i},Z(h)&&a.createElement("span",{style:l},h),Z(m)&&a.createElement("span",{style:d},m)):a.createElement(g,{className:u()("".concat(n,"-item"),s),style:c,colSpan:i},a.createElement("div",{className:"".concat(n,"-item-container")},(h||0===h)&&a.createElement("span",{className:u()("".concat(n,"-item-label"),(0,o.Z)({},"".concat(n,"-item-no-colon"),!p)),style:l},h),(m||0===m)&&a.createElement("span",{className:u()("".concat(n,"-item-content")),style:d},m)))};function x(e,t,n){var r=t.colon,i=t.prefixCls,o=t.bordered,s=n.component,c=n.type,l=n.showLabel,u=n.showContent,d=n.labelStyle,f=n.contentStyle;return e.map((function(e,t){var n=e.props,h=n.label,m=n.children,p=n.prefixCls,Z=void 0===p?i:p,x=n.className,v=n.style,P=n.labelStyle,b=n.contentStyle,j=n.span,w=void 0===j?1:j,S=e.key;return"string"==typeof s?a.createElement(y,{key:"".concat(c,"-").concat(S||t),className:x,style:v,labelStyle:(0,g.Z)((0,g.Z)({},d),P),contentStyle:(0,g.Z)((0,g.Z)({},f),b),span:w,colon:r,component:s,itemPrefixCls:Z,bordered:o,label:l?h:null,content:u?m:null}):[a.createElement(y,{key:"label-".concat(S||t),className:x,style:(0,g.Z)((0,g.Z)((0,g.Z)({},d),v),P),span:1,colon:r,component:s[0],itemPrefixCls:Z,bordered:o,label:h}),a.createElement(y,{key:"content-".concat(S||t),className:x,style:(0,g.Z)((0,g.Z)((0,g.Z)({},f),v),b),span:2*w-1,component:s[1],itemPrefixCls:Z,bordered:o,content:m})]}))}var v=function(e){var t=a.useContext(P),n=e.prefixCls,r=e.vertical,i=e.row,o=e.index,s=e.bordered;return r?a.createElement(a.Fragment,null,a.createElement("tr",{key:"label-".concat(o),className:"".concat(n,"-row")},x(i,e,(0,g.Z)({component:"th",type:"label",showLabel:!0},t))),a.createElement("tr",{key:"content-".concat(o),className:"".concat(n,"-row")},x(i,e,(0,g.Z)({component:"td",type:"content",showContent:!0},t)))):a.createElement("tr",{key:o,className:"".concat(n,"-row")},x(i,e,(0,g.Z)({component:s?["th","td"]:"td",type:"item",showLabel:!0,showContent:!0},t)))},P=a.createContext({}),b={xxl:3,xl:3,lg:3,md:3,sm:2,xs:1};function j(e,t,n){var r=e;return(void 0===t||t>n)&&(r=(0,h.Tm)(e,{span:n})),r}function w(e){var t,n=e.prefixCls,r=e.title,i=e.extra,l=e.column,h=void 0===l?b:l,p=e.colon,g=void 0===p||p,Z=e.bordered,y=e.layout,x=e.children,w=e.className,S=e.style,k=e.size,$=e.labelStyle,C=e.contentStyle,M=a.useContext(f.E_),_=M.getPrefixCls,D=M.direction,I=_("descriptions",n),E=a.useState({}),T=(0,s.Z)(E,2),O=T[0],N=T[1],W=function(e,t){if("number"==typeof e)return e;if("object"===(0,c.Z)(e))for(var n=0;n<m.c4.length;n++){var r=m.c4[n];if(t[r]&&void 0!==e[r])return e[r]||b[r]}return 3}(h,O);a.useEffect((function(){var e=m.ZP.subscribe((function(e){"object"===(0,c.Z)(h)&&N(e)}));return function(){m.ZP.unsubscribe(e)}}),[]);var F=function(e,t){var n=(0,d.Z)(e).filter((function(e){return e})),r=[],a=[],i=t;return n.forEach((function(e,o){var s,c=null===(s=e.props)||void 0===s?void 0:s.span,l=c||1;if(o===n.length-1)return a.push(j(e,c,i)),void r.push(a);l<i?(i-=l,a.push(e)):(a.push(j(e,l,i)),r.push(a),i=t,a=[])})),r}(x,W),A=a.useMemo((function(){return{labelStyle:$,contentStyle:C}}),[$,C]);return a.createElement(P.Provider,{value:A},a.createElement("div",{className:u()(I,(t={},(0,o.Z)(t,"".concat(I,"-").concat(k),k&&"default"!==k),(0,o.Z)(t,"".concat(I,"-bordered"),!!Z),(0,o.Z)(t,"".concat(I,"-rtl"),"rtl"===D),t),w),style:S},(r||i)&&a.createElement("div",{className:"".concat(I,"-header")},r&&a.createElement("div",{className:"".concat(I,"-title")},r),i&&a.createElement("div",{className:"".concat(I,"-extra")},i)),a.createElement("div",{className:"".concat(I,"-view")},a.createElement("table",null,a.createElement("tbody",null,F.map((function(e,t){return a.createElement(v,{key:t,index:t,colon:g,prefixCls:I,vertical:"vertical"===y,bordered:Z,row:e})})))))))}w.Item=p;var S=w,k="container___nww32",$="right___o0xXT",C="title___DHxWh",M="desc___frhI6",_=n(52053),D=n.n(_),I=n(11527),E=i.Z.Link,T=function(e){return e.develop="开发版",e.master="正式版",e.debian="正式版",e}(T||{}),O=function(e){var t=e.systemInfo;return(0,I.jsxs)("div",{className:k,children:[(0,I.jsx)("img",{alt:"logo",style:{width:140,marginRight:20},src:"https://qn.whyour.cn/logo.png"}),(0,I.jsxs)("div",{className:$,children:[(0,I.jsx)("span",{className:C,children:r.ZP.get("青龙")}),(0,I.jsx)("span",{className:M,children:r.ZP.get("支持python3、javascript、shell、typescript 的定时任务管理面板")}),(0,I.jsxs)(S,{children:[(0,I.jsxs)(S.Item,{label:r.ZP.get("版本"),span:3,children:[r.ZP.get(T[t.branch])," v",t.version]}),(0,I.jsx)(S.Item,{label:r.ZP.get("更新时间"),span:3,children:D()(1e3*t.publishTime).format("YYYY-MM-DD HH:mm")}),(0,I.jsx)(S.Item,{label:r.ZP.get("更新日志"),span:3,children:(0,I.jsx)(E,{href:"https://qn.whyour.cn/version.yaml?t=".concat(Date.now()),target:"_blank",children:r.ZP.get("查看")})})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(E,{href:"https://github.com/whyour/qinglong",target:"_blank",style:{marginRight:15},children:"Github"}),(0,I.jsx)(E,{href:"https://t.me/jiao_long",target:"_blank",style:{marginRight:15},children:r.ZP.get("Telegram频道")}),(0,I.jsx)(E,{href:"https://github.com/whyour/qinglong/issues",target:"_blank",children:r.ZP.get("提交BUG")})]})]})]})}},47240:function(e,t,n){"use strict";n.r(t);var r=n(25359),a=n.n(r),i=n(57213),o=n.n(i),s=n(49811),c=n.n(s),l=n(54306),u=n.n(l),d=n(88265),f=n(63313),h=n(67393),m=n(9835),p=n(84163),g=n(22159),Z=n(28756),y=n(95176),x=n(5558),v=n(11527);t.default=function(e){var t=e.app,n=e.handleCancel,r=e.visible,i=h.Z.useForm(),s=u()(i,1)[0],l=(0,f.useState)(!1),P=u()(l,2),b=P[0],j=P[1],w=function(){var e=c()(a()().mark((function e(r){var i,s,c,l,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),i=t?"put":"post",s=o()({},r),t&&(s.id=t.id),e.prev=4,e.next=7,y.W[i]("".concat(x.Z.apiPrefix,"apps"),s);case 7:c=e.sent,l=c.code,u=c.data,200===l&&(m.ZP.success(t?d.ZP.get("更新应用成功"):d.ZP.get("创建应用成功")),n(u)),j(!1),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),j(!1);case 17:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}();return(0,f.useEffect)((function(){s.resetFields()}),[t,r]),(0,v.jsx)(p.Z,{title:t?d.ZP.get("编辑应用"):d.ZP.get("创建应用"),open:r,forceRender:!0,centered:!0,maskClosable:!1,onOk:function(){s.validateFields().then((function(e){w(e)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){return n()},confirmLoading:b,children:(0,v.jsxs)(h.Z,{form:s,layout:"vertical",name:"form_app_modal",initialValues:t,children:[(0,v.jsx)(h.Z.Item,{name:"name",label:d.ZP.get("名称"),rules:[{validator:function(e,t){return["system"].includes(t)?Promise.reject(new Error(d.ZP.get("名称不能为保留关键字"))):Promise.resolve()}}],children:(0,v.jsx)(g.Z,{placeholder:d.ZP.get("请输入应用名称")})}),(0,v.jsx)(h.Z.Item,{name:"scopes",label:d.ZP.get("权限"),rules:[{required:!0}],children:(0,v.jsx)(Z.Z,{mode:"multiple",placeholder:d.ZP.get("请选择模块权限"),allowClear:!0,style:{width:"100%"},children:x.Z.scopes.map((function(e){return(0,v.jsx)(Z.Z.Option,{value:e.value,children:e.name},e.value)}))})})]})})}},77207:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return R}});var r=n(25359),a=n.n(r),i=n(49811),o=n.n(i),s=n(57213),c=n.n(s),l=n(93525),u=n.n(l),d=n(54306),f=n.n(d),h=n(88265),m=n(63313),p=n(92260),g=n(51704),Z=n(2947),y=n(15367),x=n(84163),v=n(9835),P=n(24378),b=n(86986),j=n(94674),w=n(5558),S=n(78969),k=n(95176),$=n(47240),C=n(32132),M=n(14797),_={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},D=n(46420),I=function(e,t){return m.createElement(D.Z,(0,M.Z)((0,M.Z)({},e),{},{ref:t,icon:_}))};I.displayName="ReloadOutlined";var E=m.forwardRef(I),T=n(13740),O=n(17322),N=n(23980),W=n(15257),F=n(14761),A=n(9532),L=n(98074),q=(n(56508),n(87878)),B=n(61761),z=n(11527),H=p.Z.Text,Y="demo"===window.__ENV__DeployEnv,R=function(){var e=(0,L.useOutletContext)(),t=e.headerStyle,n=e.isPhone,r=e.user,i=e.theme,s=e.reloadUser,l=e.reloadTheme,d=e.socketMessage,p=e.systemInfo,M=[{title:h.ZP.get("名称"),dataIndex:"name",key:"name"},{title:"Client ID",dataIndex:"client_id",key:"client_id",render:function(e,t){return(0,z.jsx)(H,{copyable:!0,children:t.client_id})}},{title:"Client Secret",dataIndex:"client_secret",key:"client_secret",render:function(e,t){return(0,z.jsx)(H,{copyable:{text:t.client_secret},children:"*******"})}},{title:h.ZP.get("权限"),dataIndex:"scopes",key:"scopes",width:"40%",render:function(e,t){return t.scopes.map((function(e){return(0,z.jsx)(g.Z,{children:w.Z.scopesMap[e]},e)}))}},{title:h.ZP.get("操作"),key:"action",render:function(e,t,r){var a=!n;return(0,z.jsxs)(Z.Z,{size:"middle",style:{paddingLeft:8},children:[(0,z.jsx)(y.Z,{title:a?h.ZP.get("编辑"):"",children:(0,z.jsx)("a",{onClick:function(){return $e(t,r)},children:(0,z.jsx)(C.Z,{})})}),(0,z.jsx)(y.Z,{title:a?h.ZP.get("重置secret"):"",children:(0,z.jsx)("a",{onClick:function(){return Me(t,r)},children:(0,z.jsx)(E,{})})}),(0,z.jsx)(y.Z,{title:a?h.ZP.get("删除"):"",children:(0,z.jsx)("a",{onClick:function(){return Ce(t,r)},children:(0,z.jsx)(T.Z,{})})})]})}}],_=(0,m.useState)(!0),D=f()(_,2),I=D[0],R=D[1],V=(0,m.useState)([]),U=f()(V,2),G=U[0],K=U[1],J=(0,m.useState)(!1),Q=f()(J,2),X=Q[0],ee=Q[1],te=(0,m.useState)(),ne=f()(te,2),re=ne[0],ae=ne[1],ie=(0,m.useState)("security"),oe=f()(ie,2),se=oe[0],ce=oe[1],le=(0,m.useState)([]),ue=f()(le,2),de=ue[0],fe=ue[1],he=(0,m.useState)(""),me=f()(he,2),pe=me[0],ge=me[1],Ze=(0,m.useState)(),ye=f()(Ze,2),xe=ye[0],ve=ye[1],Pe=(0,m.useRef)(null),be=(0,m.useState)(0),je=f()(be,2),we=je[0],Se=je[1];(0,B.Z)(Pe,(function(e){var t,n,r=null===(t=e.target.parentElement)||void 0===t||null===(n=t.parentElement)||void 0===n?void 0:n.offsetHeight;r&&we!==r-66&&Se(r-66)}));var ke=function(){R(!0),k.W.get("".concat(w.Z.apiPrefix,"apps")).then((function(e){var t=e.code,n=e.data;200===t&&K(n)})).finally((function(){return R(!1)}))},$e=function(e,t){ae(e),ee(!0)},Ce=function(e,t){x.Z.confirm({title:h.ZP.get("确认删除"),content:(0,z.jsxs)(z.Fragment,{children:[h.ZP.get("确认删除应用")," ",(0,z.jsx)(H,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",h.ZP.get("吗")]}),onOk:function(){k.W.delete("".concat(w.Z.apiPrefix,"apps"),{data:[e.id]}).then((function(e){var n=e.code;e.data;if(200===n){v.ZP.success(h.ZP.get("删除成功"));var r=u()(G);r.splice(t,1),K(r)}}))},onCancel:function(){console.log("Cancel")}})},Me=function(e,t){x.Z.confirm({title:h.ZP.get("确认重置"),content:(0,z.jsxs)(z.Fragment,{children:[h.ZP.get("确认重置应用")," ",(0,z.jsx)(H,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",h.ZP.get("的Secret吗"),(0,z.jsx)("br",{}),(0,z.jsx)(H,{type:"secondary",children:h.ZP.get("重置Secret会让当前应用所有token失效")})]}),onOk:function(){k.W.put("".concat(w.Z.apiPrefix,"apps/").concat(e.id,"/reset-secret")).then((function(e){var t=e.code,n=e.data;200===t&&(v.ZP.success(h.ZP.get("重置成功")),_e(n))}))},onCancel:function(){console.log("Cancel")}})},_e=function(e){var t=G.findIndex((function(t){return t.id===e.id})),n=u()(G);-1===t?n.push(e):n.splice(t,1,c()({},e)),K(n)},De=function(){k.W.get("".concat(w.Z.apiPrefix,"user/notification")).then((function(e){var t=e.code,n=e.data;200===t&&ve(n)})).catch((function(e){console.log(e)}))};return(0,m.useEffect)((function(){Y&&ke()}),[]),(0,z.jsxs)(S.ZP,{className:"ql-container-wrapper ql-container-wrapper-has-tab ql-setting-container",title:h.ZP.get("系统设置"),header:{style:t},extra:"app"===se?[(0,z.jsx)(P.Z,{type:"primary",onClick:function(){return ae(null),void ee(!0)},children:h.ZP.get("创建应用")},"2")]:[],children:[(0,z.jsx)("div",{ref:Pe,children:(0,z.jsx)(b.Z,{defaultActiveKey:"security",size:"small",tabPosition:"top",onChange:function(e){ce(e),"app"===e?ke():"login"===e?k.W.get("".concat(w.Z.apiPrefix,"user/login-log")).then((function(e){var t=e.code,n=e.data;200===t&&fe(n)})).catch((function(e){console.log(e)})):"notification"===e?De():"syslog"===e&&k.W.get("".concat(w.Z.apiPrefix,"system/log"),{responseType:"blob"}).then(function(){var e=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=ge,e.next=3,t.text();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log(e)}))},items:[].concat(u()(Y?[]:[{key:"security",label:h.ZP.get("安全设置"),children:(0,z.jsx)(O.default,{user:r,userChange:s})}]),[{key:"app",label:h.ZP.get("应用设置"),children:(0,z.jsx)(j.Z,{columns:M,pagination:!1,dataSource:G,rowKey:"id",size:"middle",scroll:{x:768},loading:I})},{key:"notification",label:h.ZP.get("通知设置"),children:(0,z.jsx)(W.default,{data:xe})},{key:"syslog",label:h.ZP.get("系统日志"),children:(0,z.jsx)(q.ZP,{maxHeight:"".concat(we,"px"),value:pe,onCreateEditor:function(e){setTimeout((function(){e.scrollDOM.scrollTo({top:e.scrollDOM.scrollHeight,behavior:"smooth"})}),300)},readOnly:!0,theme:i.includes("dark")?"dark":"light"})},{key:"login",label:h.ZP.get("登录日志"),children:(0,z.jsx)(N.default,{data:de})},{key:"other",label:h.ZP.get("其他设置"),children:(0,z.jsx)(F.default,{reloadTheme:l,socketMessage:d,systemInfo:p})},{key:"about",label:h.ZP.get("关于"),children:(0,z.jsx)(A.default,{systemInfo:p})}])})}),(0,z.jsx)($.default,{visible:X,handleCancel:function(e){ee(!1),e&&_e(e)},app:re})]})}},23980:function(e,t,n){"use strict";n.r(t);var r=n(88265),a=(n(63313),n(92260)),i=n(51704),o=n(94674),s=n(11527),c=(a.Z.Text,a.Z.Link,function(e){return e[e["成功"]=0]="成功",e[e["失败"]=1]="失败",e}(c||{})),l=function(e){return e[e.success=0]="success",e[e.error=1]="error",e}(l||{}),u=[{title:r.ZP.get("序号"),width:50,render:function(e,t,n){return n+1}},{title:r.ZP.get("登录时间"),dataIndex:"timestamp",key:"timestamp",width:120,render:function(e,t){return new Date(t.timestamp).toLocaleString()}},{title:r.ZP.get("登录地址"),dataIndex:"address",width:120,key:"address"},{title:r.ZP.get("登录IP"),dataIndex:"ip",width:100,key:"ip"},{title:r.ZP.get("登录设备"),dataIndex:"platform",key:"platform",width:80},{title:r.ZP.get("登录状态"),dataIndex:"status",key:"status",width:80,render:function(e,t){return(0,s.jsx)(i.Z,{color:l[t.status],style:{marginRight:0},children:r.ZP.get(c[t.status])})}}];t.default=function(e){var t=e.data;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(o.Z,{columns:u,pagination:!1,dataSource:t,rowKey:"id",size:"middle",scroll:{x:1e3},sticky:!0})})}},15257:function(e,t,n){"use strict";n.r(t);var r=n(57213),a=n.n(r),i=n(54306),o=n.n(i),s=n(88265),c=n(63313),l=n(28756),u=n(67393),d=n(9835),f=n(22159),h=n(24378),m=n(95176),p=n(5558),g=n(11527),Z=l.Z.Option;t.default=function(e){var t=e.data,n=(0,c.useState)(!1),r=o()(n,2),i=r[0],y=r[1],x=(0,c.useState)("closed"),v=o()(x,2),P=v[0],b=v[1],j=(0,c.useState)([]),w=o()(j,2),S=w[0],k=w[1],$=u.Z.useForm(),C=o()($,1)[0],M=function(e){b(e);var t=p.Z.notificationModeMap[e];k(t||[])};return(0,c.useEffect)((function(){t&&t.type&&(M(t.type),C.setFieldsValue(a()({},t)))}),[t]),(0,g.jsx)("div",{children:(0,g.jsxs)(u.Z,{onFinish:function(e){y(!0),"closed"==e.type&&(e.type=""),m.W.put("".concat(p.Z.apiPrefix,"user/notification"),e).then((function(t){var n=t.code;t.data;200===n&&d.ZP.success(e.type?s.ZP.get("通知发送成功"):s.ZP.get("通知关闭成功"))})).catch((function(e){console.log(e)})).finally((function(){return y(!1)}))},form:C,layout:"vertical",children:[(0,g.jsx)(u.Z.Item,{label:s.ZP.get("通知方式"),name:"type",rules:[{required:!0}],style:{maxWidth:400},initialValue:P,children:(0,g.jsx)(l.Z,{onChange:M,disabled:i,children:p.Z.notificationModes.map((function(e){return(0,g.jsx)(Z,{value:e.value,children:e.label},e.value)}))})}),S.map((function(e){return(0,g.jsx)(u.Z.Item,{label:e.label,name:e.label,extra:e.tip,rules:[{required:e.required}],style:{maxWidth:400},children:e.items?(0,g.jsx)(l.Z,{placeholder:e.placeholder||"请选择".concat(e.label),disabled:i,children:e.items.map((function(e){return(0,g.jsx)(Z,{value:e.value,children:e.label||e.value},e.value)}))}):(0,g.jsx)(f.Z.TextArea,{disabled:i,autoSize:{minRows:1,maxRows:5},placeholder:e.placeholder||"请输入".concat(e.label)})},e.label)})),(0,g.jsx)(h.Z,{type:"primary",htmlType:"submit",disabled:i,children:i?s.ZP.get("测试中..."):s.ZP.get("保存")})]})})}},14761:function(e,t,n){"use strict";n.r(t);var r=n(57213),a=n.n(r),i=n(54306),o=n.n(i),s=n(88265),c=n(63313),l=n(67393),u=n(9835),d=n(84163),f=n(84468),h=n(22159),m=n(55484),p=n(24378),g=n(28756),Z=n(57679),y=n(71571),x=n(5558),v=n(95176),P=n(60819),b=n(11227),j=(n(56508),n(59953)),w=n(41422),S=n(54700),k=n(11527);t.default=function(e){var t=e.systemInfo,n=e.socketMessage,r=e.reloadTheme,i=localStorage.getItem("qinglong_dark_theme")||"auto",$=(0,c.useState)(),C=o()($,2),M=C[0],_=C[1],D=l.Z.useForm(),I=o()(D,1)[0],E=((0,c.useRef)(),(0,c.useState)(!1)),T=o()(E,2),O=T[0],N=T[1],W=(0,S.default)(s.ZP.get("上传")),F=(0,S.default)(s.ZP.get("下载")),A=y||{},L=A.enable,q=A.disable,B=(A.exportGeneratedCSS,A.setFetchMethod),z=A.auto,H=function(){v.W.put("".concat(x.Z.apiPrefix,"system/config"),M).then((function(e){var t=e.code;e.data;200===t&&u.ZP.success(s.ZP.get("更新成功"))})).catch((function(e){console.log(e)}))};return(0,c.useEffect)((function(){v.W.get("".concat(x.Z.apiPrefix,"system/config")).then((function(e){var t=e.code,n=e.data;200===t&&n.info&&_(n.info)})).catch((function(e){console.log(e)}))}),[]),(0,k.jsxs)(l.Z,{layout:"vertical",form:I,children:[(0,k.jsx)(l.Z.Item,{label:s.ZP.get("主题"),name:"theme",initialValue:i,children:(0,k.jsxs)(f.ZP.Group,{onChange:function(e){var t=e.target.value;localStorage.setItem("qinglong_dark_theme",e.target.value),B(fetch),"dark"===t?L({}):"light"===t?q():z({}),r()},value:i,optionType:"button",buttonStyle:"solid",children:[(0,k.jsx)(f.ZP.Button,{value:"light",style:{width:70,textAlign:"center"},children:s.ZP.get("亮色")}),(0,k.jsx)(f.ZP.Button,{value:"dark",style:{width:66,textAlign:"center"},children:s.ZP.get("暗色")}),(0,k.jsx)(f.ZP.Button,{value:"auto",style:{width:129,textAlign:"center"},children:s.ZP.get("跟随系统")})]})}),(0,k.jsx)(l.Z.Item,{label:s.ZP.get("日志删除频率"),name:"frequency",tooltip:s.ZP.get("每x天自动删除x天以前的日志"),children:(0,k.jsxs)(h.Z.Group,{compact:!0,children:[(0,k.jsx)(m.Z,{addonBefore:s.ZP.get("每"),addonAfter:s.ZP.get("天"),style:{width:180},min:0,value:null==M?void 0:M.logRemoveFrequency,onChange:function(e){_(a()(a()({},M),{},{logRemoveFrequency:e}))}}),(0,k.jsx)(p.Z,{type:"primary",onClick:H,style:{width:84},children:s.ZP.get("确认")})]})}),(0,k.jsx)(l.Z.Item,{label:s.ZP.get("定时任务并发数"),name:"frequency",children:(0,k.jsxs)(h.Z.Group,{compact:!0,children:[(0,k.jsx)(m.Z,{style:{width:180},min:1,value:null==M?void 0:M.cronConcurrency,onChange:function(e){_(a()(a()({},M),{},{cronConcurrency:e}))}}),(0,k.jsx)(p.Z,{type:"primary",onClick:H,style:{width:84},children:s.ZP.get("确认")})]})}),(0,k.jsx)(l.Z.Item,{label:s.ZP.get("语言"),name:"lang",children:(0,k.jsx)(g.Z,{defaultValue:localStorage.getItem("lang")||"",style:{width:264},onChange:function(e){localStorage.setItem("lang",e),setTimeout((function(){window.location.reload()}),500)},options:[{value:"",label:s.ZP.get("跟随系统")},{value:"zh",label:"简体中文"},{value:"en",label:"English"}]})}),(0,k.jsxs)(l.Z.Item,{label:s.ZP.get("数据备份还原"),name:"frequency",children:[(0,k.jsx)(p.Z,{type:"primary",onClick:function(){N(!0),v.W.put("".concat(x.Z.apiPrefix,"system/data/export"),{},{responseType:"blob",timeout:864e5,onDownloadProgress:function(e){e.progress&&F(parseFloat((100*e.progress).toFixed(1)))}}).then((function(e){(0,b.saveAs)(e,"data.tgz")})).catch((function(e){console.log(e)})).finally((function(){return N(!1)}))},loading:O,children:O?s.ZP.get("生成数据中..."):s.ZP.get("备份")}),(0,k.jsx)(Z.Z,{method:"put",showUploadList:!1,maxCount:1,action:"/api/system/data/import",onChange:function(e){var t,n,r;null!==(t=e.event)&&void 0!==t&&t.percent&&(W(parseFloat(null===(n=e.event)||void 0===n?void 0:n.percent.toFixed(1))),100===(null===(r=e.event)||void 0===r?void 0:r.percent)&&d.Z.confirm({width:600,maskClosable:!1,title:s.ZP.get("确认重启"),centered:!0,content:s.ZP.get("备份数据上传成功，确认覆盖数据"),okText:s.ZP.get("重启"),onOk:function(){v.W.put("".concat(x.Z.apiPrefix,"system/reload"),{type:"data"}).then((function(){u.ZP.success({content:(0,k.jsxs)("span",{children:[s.ZP.get("系统将在"),(0,k.jsx)(w.Z,{className:"inline-countdown",format:"ss",value:Date.now()+3e4}),s.ZP.get("秒后自动刷新")]}),duration:30}),setTimeout((function(){window.location.reload()}),3e4)})).catch((function(e){console.log(e)}))}}))},name:"data",headers:{Authorization:"Bearer ".concat(localStorage.getItem(x.Z.authKey))},children:(0,k.jsx)(p.Z,{icon:(0,k.jsx)(j.Z,{}),style:{marginLeft:8},children:s.ZP.get("还原数据")})})]}),(0,k.jsx)(l.Z.Item,{label:s.ZP.get("检查更新"),name:"update",children:(0,k.jsx)(P.default,{systemInfo:t,socketMessage:n})})]})}},54700:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var r=n(13800),a=n(84163),i=n(63313),o=n(11527);function s(e){var t=(0,i.useRef)(),n=function(e){var t=e.percent;return(0,o.jsx)(r.Z,{style:{display:"flex",justifyContent:"center"},type:"circle",percent:t})};return function(r){t.current?t.current.update({title:"".concat(e).concat(r>=100?"成功":"中..."),content:(0,o.jsx)(n,{percent:r})}):t.current=a.Z.info({width:600,maskClosable:!1,title:"".concat(e).concat(r>=100?"成功":"中..."),centered:!0,content:(0,o.jsx)(n,{percent:r})})}}},17322:function(e,t,n){"use strict";n.r(t);var r=n(54306),a=n.n(r),i=n(88265),o=n(63313),s=n(92260),c=n(9835),l=n(22159),u=n(24378),d=n(67393),f=n(83535),h=n(57679),m=n(95176),p=n(5558),g=n(98074),Z=n(48039),y=n.n(Z),x=n(91796),v=n(3513),P=n(59953),b=n(24244),j=(n(3057),n(11527)),w=s.Z.Title,S=s.Z.Link;t.default=function(e){var t=e.user,n=e.userChange,r=(0,o.useState)(!1),s=a()(r,2),Z=s[0],k=s[1],$=(0,o.useState)(),C=a()($,2),M=C[0],_=C[1],D=(0,o.useState)(!1),I=a()(D,2),E=I[0],T=I[1],O=(0,o.useState)(),N=a()(O,2),W=N[0],F=N[1],A=(0,o.useState)(),L=a()(A,2),q=L[0],B=L[1],z=(0,o.useState)(),H=a()(z,2),Y=H[0],R=H[1],V=function(){m.W.put("".concat(p.Z.apiPrefix,"user/two-factor/deactive")).then((function(e){var t=e.code,r=e.data;200===t&&r&&(_(!1),n())})).catch((function(e){console.log(e)}))},U=function(){m.W.get("".concat(p.Z.apiPrefix,"user/two-factor/init")).then((function(e){var t=e.code,n=e.data;200===t&&F(n)})).catch((function(e){console.log(e)}))};return(0,o.useEffect)((function(){_(t&&t.twoFactorActivated),R(t.avatar&&"/api/static/".concat(t.avatar))}),[t]),E?(0,j.jsx)(j.Fragment,{children:W?(0,j.jsxs)("div",{children:[(0,j.jsx)(w,{level:5,children:i.ZP.get("第一步")}),i.ZP.get("下载两步验证手机应用，比如 Google Authenticator 、"),(0,j.jsx)(S,{href:"https://www.microsoft.com/en-us/security/mobile-authenticator-app",target:"_blank",children:"Microsoft Authenticator"}),"、",(0,j.jsx)(S,{href:"https://authy.com/download/",target:"_blank",children:"Authy"}),"、",(0,j.jsx)(S,{href:"https://support.1password.com/one-time-passwords/",target:"_blank",children:"1Password"}),"、",(0,j.jsx)(S,{href:"https://support.logmeininc.com/lastpass/help/lastpass-authenticator-lp030014",target:"_blank",children:"LastPass Authenticator"}),(0,j.jsx)(w,{style:{marginTop:5},level:5,children:i.ZP.get("第二步")}),i.ZP.get("使用手机应用扫描二维码，或者输入秘钥")," ",null==W?void 0:W.secret,(0,j.jsx)("div",{style:{marginTop:10},children:(0,j.jsx)(y(),{style:{border:"1px solid #21262d",borderRadius:6},includeMargin:!0,size:187,value:null==W?void 0:W.url})}),(0,j.jsx)(w,{style:{marginTop:5},level:5,children:i.ZP.get("第三步")}),i.ZP.get("输入手机应用上的6位数字"),(0,j.jsx)(l.Z,{style:{margin:"10px 0 10px 0",display:"block",maxWidth:200},value:q,onChange:function(e){return B(e.target.value)},placeholder:"123456"}),(0,j.jsx)(u.Z,{type:"primary",loading:Z,onClick:function(){k(!0),m.W.put("".concat(p.Z.apiPrefix,"user/two-factor/active"),{code:q}).then((function(e){var t=e.code,r=e.data;200===t&&(r?(c.ZP.success(i.ZP.get("激活成功")),T(!1),_(!0),n()):c.ZP.success(i.ZP.get("验证失败")))})).catch((function(e){console.log(e)})).finally((function(){return k(!1)}))},children:i.ZP.get("完成设置")})]}):(0,j.jsx)(x.Z,{})}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{style:{fontSize:18,borderBottom:"1px solid #f0f0f0",marginBottom:8,paddingBottom:4},children:i.ZP.get("修改用户名密码")}),(0,j.jsxs)(d.Z,{onFinish:function(e){m.W.put("".concat(p.Z.apiPrefix,"user"),{username:e.username,password:e.password}).then((function(e){var t=e.code;e.data;200===t&&(localStorage.removeItem(p.Z.authKey),g.history.push("/login"))})).catch((function(e){console.log(e)}))},layout:"vertical",children:[(0,j.jsx)(d.Z.Item,{label:i.ZP.get("用户名"),name:"username",rules:[{required:!0}],hasFeedback:!0,style:{maxWidth:300},children:(0,j.jsx)(l.Z,{autoComplete:"username",placeholder:i.ZP.get("用户名")})}),(0,j.jsx)(d.Z.Item,{label:i.ZP.get("密码"),name:"password",rules:[{required:!0},{pattern:/^(?!admin$).*$/,message:i.ZP.get("密码不能为admin")}],hasFeedback:!0,style:{maxWidth:300},children:(0,j.jsx)(l.Z,{type:"password",autoComplete:"current-password",placeholder:i.ZP.get("密码")})}),(0,j.jsx)(u.Z,{type:"primary",htmlType:"submit",children:i.ZP.get("保存")})]}),(0,j.jsx)("div",{style:{fontSize:18,borderBottom:"1px solid #f0f0f0",marginBottom:8,paddingBottom:4,marginTop:16},children:i.ZP.get("两步验证")}),(0,j.jsx)(u.Z,{type:"primary",danger:M,onClick:function(){M?V():(U(),T(!0))},children:M?i.ZP.get("禁用"):i.ZP.get("启用")}),(0,j.jsx)("div",{style:{fontSize:18,borderBottom:"1px solid #f0f0f0",marginBottom:8,paddingBottom:4,marginTop:16},children:i.ZP.get("头像")}),(0,j.jsx)(f.C,{size:128,shape:"square",icon:(0,j.jsx)(v.Z,{}),src:Y}),(0,j.jsx)(b.Z,{rotationSlider:!0,children:(0,j.jsx)(h.Z,{method:"put",showUploadList:!1,maxCount:1,action:"/api/user/avatar",onChange:function(e){e.file&&e.file.response&&(R("/api/static/".concat(e.file.response.data)),n())},name:"avatar",headers:{Authorization:"Bearer ".concat(localStorage.getItem(p.Z.authKey))},children:(0,j.jsx)(u.Z,{icon:(0,j.jsx)(P.Z,{}),style:{marginLeft:8},children:i.ZP.get("更换头像")})})})]})}},56508:function(){},52053:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,r="millisecond",a="second",i="minute",o="hour",s="day",c="week",l="month",u="quarter",d="year",f="date",h="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},Z=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},y={s:Z,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),a=n%60;return(t<=0?"+":"-")+Z(r,2,"0")+":"+Z(a,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),a=t.clone().add(r,l),i=n-a<0,o=t.clone().add(r+(i?-1:1),l);return+(-(r+(n-a)/(i?a-o:o-a))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:d,w:c,d:s,D:f,h:o,m:i,s:a,ms:r,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},x="en",v={};v[x]=g;var P=function(e){return e instanceof S},b=function e(t,n,r){var a;if(!t)return x;if("string"==typeof t){var i=t.toLowerCase();v[i]&&(a=i),n&&(v[i]=n,a=i);var o=t.split("-");if(!a&&o.length>1)return e(o[0])}else{var s=t.name;v[s]=t,a=s}return!r&&a&&(x=a),a||!r&&x},j=function(e,t){if(P(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new S(n)},w=y;w.l=b,w.i=P,w.w=function(e,t){return j(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var S=function(){function g(e){this.$L=b(e.locale,null,!0),this.parse(e)}var Z=g.prototype;return Z.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(w.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(m);if(r){var a=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},Z.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},Z.$utils=function(){return w},Z.isValid=function(){return!(this.$d.toString()===h)},Z.isSame=function(e,t){var n=j(e);return this.startOf(t)<=n&&n<=this.endOf(t)},Z.isAfter=function(e,t){return j(e)<this.startOf(t)},Z.isBefore=function(e,t){return this.endOf(t)<j(e)},Z.$g=function(e,t,n){return w.u(e)?this[t]:this.set(n,e)},Z.unix=function(){return Math.floor(this.valueOf()/1e3)},Z.valueOf=function(){return this.$d.getTime()},Z.startOf=function(e,t){var n=this,r=!!w.u(t)||t,u=w.p(e),h=function(e,t){var a=w.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?a:a.endOf(s)},m=function(e,t){return w.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},p=this.$W,g=this.$M,Z=this.$D,y="set"+(this.$u?"UTC":"");switch(u){case d:return r?h(1,0):h(31,11);case l:return r?h(1,g):h(0,g+1);case c:var x=this.$locale().weekStart||0,v=(p<x?p+7:p)-x;return h(r?Z-v:Z+(6-v),g);case s:case f:return m(y+"Hours",0);case o:return m(y+"Minutes",1);case i:return m(y+"Seconds",2);case a:return m(y+"Milliseconds",3);default:return this.clone()}},Z.endOf=function(e){return this.startOf(e,!1)},Z.$set=function(e,t){var n,c=w.p(e),u="set"+(this.$u?"UTC":""),h=(n={},n[s]=u+"Date",n[f]=u+"Date",n[l]=u+"Month",n[d]=u+"FullYear",n[o]=u+"Hours",n[i]=u+"Minutes",n[a]=u+"Seconds",n[r]=u+"Milliseconds",n)[c],m=c===s?this.$D+(t-this.$W):t;if(c===l||c===d){var p=this.clone().set(f,1);p.$d[h](m),p.init(),this.$d=p.set(f,Math.min(this.$D,p.daysInMonth())).$d}else h&&this.$d[h](m);return this.init(),this},Z.set=function(e,t){return this.clone().$set(e,t)},Z.get=function(e){return this[w.p(e)]()},Z.add=function(r,u){var f,h=this;r=Number(r);var m=w.p(u),p=function(e){var t=j(h);return w.w(t.date(t.date()+Math.round(e*r)),h)};if(m===l)return this.set(l,this.$M+r);if(m===d)return this.set(d,this.$y+r);if(m===s)return p(1);if(m===c)return p(7);var g=(f={},f[i]=t,f[o]=n,f[a]=e,f)[m]||1,Z=this.$d.getTime()+r*g;return w.w(Z,this)},Z.subtract=function(e,t){return this.add(-1*e,t)},Z.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var r=e||"YYYY-MM-DDTHH:mm:ssZ",a=w.z(this),i=this.$H,o=this.$m,s=this.$M,c=n.weekdays,l=n.months,u=function(e,n,a,i){return e&&(e[n]||e(t,r))||a[n].slice(0,i)},d=function(e){return w.s(i%12||12,e,"0")},f=n.meridiem||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r},m={YY:String(this.$y).slice(-2),YYYY:w.s(this.$y,4,"0"),M:s+1,MM:w.s(s+1,2,"0"),MMM:u(n.monthsShort,s,l,3),MMMM:u(l,s),D:this.$D,DD:w.s(this.$D,2,"0"),d:String(this.$W),dd:u(n.weekdaysMin,this.$W,c,2),ddd:u(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(i),HH:w.s(i,2,"0"),h:d(1),hh:d(2),a:f(i,o,!0),A:f(i,o,!1),m:String(o),mm:w.s(o,2,"0"),s:String(this.$s),ss:w.s(this.$s,2,"0"),SSS:w.s(this.$ms,3,"0"),Z:a};return r.replace(p,(function(e,t){return t||m[e]||a.replace(":","")}))},Z.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},Z.diff=function(r,f,h){var m,p=w.p(f),g=j(r),Z=(g.utcOffset()-this.utcOffset())*t,y=this-g,x=w.m(this,g);return x=(m={},m[d]=x/12,m[l]=x,m[u]=x/3,m[c]=(y-Z)/6048e5,m[s]=(y-Z)/864e5,m[o]=y/n,m[i]=y/t,m[a]=y/e,m)[p]||y,h?x:w.a(x)},Z.daysInMonth=function(){return this.endOf(l).$D},Z.$locale=function(){return v[this.$L]},Z.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=b(e,t,!0);return r&&(n.$L=r),n},Z.clone=function(){return w.w(this.$d,this)},Z.toDate=function(){return new Date(this.valueOf())},Z.toJSON=function(){return this.isValid()?this.toISOString():null},Z.toISOString=function(){return this.$d.toISOString()},Z.toString=function(){return this.$d.toUTCString()},g}(),k=S.prototype;return j.prototype=k,[["$ms",r],["$s",a],["$m",i],["$H",o],["$W",s],["$M",l],["$y",d],["$D",f]].forEach((function(e){k[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),j.extend=function(e,t){return e.$i||(e(t,S,j),e.$i=!0),j},j.locale=b,j.isDayjs=P,j.unix=function(e){return j(1e3*e)},j.en=v[x],j.Ls=v,j.p={},j}()}}]);