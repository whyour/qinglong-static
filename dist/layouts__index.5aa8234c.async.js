"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1717],{86755:function(e,n,t){var a=(0,t(55258).Z)({scriptUrl:["//at.alicdn.com/t/c/font_3354854_ob5y15ewlyq.js"]});n.Z=a},10966:function(e,n,t){t.r(n),t.d(n,{default:function(){return F}});var a=t(57213),o=t.n(a),i=t(54306),r=t.n(i),s=t(88265),c=t(63313),l=t(91796),u=t(40221),d=t(71571),p=t(68834),h=t(86755),g=t(11527),m={route:{routes:[{name:s.ZP.get("登录"),path:"/login",hideInMenu:!0,component:"@/pages/login/index"},{name:s.ZP.get("初始化"),path:"/initialization",hideInMenu:!0,component:"@/pages/initialization/index"},{name:s.ZP.get("错误"),path:"/error",hideInMenu:!0,component:"@/pages/error/index"},{path:"/crontab",name:s.ZP.get("定时任务"),icon:(0,g.jsx)(h.Z,{type:"ql-icon-crontab"}),component:"@/pages/crontab/index"},{path:"/subscription",name:s.ZP.get("订阅管理"),icon:(0,g.jsx)(h.Z,{type:"ql-icon-subs"}),component:"@/pages/subscription/index"},{path:"/env",name:s.ZP.get("环境变量"),icon:(0,g.jsx)(h.Z,{type:"ql-icon-env"}),component:"@/pages/env/index"},{path:"/config",name:s.ZP.get("配置文件"),icon:(0,g.jsx)(h.Z,{type:"ql-icon-config"}),component:"@/pages/config/index"},{path:"/script",name:s.ZP.get("脚本管理"),icon:(0,g.jsx)(h.Z,{type:"ql-icon-script"}),component:"@/pages/script/index"},{path:"/dependence",name:s.ZP.get("依赖管理"),icon:(0,g.jsx)(h.Z,{type:"ql-icon-dependence"}),component:"@/pages/dependence/index"},{path:"/log",name:s.ZP.get("日志管理"),icon:(0,g.jsx)(h.Z,{type:"ql-icon-log"}),component:"@/pages/log/index"},{path:"/diff",name:s.ZP.get("对比工具"),icon:(0,g.jsx)(h.Z,{type:"ql-icon-diff"}),component:"@/pages/diff/index"},{path:"/setting",name:s.ZP.get("系统设置"),icon:(0,g.jsx)(p.Z,{}),component:"@/pages/password/index"}]},navTheme:"light",fixSiderbar:!0,contentWidth:"Fixed",splitMenus:!1,siderWidth:180},f=t(98074),v=t(50988),x=t(3513),Z=t(63386),y=t(85153),j=t(5558),b=t(95176),S=t(86563),k=t.n(S),w=t(62753),P=t(12094),q=t(15367),I=t(13217),z=t(34133),C=t(83535),E=t(78078),L=t.n(E),M=t(45638),T=t(79516),_=t(42078),W=t(25940),A=t(82755);function F(){var e=(0,f.useLocation)(),n=(0,w.e)(),t=(0,w.F)(),a=t.theme,i=t.reloadTheme,p=(0,c.useState)({}),h=r()(p,2),S=h[0],E=h[1],F=(0,c.useState)(!0),N=r()(F,2),R=N[0],B=N[1],K=(0,c.useState)(),O=r()(K,2),U=O[0],D=O[1],Q=(0,c.useRef)(null),G=(0,c.useState)(),J=r()(G,2),V=J[0],H=J[1],X=(0,c.useState)(!1),Y=r()(X,2),$=Y[0],ee=Y[1],ne=(0,c.useState)(!0),te=r()(ne,2),ae=te[0],oe=te[1],ie=d||{},re=ie.enable,se=ie.disable,ce=(ie.exportGeneratedCSS,ie.setFetchMethod),le=ie.auto,ue=function(){b.W.get("".concat(j.Z.apiPrefix,"system")).then((function(e){var n,t=e.code,a=e.data;200===t&&(D(a),a.isInitialized?(n=a.version,_.S({dsn:"https://3406424fb1dc4813a62d39e844a9d0ac@o1098464.ingest.sentry.io/6122818",integrations:[new W.jK.BrowserTracing({shouldCreateSpanForRequest:function(e){return!e.includes("/api/ws")&&!e.includes("/api/static")}})],release:n,tracesSampleRate:.1,beforeBreadcrumb:function(e,n){if(e.data&&e.data.url){var t=e.data.url.replace(/token=.*/,"");e.data.url=t}return e}}),A._m.config({paths:{vs:"https://cdn.staticfile.org/monaco-editor/0.33.0/min/vs"},"vs/nls":{availableLanguages:{"*":"zh-cn"}}}),de()):f.history.push("/initialization"))})).catch((function(e){console.log(e)}))},de=function(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n&&B(!0),b.W.get("".concat(j.Z.apiPrefix,"user")).then((function(t){var a=t.code,o=t.data;200===a&&o.username&&(E(o),"/"===e.pathname&&f.history.push("/crontab")),n&&B(!1)})).catch((function(e){console.log(e)}))},pe=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];de(e)};if((0,c.useEffect)((function(){U&&U.isInitialized&&!S&&de()}),[e.pathname]),(0,c.useEffect)((function(){b.W.get("".concat(j.Z.apiPrefix,"public/health")).then((function(e){var n;1===(null==e||null===(n=e.data)||void 0===n?void 0:n.status)?ue():f.history.push("/error")})).catch((function(e){f.history.push("/error")})).finally((function(){return oe(!1)}))}),[]),(0,c.useEffect)((function(){"vs-dark"===a?document.body.setAttribute("data-dark","true"):document.body.setAttribute("data-dark","false")}),[a]),(0,c.useEffect)((function(){k()();var e=localStorage.getItem("qinglong_dark_theme")||"auto";if("undefined"!=typeof window&&void 0!==window.matchMedia)return d?(ce(fetch),"dark"===e?re({}):"light"===e?se():le({}),function(){se()}):function(){return null}}),[]),(0,c.useEffect)((function(){if(S&&S.username){Q.current=new(L())("".concat(window.location.origin,"/api/ws?token=").concat(localStorage.getItem(j.Z.authKey))),Q.current.onmessage=function(e){try{var n=JSON.parse(e.data);"ping"===n.type&&(n&&"hanhh"===n.message?console.log("WS connection succeeded !!!"):console.log("WS connection Failed !!!",e)),H(n)}catch(n){console.log("websocket连接失败",e)}};var e=Q.current;return function(){e.close()}}}),[S]),(0,c.useEffect)((function(){window.onload=function(){var e=performance.timing;console.log("白屏时间: ".concat(e.responseStart-e.navigationStart)),console.log("请求完毕至DOM加载: ".concat(e.domInteractive-e.responseEnd)),console.log("解释dom树耗时: ".concat(e.domComplete-e.domInteractive)),console.log("从开始至load总耗时: ".concat(e.loadEventEnd-e.navigationStart)),M.uT("白屏时间 ".concat(e.responseStart-e.navigationStart))}}),[]),ae)return(0,g.jsx)(l.Z,{});if(["/login","/initialization","/error"].includes(e.pathname)&&(null!=U&&U.isInitialized&&"/initialization"===e.pathname&&f.history.push("/crontab"),U||"/error"===e.pathname))return(0,g.jsx)(f.Outlet,{context:o()(o()({},n),{},{theme:a,user:S,reloadUser:pe,reloadTheme:i,ws:Q.current})});var he=navigator.userAgent.includes("Firefox"),ge=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),me=navigator.userAgent.includes("QQBrowser"),fe={items:[{label:s.ZP.get("退出登录"),className:"side-menu-user-drop-menu",onClick:function(){b.W.post("".concat(j.Z.apiPrefix,"user/logout")).then((function(){localStorage.removeItem(j.Z.authKey),f.history.push("/login")}))},key:"logout",icon:(0,g.jsx)(v.Z,{})}]};return R?(0,g.jsx)(l.Z,{}):(0,g.jsx)(u.ZP,o()(o()({selectedKeys:[e.pathname],loading:R,ErrorBoundary:T.SV,logo:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(P.Z,{preview:!1,src:"https://qn.whyour.cn/logo.png"}),(0,g.jsxs)("div",{className:"title",children:[(0,g.jsx)("span",{className:"title",children:s.ZP.get("青龙")}),(0,g.jsx)("a",{href:null==U?void 0:U.changeLogLink,target:"_blank",rel:"noopener noreferrer",onClick:function(e){e.stopPropagation()},children:(0,g.jsx)(q.Z,{title:"develop"===(null==U?void 0:U.branch)?s.ZP.get("开发版"):s.ZP.get("正式版"),children:(0,g.jsx)(I.Z,{size:"small",dot:"develop"===(null==U?void 0:U.branch),children:(0,g.jsxs)("span",{style:{fontSize:he?9:12,color:"#666",marginLeft:2,zoom:ge?.66:.8,letterSpacing:me?-2:0},children:["v",null==U?void 0:U.version]})})})})]})]}),title:!1,menuItemRender:function(n,t){return n.isUrl||!n.path||e.pathname===n.path?t:(0,g.jsx)(f.Link,{to:n.path,children:t})},pageTitleRender:function(n,t,a){var o=j.Z.documentTitleMap[e.pathname]||s.ZP.get("未找到");return"".concat(o," - ").concat(s.ZP.get("青龙"))},onCollapse:ee,collapsed:$,rightContentRender:function(){return n.isPhone&&(0,g.jsx)(z.Z,{menu:fe,placement:"bottomRight",trigger:["click"],children:(0,g.jsxs)("span",{className:"side-menu-user-wrapper",children:[(0,g.jsx)(C.C,{shape:"square",size:"small",icon:(0,g.jsx)(x.Z,{}),src:S.avatar?"/api/static/".concat(S.avatar):""}),(0,g.jsx)("span",{style:{marginLeft:5},children:S.username})]})})},collapsedButtonRender:function(e){return(0,g.jsxs)("span",{className:"side-menu-container",onClick:function(e){e.preventDefault(),e.stopPropagation()},children:[!e&&!n.isPhone&&(0,g.jsx)(z.Z,{menu:fe,placement:"topLeft",trigger:["hover"],children:(0,g.jsxs)("span",{className:"side-menu-user-wrapper",children:[(0,g.jsx)(C.C,{shape:"square",size:"small",icon:(0,g.jsx)(x.Z,{}),src:S.avatar?"/api/static/".concat(S.avatar):""}),(0,g.jsx)("span",{style:{marginLeft:5},children:S.username})]})}),(0,g.jsx)("span",{className:"side-menu-collapse-button",onClick:function(){return ee(!e)},children:e?(0,g.jsx)(Z.Z,{}):(0,g.jsx)(y.Z,{})})]})}},m),{},{children:(0,g.jsx)(f.Outlet,{context:o()(o()({},n),{},{theme:a,user:S,reloadUser:pe,reloadTheme:i,socketMessage:V,systemInfo:U})})}))}},62753:function(e,n,t){t.d(n,{F:function(){return c},e:function(){return s}});var a=t(54306),o=t.n(a),i=t(63313),r=t(82428),s=function(){var e=(0,i.useState)("100%"),n=o()(e,2),t=n[0],a=n[1],s=(0,i.useState)(0),c=o()(s,2),l=c[0],u=c[1],d=(0,i.useState)(-48),p=o()(d,2),h=p[0],g=p[1],m=(0,i.useState)(!1),f=o()(m,2),v=f[0],x=f[1],Z=(0,i.useMemo)((function(){return(0,r.ZP)()}),[]).platform;return(0,i.useEffect)((function(){"mobile"===Z&&document.body.offsetWidth<768?(a("auto"),u(0),g(0),x(!0),document.body.setAttribute("data-mode","phone")):(a("100%"),u(0),g(-48),x(!1),document.body.setAttribute("data-mode","desktop"))}),[]),{headerStyle:{padding:"4px 16px 4px 15px",position:"sticky",top:0,left:0,zIndex:20,marginTop:h,width:t,marginLeft:l},isPhone:v}},c=function(){var e=(0,i.useState)(),n=o()(e,2),t=n[0],a=n[1];return(0,i.useEffect)((function(){var e=window.matchMedia("(prefers-color-scheme: dark)"),n=localStorage.getItem("qinglong_dark_theme"),t=e.matches&&"light"!==n||"dark"===n;a(t?"vs-dark":"vs");var o=function(e){"auto"!==n&&n||(e.matches?a("vs-dark"):a("vs"))};"function"==typeof e.addEventListener?e.addEventListener("change",o):"function"==typeof e.addListener&&e.addListener(o)}),[]),{theme:t,reloadTheme:function(){var e=window.matchMedia("(prefers-color-scheme: dark)"),n=localStorage.getItem("qinglong_dark_theme"),t=e.matches&&"light"!==n||"dark"===n;a(t?"vs-dark":"vs")}}}}}]);