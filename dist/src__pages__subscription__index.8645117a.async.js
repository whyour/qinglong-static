"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7953],{20209:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(14797),r=n(63313),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"}}]},name:"clock-circle",theme:"outlined"},s=n(46420),c=function(e,t){return r.createElement(s.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:a}))};c.displayName="ClockCircleOutlined";var o=r.forwardRef(c)},13740:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(14797),r=n(63313),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},s=n(46420),c=function(e,t){return r.createElement(s.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:a}))};c.displayName="DeleteOutlined";var o=r.forwardRef(c)},65601:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(14797),r=n(63313),a={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 1024c-69.1 0-136.2-13.5-199.3-40.2C251.7 958 197 921 150 874c-47-47-84-101.7-109.8-162.7C13.5 648.2 0 581.1 0 512c0-19.9 16.1-36 36-36s36 16.1 36 36c0 59.4 11.6 117 34.6 171.3 22.2 52.4 53.9 99.5 94.3 139.9 40.4 40.4 87.5 72.2 139.9 94.3C395 940.4 452.6 952 512 952c59.4 0 117-11.6 171.3-34.6 52.4-22.2 99.5-53.9 139.9-94.3 40.4-40.4 72.2-87.5 94.3-139.9C940.4 629 952 571.4 952 512c0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.2C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3s-13.5 136.2-40.2 199.3C958 772.3 921 827 874 874c-47 47-101.8 83.9-162.7 109.7-63.1 26.8-130.2 40.3-199.3 40.3z"}}]},name:"loading-3-quarters",theme:"outlined"},s=n(46420),c=function(e,t){return r.createElement(s.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:a}))};c.displayName="Loading3QuartersOutlined";var o=r.forwardRef(c)},23421:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(14797),r=n(63313),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"},s=n(46420),c=function(e,t){return r.createElement(s.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:a}))};c.displayName="StopOutlined";var o=r.forwardRef(c)},9839:function(e,t,n){var i=n(54306),r=n.n(i),a=n(63313),s=n(61761),c=n(40141);t.Z=function(e,t){var n=(0,a.useState)(0),i=r()(n,2),o=i[0],u=i[1];return(0,s.Z)(e,(function(e){var n=e.target;n.classList.contains("ant-table-wrapper")||(n=e.target.querySelector(".ant-table-wrapper")),u((0,c.W9)({extraHeight:t,target:n}))})),o}},80376:function(e,t,n){n.r(t),n.d(t,{IntervalSchedule:function(){return A},SubscriptionStatus:function(){return L},SubscriptionType:function(){return q},default:function(){return D}});var i=n(93525),r=n.n(i),a=n(54306),s=n.n(a),c=n(57213),o=n.n(c),u=n(88265),l=n(63313),d=n(92260),f=n(22159),h=n(51704),p=n(2947),g=n(84163),v=n(24061),m=n(9835),b=n(34133),Z=n(24378),x=n(94674),k=n(20209),y=n(65601),P=n(76657),S=n(32132),w=n(38101),j=n(23421),C=n(13740),I=n(23831),E=n(15207),z=n(23435),O=n(57229),N=n(67362),_=n(14851),B=n(11094),F=n(9839),H=n(21758),R=n(11527),T=d.Z.Text,M=d.Z.Paragraph,W=f.Z.Search,L=function(e){return e[e.running=0]="running",e[e.idle=1]="idle",e[e.disabled=2]="disabled",e[e.queued=3]="queued",e}({}),A=function(e){return e.days="天",e.hours="时",e.minutes="分",e.seconds="秒",e}({}),q=function(e){return e["private-repo"]="私有仓库",e["public-repo"]="公开仓库",e.file="单文件",e}({}),D=function(){var e=(0,_.useOutletContext)(),t=e.headerStyle,n=e.isPhone,i=[{title:u.ZP.get("名称"),dataIndex:"name",key:"name",width:150,sorter:{compare:function(e,t){return e.name.localeCompare(t.name)},multiple:2}},{title:u.ZP.get("链接"),dataIndex:"url",key:"url",sorter:{compare:function(e,t){return e.name.localeCompare(t.name)},multiple:2},render:function(e,t){return(0,R.jsx)(M,{style:{wordBreak:"break-all",marginBottom:0},ellipsis:{tooltip:e,rows:2},children:e})}},{title:u.ZP.get("类型"),dataIndex:"type",key:"type",width:130,render:function(e,t){return q[t.type]}},{title:u.ZP.get("分支"),dataIndex:"branch",key:"branch",width:130,render:function(e,t){return t.branch||"-"}},{title:u.ZP.get("定时规则"),width:180,render:function(e,t){if("interval"===t.schedule_type){var n=t.interval_schedule,i=n.type,r=n.value;return"每".concat(r).concat(A[i])}return t.schedule}},{title:u.ZP.get("状态"),key:"status",dataIndex:"status",width:110,filters:[{text:u.ZP.get("运行中"),value:0},{text:u.ZP.get("空闲中"),value:1},{text:u.ZP.get("已禁用"),value:2}],onFilter:function(e,t){return t.is_disabled&&0!==t.status?2===e:t.status===e},render:function(e,t){return(0,R.jsxs)(R.Fragment,{children:[(!t.is_disabled||t.status!==L.idle)&&(0,R.jsxs)(R.Fragment,{children:[t.status===L.idle&&(0,R.jsx)(h.Z,{icon:(0,R.jsx)(k.Z,{}),color:"default",children:u.ZP.get("空闲中")}),t.status===L.running&&(0,R.jsx)(h.Z,{icon:(0,R.jsx)(y.Z,{spin:!0}),color:"processing",children:u.ZP.get("运行中")})]}),1===t.is_disabled&&t.status===L.idle&&(0,R.jsx)(h.Z,{icon:(0,R.jsx)(P.Z,{}),color:"error",children:u.ZP.get("已禁用")})]})}},{title:u.ZP.get("操作"),key:"action",width:140,render:function(e,t,n){return(0,R.jsxs)(p.Z,{size:"middle",children:[t.status===L.idle&&(0,R.jsx)("a",{onClick:function(e){e.stopPropagation(),we(t,n)},children:u.ZP.get("运行")}),t.status!==L.idle&&(0,R.jsx)("a",{onClick:function(e){e.stopPropagation(),je(t,n)},children:u.ZP.get("停止")}),(0,R.jsx)("a",{onClick:function(e){e.stopPropagation(),ke(o()(o()({},t),{},{timestamp:Date.now()}))},children:u.ZP.get("日志")}),(0,R.jsx)(Ie,{record:t,index:n},"more")]})}}],a=(0,l.useState)([]),c=s()(a,2),d=c[0],f=c[1],D=(0,l.useState)(!0),J=s()(D,2),V=J[0],$=J[1],K=(0,l.useState)(!1),Q=s()(K,2),U=Q[0],G=Q[1],X=(0,l.useState)(),Y=s()(X,2),ee=Y[0],te=Y[1],ne=(0,l.useState)(""),ie=s()(ne,2),re=ie[0],ae=ie[1],se=(0,l.useState)(1),ce=s()(se,2),oe=ce[0],ue=ce[1],le=(0,l.useState)(20),de=s()(le,2),fe=de[0],he=de[1],pe=(0,l.useState)(!1),ge=s()(pe,2),ve=ge[0],me=ge[1],be=(0,l.useState)(),Ze=s()(be,2),xe=Ze[0],ke=Ze[1],ye=(0,l.useRef)(null),Pe=(0,F.Z)(ye),Se=(0,l.useRef)(!1),we=function(e,t){g.Z.confirm({title:u.ZP.get("确认运行"),content:(0,R.jsxs)(R.Fragment,{children:[u.ZP.get("确认运行定时任务")," ",(0,R.jsx)(T,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",u.ZP.get("吗")]}),onOk:function(){O.W.put("".concat(E.Z.apiPrefix,"subscriptions/run"),[e.id]).then((function(t){var n=t.code;t.data;if(200===n){var i=r()(d),a=i.findIndex((function(t){return t.id===e.id}));-1!==a&&(i.splice(a,1,o()(o()({},e),{},{status:L.running})),f(i))}}))},onCancel:function(){console.log("Cancel")}})},je=function(e,t){g.Z.confirm({title:u.ZP.get("确认停止"),content:(0,R.jsxs)(R.Fragment,{children:[u.ZP.get("确认停止定时任务")," ",(0,R.jsx)(T,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",u.ZP.get("吗")]}),onOk:function(){O.W.put("".concat(E.Z.apiPrefix,"subscriptions/stop"),[e.id]).then((function(t){var n=t.code;t.data;if(200===n){var i=r()(d),a=i.findIndex((function(t){return t.id===e.id}));-1!==a&&(i.splice(a,1,o()(o()({},e),{},{pid:null,status:L.idle})),f(i))}}))},onCancel:function(){console.log("Cancel")}})},Ce=function(e){Se.current=e.target.checked},Ie=function(e){var t=e.record,n=e.index;return(0,R.jsx)(b.Z,{placement:"bottomRight",trigger:["click"],menu:{items:[{label:u.ZP.get("编辑"),key:"edit",icon:(0,R.jsx)(S.Z,{})},{label:1===t.is_disabled?u.ZP.get("启用"):u.ZP.get("禁用"),key:"enableOrDisable",icon:1===t.is_disabled?(0,R.jsx)(w.Z,{}):(0,R.jsx)(j.Z,{})},{label:u.ZP.get("删除"),key:"delete",icon:(0,R.jsx)(C.Z,{})}],onClick:function(e){var i=e.key;e.domEvent.stopPropagation(),Ee(i,t,n)}},children:(0,R.jsx)("a",{onClick:function(e){return e.stopPropagation()},children:(0,R.jsx)(I.Z,{})})})},Ee=function(e,t,n){switch(e){case"edit":!function(e,t){te(e),G(!0)}(t);break;case"enableOrDisable":!function(e,t){g.Z.confirm({title:"确认".concat(1===e.is_disabled?u.ZP.get("启用"):u.ZP.get("禁用")),content:(0,R.jsxs)(R.Fragment,{children:[u.ZP.get("确认"),1===e.is_disabled?u.ZP.get("启用"):u.ZP.get("禁用"),u.ZP.get("定时订阅")," ",(0,R.jsx)(T,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",u.ZP.get("吗")]}),onOk:function(){O.W.put("".concat(E.Z.apiPrefix,"subscriptions/").concat(1===e.is_disabled?"enable":"disable"),[e.id]).then((function(t){var n=t.code;if(t.data,200===n){var i=1===e.is_disabled?0:1,a=r()(d),s=a.findIndex((function(t){return t.id===e.id}));-1!==s&&(a.splice(s,1,o()(o()({},e),{},{is_disabled:i})),f(a))}}))},onCancel:function(){console.log("Cancel")}})}(t);break;case"delete":!function(e,t){g.Z.confirm({title:u.ZP.get("确认删除"),content:(0,R.jsxs)(R.Fragment,{children:[u.ZP.get("确认删除定时订阅")," ",(0,R.jsx)(T,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",u.ZP.get("吗"),(0,R.jsx)("div",{style:{marginTop:20},children:(0,R.jsx)(v.Z,{onChange:Ce,children:u.ZP.get("同时删除关联任务和脚本")})})]}),onOk:function(){O.W.delete("".concat(E.Z.apiPrefix,"subscriptions"),{data:[e.id],params:{force:Se.current}}).then((function(t){var n=t.code;if(t.data,200===n){m.ZP.success(u.ZP.get("删除成功"));var i=r()(d),a=i.findIndex((function(t){return t.id===e.id}));-1!==a&&(i.splice(a,1),f(i))}}))},onCancel:function(){console.log("Cancel")}})}(t)}},ze=function(e){var t=d.findIndex((function(t){return t.id===e.id})),n=r()(d);-1===t?n.unshift(e):n.splice(t,1,o()({},e)),f(n)},Oe=(0,l.useCallback)((function(e){e.message;var t=e.references;f((function(e){for(var n=r()(e),i=function(i){var r=e.findIndex((function(e){return e.id===t[i]}));-1!==r&&n.splice(r,1,o()(o()({},e[r]),{},{status:L.idle}))},a=0;a<t.length;a++)i(a);return n}))}),[]);return(0,l.useEffect)((function(){var e=H.Z.getInstance();return e.subscribe("runSubscriptionEnd",Oe),function(){e.unsubscribe("runSubscriptionEnd",Oe)}}),[]),(0,l.useEffect)((function(){xe&&(localStorage.setItem("logSubscription",xe.id),me(!0))}),[xe]),(0,l.useEffect)((function(){$(!0),O.W.get("".concat(E.Z.apiPrefix,"subscriptions?searchValue=").concat(re)).then((function(e){var t=e.code,n=e.data;200===t&&(f(n),ue(1))})).finally((function(){return $(!1)}))}),[re]),(0,l.useEffect)((function(){he(parseInt(localStorage.getItem("pageSize")||"20"))}),[]),(0,R.jsxs)(z.ZP,{className:"ql-container-wrapper subscriptiontab-wrapper",title:u.ZP.get("订阅管理"),extra:[(0,R.jsx)(W,{placeholder:u.ZP.get("请输入名称或者关键词"),style:{width:"auto"},enterButton:!0,allowClear:!0,loading:V,onSearch:function(e){ae(e.trim())}}),(0,R.jsx)(Z.Z,{type:"primary",onClick:function(){return te(null),void G(!0)},children:u.ZP.get("创建订阅")},"2")],header:{style:t},children:[(0,R.jsx)(x.Z,{ref:ye,columns:i,pagination:{current:oe,onChange:function(e,t){ue(e),he(t),localStorage.setItem("pageSize",t+"")},pageSize:fe,showSizeChanger:!0,simple:n,defaultPageSize:20,showTotal:function(e,t){return"第 ".concat(t[0],"-").concat(t[1]," 条/总共 ").concat(e," 条")},pageSizeOptions:[20,100,500,1e3]},dataSource:d,rowKey:"id",size:"middle",scroll:{x:1e3,y:Pe},loading:V,rowClassName:function(e,t){return e.isPinned?"pinned-subscription subscription":"subscription"}}),(0,R.jsx)(N.default,{visible:U,handleCancel:function(e){G(!1),e&&ze(e)},subscription:ee}),(0,R.jsx)(B.default,{visible:ve,handleCancel:function(){me(!1)},subscription:xe})]})}},11094:function(e,t,n){n.r(t);var i=n(54306),r=n.n(i),a=n(88265),s=n(63313),c=n(84163),o=n(24378),u=n(57229),l=n(15207),d=n(65601),f=n(38101),h=n(4574),p=n(40141),g=n(99120),v=n.n(g),m=n(11527);t.default=function(e){var t=e.subscription,n=e.handleCancel,i=e.visible,g=e.data,b=e.logUrl,Z=(0,s.useState)(a.ZP.get("启动中...")),x=r()(Z,2),k=x[0],y=x[1],P=(0,s.useState)(!0),S=r()(P,2),w=S[0],j=S[1],C=(0,s.useState)(!0),I=r()(C,2),E=I[0],z=I[1],O=(0,s.useState)(!1),N=r()(O,2),_=N[0],B=N[1],F=function e(n){n&&j(!0),u.W.get(b||"".concat(l.Z.apiPrefix,"subscriptions/").concat(t.id,"/log")).then((function(n){var i=n.code,r=n.data;if(200===i&&localStorage.getItem("logSubscription")===String(t.id)){var s=r;y(s||a.ZP.get("暂无日志")),z(s&&!(0,p.x$)(s)),s&&!(0,p.x$)(s)&&setTimeout((function(){e()}),2e3)}})).finally((function(){n&&j(!1)}))},H=function(){localStorage.removeItem("logSubscription"),n()};return(0,s.useEffect)((function(){t&&t.id&&i&&F(!0)}),[t,i]),(0,s.useEffect)((function(){g&&y(g)}),[g]),(0,s.useEffect)((function(){B(document.body.clientWidth<768)}),[]),(0,m.jsx)(c.Z,{title:(0,m.jsxs)(m.Fragment,{children:[(E||w)&&(0,m.jsx)(d.Z,{spin:!0}),!E&&!w&&(0,m.jsx)(f.Z,{}),(0,m.jsx)("span",{style:{marginLeft:5},children:t&&t.name})]}),open:i,centered:!0,className:"log-modal",forceRender:!0,onOk:function(){return H()},onCancel:function(){return H()},footer:[(0,m.jsx)(o.Z,{type:"primary",onClick:function(){return H()},children:a.ZP.get("知道了")})],children:(0,m.jsx)("div",{className:"log-container",children:w?(0,m.jsx)(h.Z,{}):(0,m.jsx)("pre",{style:_?{fontFamily:"Source Code Pro",zoom:.83}:{},children:(0,m.jsx)(v(),{children:k})})})})}},21758:function(e,t,n){var i=n(93525),r=n.n(i),a=n(12342),s=n.n(a),c=n(25359),o=n.n(c),u=n(49811),l=n.n(u),d=n(21140),f=n.n(d),h=n(63466),p=n.n(h),g=n(52510),v=n.n(g),m=n(78078),b=n.n(m),Z=["type"],x=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f()(this,e),v()(this,"url",void 0),v()(this,"socket",null),v()(this,"subscriptions",new Map),v()(this,"options",void 0),v()(this,"reconnectAttempts",0),v()(this,"heartbeatTimeout",null),v()(this,"state","closed"),this.url=t,this.options={maxReconnectAttempts:n.maxReconnectAttempts||5,reconnectInterval:n.reconnectInterval||3e3,heartbeatInterval:n.heartbeatInterval||3e4},this.init()}var t,n;return p()(e,[{key:"init",value:(n=l()(o()().mark((function e(){var t=this;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.state="connecting",this.emit("connecting");case 3:if(!(this.reconnectAttempts<this.options.maxReconnectAttempts)){e.next=16;break}return this.socket=new(b())(this.url),this.setupEventListeners(),this.startHeartbeat(),e.next=9,this.waitForClose();case 9:return this.stopHeartbeat(),this.socket=null,this.reconnectAttempts++,e.next=14,new Promise((function(e){return setTimeout(e,t.options.reconnectInterval)}));case 14:e.next=3;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.handleError(e.t0);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(){return n.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var e=this;this.socket&&(this.socket.onopen=function(){e.state="open",e.emit("open")},this.socket.onmessage=function(t){var n=JSON.parse(t.data);e.dispatchMessage(n)},this.socket.onclose=function(){e.state="closed",e.emit("close")})}},{key:"waitForClose",value:(t=l()(o()().mark((function e(){var t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=this.socket)||void 0===t?void 0:t.readyState)===b().CLOSED){e.next=5;break}return e.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"subscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(!n.has(t)){n.add(t),this.subscriptions.set(e,n);var i={action:"subscribe",topic:e};this.send(i)}}},{key:"unsubscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(n.has(t)){n.delete(t);var i={action:"unsubscribe",topic:e};this.send(i)}}},{key:"send",value:function(e){var t;(null===(t=this.socket)||void 0===t?void 0:t.readyState)===b().OPEN&&this.socket.send(JSON.stringify(e))}},{key:"dispatchMessage",value:function(e){var t=e.type,n=s()(e,Z),i=this.subscriptions.get(t)||new Set;r()(i).forEach((function(e){return e(n)}))}},{key:"startHeartbeat",value:function(){var e=this;this.heartbeatTimeout=setInterval((function(){var t;(null===(t=e.socket)||void 0===t?void 0:t.readyState)===b().OPEN&&e.socket.send(JSON.stringify({type:"heartbeat"}))}),this.options.heartbeatInterval)}},{key:"stopHeartbeat",value:function(){this.heartbeatTimeout&&clearInterval(this.heartbeatTimeout)}},{key:"close",value:function(){this.socket&&(this.state="closed",this.stopHeartbeat(),this.socket.close(),this.emit("close"))}},{key:"handleError",value:function(e){console.error("WebSocket错误:",e),this.emit("error",e)}},{key:"on",value:function(e,t){}},{key:"emit",value:function(e,t){}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return e.instance||(e.instance=new e(t,n)),e.instance}}]),e}();v()(x,"instance",null),t.Z=x}}]);