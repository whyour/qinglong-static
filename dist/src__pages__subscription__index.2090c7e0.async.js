"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7953,578],{20209:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(14797),r=n(63313),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"}}]},name:"clock-circle",theme:"outlined"},c=n(46420),o=function(e,t){return r.createElement(c.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:a}))};o.displayName="ClockCircleOutlined";var s=r.forwardRef(o)},13740:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(14797),r=n(63313),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},c=n(46420),o=function(e,t){return r.createElement(c.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:a}))};o.displayName="DeleteOutlined";var s=r.forwardRef(o)},65601:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(14797),r=n(63313),a={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 1024c-69.1 0-136.2-13.5-199.3-40.2C251.7 958 197 921 150 874c-47-47-84-101.7-109.8-162.7C13.5 648.2 0 581.1 0 512c0-19.9 16.1-36 36-36s36 16.1 36 36c0 59.4 11.6 117 34.6 171.3 22.2 52.4 53.9 99.5 94.3 139.9 40.4 40.4 87.5 72.2 139.9 94.3C395 940.4 452.6 952 512 952c59.4 0 117-11.6 171.3-34.6 52.4-22.2 99.5-53.9 139.9-94.3 40.4-40.4 72.2-87.5 94.3-139.9C940.4 629 952 571.4 952 512c0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.2C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3s-13.5 136.2-40.2 199.3C958 772.3 921 827 874 874c-47 47-101.8 83.9-162.7 109.7-63.1 26.8-130.2 40.3-199.3 40.3z"}}]},name:"loading-3-quarters",theme:"outlined"},c=n(46420),o=function(e,t){return r.createElement(c.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:a}))};o.displayName="Loading3QuartersOutlined";var s=r.forwardRef(o)},23421:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(14797),r=n(63313),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"},c=n(46420),o=function(e,t){return r.createElement(c.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:a}))};o.displayName="StopOutlined";var s=r.forwardRef(o)},66150:function(e,t,n){var i=n(54306),r=n.n(i),a=n(63313),c=n(61761),o=n(82428);t.Z=function(e,t){var n=(0,a.useState)(0),i=r()(n,2),s=i[0],l=i[1];return(0,c.Z)(e,(function(e){var n=e.target;n.classList.contains("ant-table-wrapper")||(n=e.target.querySelector(".ant-table-wrapper")),l((0,o.W9)({extraHeight:t,target:n}))})),s}},99080:function(e,t,n){n.r(t),n.d(t,{IntervalSchedule:function(){return L},SubscriptionStatus:function(){return q},SubscriptionType:function(){return T},default:function(){return D}});var i=n(93525),r=n.n(i),a=n(54306),c=n.n(a),o=n(57213),s=n.n(o),l=n(88265),u=n(63313),d=n(92260),f=n(22159),g=n(51704),p=n(2947),h=n(84163),Z=n(24061),m=n(9835),x=n(34133),v=n(24378),b=n(94674),P=n(20209),y=n(65601),j=n(76657),k=n(32132),C=n(38101),S=n(23421),w=n(13740),z=n(23831),I=n(5558),E=n(78969),O=n(95176),_=n(28393),B=n(98074),F=n(78074),N=n(66150),R=n(11527),W=d.Z.Text,M=d.Z.Paragraph,H=f.Z.Search,q=function(e){return e[e.running=0]="running",e[e.idle=1]="idle",e[e.disabled=2]="disabled",e[e.queued=3]="queued",e}({}),L=function(e){return e.days="天",e.hours="时",e.minutes="分",e.seconds="秒",e}({}),T=function(e){return e["private-repo"]="私有仓库",e["public-repo"]="公开仓库",e.file="单文件",e}({}),D=function(){var e=(0,B.useOutletContext)(),t=e.headerStyle,n=e.isPhone,i=e.socketMessage,a=[{title:l.ZP.get("名称"),dataIndex:"name",key:"name",width:150,sorter:{compare:function(e,t){return e.name.localeCompare(t.name)},multiple:2}},{title:l.ZP.get("链接"),dataIndex:"url",key:"url",sorter:{compare:function(e,t){return e.name.localeCompare(t.name)},multiple:2},render:function(e,t){return(0,R.jsx)(M,{style:{wordBreak:"break-all",marginBottom:0},ellipsis:{tooltip:e,rows:2},children:e})}},{title:l.ZP.get("类型"),dataIndex:"type",key:"type",width:130,render:function(e,t){return T[t.type]}},{title:l.ZP.get("分支"),dataIndex:"branch",key:"branch",width:130,render:function(e,t){return t.branch||"-"}},{title:l.ZP.get("定时规则"),width:180,render:function(e,t){if("interval"===t.schedule_type){var n=t.interval_schedule,i=n.type,r=n.value;return"每".concat(r).concat(L[i])}return t.schedule}},{title:l.ZP.get("状态"),key:"status",dataIndex:"status",width:110,filters:[{text:l.ZP.get("运行中"),value:0},{text:l.ZP.get("空闲中"),value:1},{text:l.ZP.get("已禁用"),value:2}],onFilter:function(e,t){return t.is_disabled&&0!==t.status?2===e:t.status===e},render:function(e,t){return(0,R.jsxs)(R.Fragment,{children:[(!t.is_disabled||t.status!==q.idle)&&(0,R.jsxs)(R.Fragment,{children:[t.status===q.idle&&(0,R.jsx)(g.Z,{icon:(0,R.jsx)(P.Z,{}),color:"default",children:l.ZP.get("空闲中")}),t.status===q.running&&(0,R.jsx)(g.Z,{icon:(0,R.jsx)(y.Z,{spin:!0}),color:"processing",children:l.ZP.get("运行中")})]}),1===t.is_disabled&&t.status===q.idle&&(0,R.jsx)(g.Z,{icon:(0,R.jsx)(j.Z,{}),color:"error",children:l.ZP.get("已禁用")})]})}},{title:l.ZP.get("操作"),key:"action",width:140,render:function(e,t,n){return(0,R.jsxs)(p.Z,{size:"middle",children:[t.status===q.idle&&(0,R.jsx)("a",{onClick:function(e){e.stopPropagation(),Ce(t,n)},children:l.ZP.get("运行")}),t.status!==q.idle&&(0,R.jsx)("a",{onClick:function(e){e.stopPropagation(),Se(t,n)},children:l.ZP.get("停止")}),(0,R.jsx)("a",{onClick:function(e){e.stopPropagation(),Pe(s()(s()({},t),{},{timestamp:Date.now()}))},children:l.ZP.get("日志")}),(0,R.jsx)(ze,{record:t,index:n},"more")]})}}],o=(0,u.useState)([]),d=c()(o,2),f=d[0],D=d[1],V=(0,u.useState)(!0),$=c()(V,2),K=$[0],Q=$[1],U=(0,u.useState)(!1),A=c()(U,2),G=A[0],J=A[1],X=(0,u.useState)(),Y=c()(X,2),ee=Y[0],te=Y[1],ne=(0,u.useState)(""),ie=c()(ne,2),re=ie[0],ae=ie[1],ce=(0,u.useState)(1),oe=c()(ce,2),se=oe[0],le=oe[1],ue=(0,u.useState)(20),de=c()(ue,2),fe=de[0],ge=de[1],pe=(0,u.useState)(!1),he=c()(pe,2),Ze=he[0],me=he[1],xe=(0,u.useState)(),ve=c()(xe,2),be=ve[0],Pe=ve[1],ye=(0,u.useRef)(null),je=(0,N.Z)(ye),ke=(0,u.useRef)(!1),Ce=function(e,t){h.Z.confirm({title:l.ZP.get("确认运行"),content:(0,R.jsxs)(R.Fragment,{children:[l.ZP.get("确认运行定时任务")," ",(0,R.jsx)(W,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗")]}),onOk:function(){O.W.put("".concat(I.Z.apiPrefix,"subscriptions/run"),[e.id]).then((function(t){var n=t.code;t.data;if(200===n){var i=r()(f),a=i.findIndex((function(t){return t.id===e.id}));-1!==a&&(i.splice(a,1,s()(s()({},e),{},{status:q.running})),D(i))}}))},onCancel:function(){console.log("Cancel")}})},Se=function(e,t){h.Z.confirm({title:l.ZP.get("确认停止"),content:(0,R.jsxs)(R.Fragment,{children:[l.ZP.get("确认停止定时任务")," ",(0,R.jsx)(W,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗")]}),onOk:function(){O.W.put("".concat(I.Z.apiPrefix,"subscriptions/stop"),[e.id]).then((function(t){var n=t.code;t.data;if(200===n){var i=r()(f),a=i.findIndex((function(t){return t.id===e.id}));-1!==a&&(i.splice(a,1,s()(s()({},e),{},{pid:null,status:q.idle})),D(i))}}))},onCancel:function(){console.log("Cancel")}})},we=function(e){ke.current=e.target.checked},ze=function(e){var t=e.record,n=e.index;return(0,R.jsx)(x.Z,{placement:"bottomRight",trigger:["click"],menu:{items:[{label:l.ZP.get("编辑"),key:"edit",icon:(0,R.jsx)(k.Z,{})},{label:1===t.is_disabled?l.ZP.get("启用"):l.ZP.get("禁用"),key:"enableOrDisable",icon:1===t.is_disabled?(0,R.jsx)(C.Z,{}):(0,R.jsx)(S.Z,{})},{label:l.ZP.get("删除"),key:"delete",icon:(0,R.jsx)(w.Z,{})}],onClick:function(e){var i=e.key;e.domEvent.stopPropagation(),Ie(i,t,n)}},children:(0,R.jsx)("a",{onClick:function(e){return e.stopPropagation()},children:(0,R.jsx)(z.Z,{})})})},Ie=function(e,t,n){switch(e){case"edit":!function(e,t){te(e),J(!0)}(t);break;case"enableOrDisable":!function(e,t){h.Z.confirm({title:"确认".concat(1===e.is_disabled?l.ZP.get("启用"):l.ZP.get("禁用")),content:(0,R.jsxs)(R.Fragment,{children:[l.ZP.get("确认"),1===e.is_disabled?l.ZP.get("启用"):l.ZP.get("禁用"),l.ZP.get("定时订阅")," ",(0,R.jsx)(W,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗")]}),onOk:function(){O.W.put("".concat(I.Z.apiPrefix,"subscriptions/").concat(1===e.is_disabled?"enable":"disable"),[e.id]).then((function(t){var n=t.code;if(t.data,200===n){var i=1===e.is_disabled?0:1,a=r()(f),c=a.findIndex((function(t){return t.id===e.id}));-1!==c&&(a.splice(c,1,s()(s()({},e),{},{is_disabled:i})),D(a))}}))},onCancel:function(){console.log("Cancel")}})}(t);break;case"delete":!function(e,t){h.Z.confirm({title:l.ZP.get("确认删除"),content:(0,R.jsxs)(R.Fragment,{children:[l.ZP.get("确认删除定时订阅")," ",(0,R.jsx)(W,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗"),(0,R.jsx)("div",{style:{marginTop:20},children:(0,R.jsx)(Z.Z,{onChange:we,children:l.ZP.get("同时删除关联任务和脚本")})})]}),onOk:function(){O.W.delete("".concat(I.Z.apiPrefix,"subscriptions"),{data:[e.id],params:{force:ke.current}}).then((function(t){var n=t.code;if(t.data,200===n){m.ZP.success(l.ZP.get("删除成功"));var i=r()(f),a=i.findIndex((function(t){return t.id===e.id}));-1!==a&&(i.splice(a,1),D(i))}}))},onCancel:function(){console.log("Cancel")}})}(t)}},Ee=function(e){var t=f.findIndex((function(t){return t.id===e.id})),n=r()(f);-1===t?n.unshift(e):n.splice(t,1,s()({},e)),D(n)};return(0,u.useEffect)((function(){if(i){var e=i.type,t=(i.message,i.references);if("runSubscriptionEnd"===e&&t.length>0){for(var n=r()(f),a=function(e){var i=f.findIndex((function(n){return n.id===t[e]}));-1!==i&&n.splice(i,1,s()(s()({},f[i]),{},{status:q.idle}))},c=0;c<t.length;c++)a(c);D(n)}}}),[i]),(0,u.useEffect)((function(){be&&(localStorage.setItem("logSubscription",be.id),me(!0))}),[be]),(0,u.useEffect)((function(){Q(!0),O.W.get("".concat(I.Z.apiPrefix,"subscriptions?searchValue=").concat(re)).then((function(e){var t=e.code,n=e.data;200===t&&(D(n),le(1))})).finally((function(){return Q(!1)}))}),[re]),(0,u.useEffect)((function(){ge(parseInt(localStorage.getItem("pageSize")||"20"))}),[]),(0,R.jsxs)(E.ZP,{className:"ql-container-wrapper subscriptiontab-wrapper",title:l.ZP.get("订阅管理"),extra:[(0,R.jsx)(H,{placeholder:l.ZP.get("请输入名称或者关键词"),style:{width:"auto"},enterButton:!0,allowClear:!0,loading:K,onSearch:function(e){ae(e.trim())}}),(0,R.jsx)(v.Z,{type:"primary",onClick:function(){return te(null),void J(!0)},children:l.ZP.get("创建订阅")},"2")],header:{style:t},children:[(0,R.jsx)(b.Z,{ref:ye,columns:a,pagination:{current:se,onChange:function(e,t){le(e),ge(t),localStorage.setItem("pageSize",t+"")},pageSize:fe,showSizeChanger:!0,simple:n,defaultPageSize:20,showTotal:function(e,t){return"第 ".concat(t[0],"-").concat(t[1]," 条/总共 ").concat(e," 条")},pageSizeOptions:[20,100,500,1e3]},dataSource:f,rowKey:"id",size:"middle",scroll:{x:1e3,y:je},loading:K,rowClassName:function(e,t){return e.isPinned?"pinned-subscription subscription":"subscription"}}),(0,R.jsx)(_.default,{visible:G,handleCancel:function(e){J(!1),e&&Ee(e)},subscription:ee}),(0,R.jsx)(F.default,{visible:Ze,handleCancel:function(){me(!1)},subscription:be})]})}},78074:function(e,t,n){n.r(t);var i=n(54306),r=n.n(i),a=n(88265),c=n(63313),o=n(84163),s=n(24378),l=n(95176),u=n(5558),d=n(65601),f=n(38101),g=n(91796),p=n(82428),h=n(11527);t.default=function(e){var t=e.subscription,n=e.handleCancel,i=e.visible,Z=e.data,m=e.logUrl,x=(0,c.useState)(a.ZP.get("启动中...")),v=r()(x,2),b=v[0],P=v[1],y=(0,c.useState)(!0),j=r()(y,2),k=j[0],C=j[1],S=(0,c.useState)(!0),w=r()(S,2),z=w[0],I=w[1],E=(0,c.useState)(!1),O=r()(E,2),_=O[0],B=O[1],F=function e(n){n&&C(!0),l.W.get(m||"".concat(u.Z.apiPrefix,"subscriptions/").concat(t.id,"/log")).then((function(n){var i=n.code,r=n.data;if(200===i&&localStorage.getItem("logSubscription")===String(t.id)){var c=r;P(c||a.ZP.get("暂无日志")),I(c&&!(0,p.x$)(c)),c&&!(0,p.x$)(c)&&setTimeout((function(){e()}),2e3)}})).finally((function(){n&&C(!1)}))},N=function(){localStorage.removeItem("logSubscription"),n()};return(0,c.useEffect)((function(){t&&t.id&&i&&F(!0)}),[t,i]),(0,c.useEffect)((function(){Z&&P(Z)}),[Z]),(0,c.useEffect)((function(){B(document.body.clientWidth<768)}),[]),(0,h.jsx)(o.Z,{title:(0,h.jsxs)(h.Fragment,{children:[(z||k)&&(0,h.jsx)(d.Z,{spin:!0}),!z&&!k&&(0,h.jsx)(f.Z,{}),(0,h.jsx)("span",{style:{marginLeft:5},children:t&&t.name})]}),open:i,centered:!0,className:"log-modal",forceRender:!0,onOk:function(){return N()},onCancel:function(){return N()},footer:[(0,h.jsx)(s.Z,{type:"primary",onClick:function(){return N()},children:a.ZP.get("知道了")})],children:(0,h.jsx)("div",{className:"log-container",children:k?(0,h.jsx)(g.Z,{}):(0,h.jsx)("pre",{style:_?{fontFamily:"Source Code Pro",zoom:.83}:{},children:b})})})}}}]);