"use strict";(self.webpackChunk_whyour_qinglong=self.webpackChunk_whyour_qinglong||[]).push([[5586],{79297:function(e,t,n){n.r(t);var i=n(26068),a=n.n(i),o=n(48305),r=n.n(o),s=n(72317),c=n(75271),l=n(35181),u=n(53390),d=n(88142),h=n(93481),p=n(16314),f=n(3475),m=n(43382),v=n(83383),g=n(90310),b=n(3843),y=n(9364),x=n(48916),k=n(65814),Z=n(78060),S=n.n(Z),w=n(52676),C=l.Z.Option;t.default=function(e){var t=e.treeData,n=e.currentNode,i=e.content,o=e.handleCancel,Z=(0,c.useState)(""),P=r()(Z,2),I=P[0],j=P[1],O=(0,c.useState)(),E=r()(O,2),N=E[0],_=E[1],R=(0,c.useState)(),F=r()(R,2),M=F[0],H=F[1],A=(0,c.useState)(),L=r()(A,2),T=L[0],W=L[1],q=(0,c.useState)(!1),z=r()(q,2),D=z[0],V=z[1],B=(0,c.useState)(!1),J=r()(B,2),X=J[0],$=J[1],U=(0,c.useState)(""),G=r()(U,2),Y=G[0],K=G[1],Q=(0,y.F)().theme,ee=(0,c.useRef)(null),te=(0,c.useState)(!1),ne=r()(te,2),ie=ne[0],ae=ne[1],oe=(0,c.useState)(null),re=r()(oe,2),se=re[0],ce=re[1],le=function(e){p.W.get("".concat(f.Z.apiPrefix,"scripts/detail?file=").concat(e.title,"&path=").concat(e.parent||"")).then((function(e){var t=e.code,n=e.data;200===t&&j(n)}))},ue=function(){M&&M.title&&se&&p.W.put("".concat(f.Z.apiPrefix,"scripts/stop"),{filename:M.title,path:M.parent||"",pid:se}).then((function(e){var t=e.code;e.data;200===t&&ae(!1)}))},de=(0,c.useCallback)((function(e){var t=e.message;(0,x.x$)(t)&&setTimeout((function(){ae(!1)}),300),K((function(e){return"".concat(e).concat(t)}))}),[]);return(0,c.useEffect)((function(){var e=k.Z.getInstance();return e.subscribe("manuallyRunScript",de),function(){e.unsubscribe("manuallyRunScript",de)}}),[]),(0,c.useEffect)((function(){if(K(""),n){H(n),j(i),W(n.key);var e=(0,x.H$)(n.title);_(e)}}),[i,n]),(0,w.jsxs)(u.Z,{className:"edit-modal",closable:!1,title:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(d.Z,{treeExpandAction:"click",style:{marginRight:8,width:300},value:T,dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:t,placeholder:s.ZP.get("请选择脚本文件"),fieldNames:{value:"key",label:"title"},showSearch:!0,onSelect:function(e,t){if(t.key!==T&&e&&"directory"!==t.type){var n=(0,x.H$)(e);H(t),_(n),le(t),W(t.key)}},treeLine:{showLeafIcon:!0}}),(0,w.jsxs)(l.Z,{value:N,style:{width:110,marginRight:8},onChange:function(e){_(e)},children:[(0,w.jsx)(C,{value:"javascript",children:"javascript"}),(0,w.jsx)(C,{value:"typescript",children:"typescript"}),(0,w.jsx)(C,{value:"shell",children:"shell"}),(0,w.jsx)(C,{value:"python",children:"python"})]}),(0,w.jsx)(h.Z,{type:"primary",style:{marginRight:8},onClick:ie?ue:function(){K("");var e=ee.current.getValue().replace(/\r\n/g,"\n");p.W.put("".concat(f.Z.apiPrefix,"scripts/run"),{filename:M.title,path:M.parent||"",content:e}).then((function(e){var t=e.code,n=e.data;200===t&&(ae(!0),ce(n))}))},children:ie?s.ZP.get("停止"):s.ZP.get("运行")}),(0,w.jsx)(h.Z,{type:"primary",style:{marginRight:8},onClick:function(){K("")},children:s.ZP.get("清空日志")}),(0,w.jsx)(h.Z,{type:"primary",style:{marginRight:8},onClick:function(){V(!0)},children:s.ZP.get("保存")}),(0,w.jsx)(h.Z,{type:"primary",style:{marginRight:8},onClick:function(){ue(),o()},children:s.ZP.get("退出")})]}),width:"100%",headerStyle:{padding:"11px 24px"},onClose:function(){o()},open:!0,children:[(0,w.jsxs)(m.Z,{split:"vertical",minSize:200,defaultSize:"50%",style:{height:"calc(100vh - 55px)"},pane2Style:{overflowY:"auto"},children:[(0,w.jsx)(v.ZP,{language:N,value:I,theme:Q,options:{fontSize:12,minimap:{enabled:!1},lineNumbersMinChars:3,glyphMargin:!1,accessibilitySupport:"off"},onMount:function(e){ee.current=e}}),(0,w.jsx)("pre",{style:{padding:"0 15px"},children:(0,w.jsx)(S(),{children:Y})})]}),D&&(0,w.jsx)(g.default,{handleCancel:function(){V(!1)},file:a()({content:ee.current&&ee.current.getValue().replace(/\r\n/g,"\n")},M)}),X&&(0,w.jsx)(b.default,{handleCancel:function(){$(!1)}})]})}},90310:function(e,t,n){n.r(t);var i=n(90228),a=n.n(i),o=n(26068),r=n.n(o),s=n(87999),c=n.n(s),l=n(48305),u=n.n(l),d=n(72317),h=n(75271),p=n(72338),f=n(61508),m=n(45520),v=n(17082),g=n(16314),b=n(3475),y=n(52676);t.default=function(e){var t=e.file,n=e.handleCancel,i=p.Z.useForm(),o=u()(i,1)[0],s=(0,h.useState)(!1),l=u()(s,2),x=l[0],k=l[1],Z=function(){var e=c()(a()().mark((function e(i){var o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k(!0),o=r()(r()({},i),{},{originFilename:t.title,content:t.content}),g.W.post("".concat(b.Z.apiPrefix,"scripts"),o).then((function(e){var t=e.code,i=e.data;200===t&&(f.ZP.success(d.ZP.get("保存文件成功")),n(i))})).finally((function(){k(!1)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,y.jsx)(m.Z,{title:d.ZP.get("保存文件"),open:!0,forceRender:!0,centered:!0,maskClosable:!1,onOk:function(){o.validateFields().then((function(e){Z(e)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){return n()},confirmLoading:x,children:(0,y.jsxs)(p.Z,{form:o,layout:"vertical",name:"script_modal",initialValues:{filename:null==t?void 0:t.title,path:(null==t?void 0:t.parent)||""},children:[(0,y.jsx)(p.Z.Item,{name:"filename",label:d.ZP.get("文件名"),rules:[{required:!0,message:d.ZP.get("请输入文件名")}],children:(0,y.jsx)(v.Z,{placeholder:d.ZP.get("请输入文件名")})}),(0,y.jsx)(p.Z.Item,{name:"path",label:d.ZP.get("保存目录"),children:(0,y.jsx)(v.Z,{placeholder:d.ZP.get("请输入保存目录，默认scripts目录")})})]})})}},3843:function(e,t,n){n.r(t);n(90228),n(26068),n(87999);var i=n(48305),a=n.n(i),o=n(72317),r=n(75271),s=n(72338),c=(n(61508),n(45520)),l=n(17082),u=(n(16314),n(3475),n(52676));t.default=function(e){var t=e.file,n=e.handleCancel,i=s.Z.useForm(),d=a()(i,1)[0],h=(0,r.useState)(!1),p=a()(h,2);p[0],p[1];return(0,u.jsx)(c.Z,{title:o.ZP.get("运行设置"),open:!0,forceRender:!0,centered:!0,onCancel:function(){return n()},children:(0,u.jsx)(s.Z,{form:d,layout:"vertical",name:"setting_modal",initialValues:t,children:(0,u.jsx)(s.Z.Item,{name:"filename",label:o.ZP.get("待开发"),rules:[{required:!0,message:o.ZP.get("待开发")}],children:(0,u.jsx)(l.Z,{placeholder:o.ZP.get("待开发")})})})})}},9364:function(e,t,n){n.d(t,{F:function(){return c},e:function(){return s}});var i=n(48305),a=n.n(i),o=n(75271),r=n(48916),s=function(){var e=(0,o.useState)("100%"),t=a()(e,2),n=t[0],i=t[1],s=(0,o.useState)(0),c=a()(s,2),l=c[0],u=c[1],d=(0,o.useState)(-48),h=a()(d,2),p=h[0],f=h[1],m=(0,o.useState)(!1),v=a()(m,2),g=v[0],b=v[1],y=(0,o.useMemo)((function(){return(0,r.ZP)()}),[]).platform;return(0,o.useEffect)((function(){"mobile"===y&&document.body.offsetWidth<768?(i("auto"),u(0),f(0),b(!0),document.body.setAttribute("data-mode","phone")):(i("100%"),u(0),f(-48),b(!1),document.body.setAttribute("data-mode","desktop"))}),[]),{headerStyle:{padding:"4px 16px 4px 15px",position:"sticky",top:0,left:0,zIndex:20,marginTop:p,width:n,marginLeft:l},isPhone:g}},c=function(){var e=(0,o.useState)(),t=a()(e,2),n=t[0],i=t[1];return(0,o.useEffect)((function(){var e=window.matchMedia("(prefers-color-scheme: dark)"),t=localStorage.getItem("qinglong_dark_theme"),n=e.matches&&"light"!==t||"dark"===t;i(n?"vs-dark":"vs");var a=function(e){"auto"!==t&&t||(e.matches?i("vs-dark"):i("vs"))};"function"==typeof e.addEventListener?e.addEventListener("change",a):"function"==typeof e.addListener&&e.addListener(a)}),[]),{theme:n,reloadTheme:function(){var e=window.matchMedia("(prefers-color-scheme: dark)"),t=localStorage.getItem("qinglong_dark_theme"),n=e.matches&&"light"!==t||"dark"===t;i(n?"vs-dark":"vs")}}}},65814:function(e,t,n){var i=n(15558),a=n.n(i),o=n(67825),r=n.n(o),s=n(90228),c=n.n(s),l=n(87999),u=n.n(l),d=n(25298),h=n.n(d),p=n(17069),f=n.n(p),m=n(82092),v=n.n(m),g=n(78078),b=n.n(g),y=["type"],x=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h()(this,e),v()(this,"url",void 0),v()(this,"socket",null),v()(this,"subscriptions",new Map),v()(this,"options",void 0),v()(this,"reconnectAttempts",0),v()(this,"heartbeatTimeout",null),v()(this,"state","closed"),this.url=t,this.options={maxReconnectAttempts:n.maxReconnectAttempts||5,reconnectInterval:n.reconnectInterval||3e3,heartbeatInterval:n.heartbeatInterval||3e4},this.init()}var t,n;return f()(e,[{key:"init",value:(n=u()(c()().mark((function e(){var t=this;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.state="connecting",this.emit("connecting");case 3:if(!(this.reconnectAttempts<this.options.maxReconnectAttempts)){e.next=16;break}return this.socket=new(b())(this.url),this.setupEventListeners(),this.startHeartbeat(),e.next=9,this.waitForClose();case 9:return this.stopHeartbeat(),this.socket=null,this.reconnectAttempts++,e.next=14,new Promise((function(e){return setTimeout(e,t.options.reconnectInterval)}));case 14:e.next=3;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.handleError(e.t0);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(){return n.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var e=this;this.socket&&(this.socket.onopen=function(){e.state="open",e.emit("open")},this.socket.onmessage=function(t){var n=JSON.parse(t.data);e.dispatchMessage(n)},this.socket.onclose=function(){e.state="closed",e.emit("close")})}},{key:"waitForClose",value:(t=u()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=this.socket)||void 0===t?void 0:t.readyState)===b().CLOSED){e.next=5;break}return e.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"subscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(!n.has(t)){n.add(t),this.subscriptions.set(e,n);var i={action:"subscribe",topic:e};this.send(i)}}},{key:"unsubscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(n.has(t)){n.delete(t);var i={action:"unsubscribe",topic:e};this.send(i)}}},{key:"send",value:function(e){var t;(null===(t=this.socket)||void 0===t?void 0:t.readyState)===b().OPEN&&this.socket.send(JSON.stringify(e))}},{key:"dispatchMessage",value:function(e){var t=e.type,n=r()(e,y),i=this.subscriptions.get(t)||new Set;a()(i).forEach((function(e){return e(n)}))}},{key:"startHeartbeat",value:function(){var e=this;this.heartbeatTimeout=setInterval((function(){var t;(null===(t=e.socket)||void 0===t?void 0:t.readyState)===b().OPEN&&e.socket.send(JSON.stringify({type:"heartbeat"}))}),this.options.heartbeatInterval)}},{key:"stopHeartbeat",value:function(){this.heartbeatTimeout&&clearInterval(this.heartbeatTimeout)}},{key:"close",value:function(){this.socket&&(this.state="closed",this.stopHeartbeat(),this.socket.close(),this.emit("close"))}},{key:"handleError",value:function(e){console.error("WebSocket错误:",e),this.emit("error",e)}},{key:"on",value:function(e,t){}},{key:"emit",value:function(e,t){}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return e.instance||(e.instance=new e(t,n)),e.instance}}]),e}();v()(x,"instance",null),t.Z=x},35181:function(e,t,n){var i=n(57904),a=n(2053),o=n(82187),r=n.n(o),s=n(77168),c=n(2021),l=n(75271),u=n(96820),d=n(83289),h=n(30107),p=n(38470),f=n(5663),m=n(21485),v=n(28800),g=n(50528),b=n(81393),y=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(n[i[a]]=e[i[a]])}return n},x="SECRET_COMBOBOX_MODE_DO_NOT_USE",k=function(e,t){var n,o=e.prefixCls,k=e.bordered,Z=void 0===k||k,S=e.className,w=e.getPopupContainer,C=e.dropdownClassName,P=e.popupClassName,I=e.listHeight,j=void 0===I?256:I,O=e.placement,E=e.listItemHeight,N=void 0===E?32:E,_=e.size,R=e.disabled,F=e.notFoundContent,M=e.status,H=e.showArrow,A=y(e,["prefixCls","bordered","className","getPopupContainer","dropdownClassName","popupClassName","listHeight","placement","listItemHeight","size","disabled","notFoundContent","status","showArrow"]),L=l.useContext(u.E_),T=L.getPopupContainer,W=L.getPrefixCls,q=L.renderEmpty,z=L.direction,D=L.virtual,V=L.dropdownMatchSelectWidth,B=l.useContext(p.Z),J=W("select",o),X=W(),$=(0,b.ri)(J,z),U=$.compactSize,G=$.compactItemClassnames,Y=l.useMemo((function(){var e=A.mode;if("combobox"!==e)return e===x?"combobox":e}),[A.mode]),K="multiple"===Y||"tags"===Y,Q=void 0!==H?H:A.loading||!(K||"combobox"===Y),ee=(0,l.useContext)(f.aM),te=ee.status,ne=ee.hasFeedback,ie=ee.isFormItemInput,ae=ee.feedbackIcon,oe=(0,v.F)(te,M);n=void 0!==F?F:"combobox"===Y?null:(q||d.Z)("Select");var re=(0,g.Z)((0,a.Z)((0,a.Z)({},A),{multiple:K,hasFeedback:ne,feedbackIcon:ae,showArrow:Q,prefixCls:J})),se=re.suffixIcon,ce=re.itemIcon,le=re.removeIcon,ue=re.clearIcon,de=(0,c.Z)(A,["suffixIcon","itemIcon"]),he=r()(P||C,(0,i.Z)({},"".concat(J,"-dropdown-").concat(z),"rtl"===z)),pe=U||_||B,fe=l.useContext(h.Z),me=null!=R?R:fe,ve=r()((0,i.Z)((0,i.Z)((0,i.Z)((0,i.Z)((0,i.Z)({},"".concat(J,"-lg"),"large"===pe),"".concat(J,"-sm"),"small"===pe),"".concat(J,"-rtl"),"rtl"===z),"".concat(J,"-borderless"),!Z),"".concat(J,"-in-form-item"),ie),(0,v.Z)(J,oe,ne),G,S);return l.createElement(s.ZP,(0,a.Z)({ref:t,virtual:D,dropdownMatchSelectWidth:V},de,{transitionName:(0,m.mL)(X,(0,m.q0)(O),A.transitionName),listHeight:j,listItemHeight:N,mode:Y,prefixCls:J,placement:void 0!==O?O:"rtl"===z?"bottomRight":"bottomLeft",direction:z,inputIcon:se,menuItemSelectedIcon:ce,removeIcon:le,clearIcon:ue,notFoundContent:n,className:ve,getPopupContainer:w||T,dropdownClassName:he,showArrow:ne||H,disabled:me}))},Z=l.forwardRef(k);Z.SECRET_COMBOBOX_MODE_DO_NOT_USE=x,Z.Option=s.Wx,Z.OptGroup=s.Xo,t.Z=Z}}]);