"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9914,7243],{38582:function(e,t,n){var i=(0,n(55258).Z)({scriptUrl:["//at.alicdn.com/t/c/font_3354854_lc939gab1iq.js"]});t.Z=i},9839:function(e,t,n){var i=n(54306),a=n.n(i),s=n(63313),c=n(61761),r=n(40141);t.Z=function(e,t){var n=(0,s.useState)(0),i=a()(n,2),o=i[0],l=i[1];return(0,c.Z)(e,(function(e){var n=e.target;n.classList.contains("ant-table-wrapper")||(n=e.target.querySelector(".ant-table-wrapper")),l((0,r.W9)({extraHeight:t,target:n}))})),o}},51578:function(e,t,n){n.r(t),n.d(t,{default:function(){return K}});var i=n(93525),a=n.n(i),s=n(54306),c=n.n(s),r=n(57213),o=n.n(r),l=n(88265),u=n(63313),d=n(92260),f=n(22159),h=n(2947),p=n(51704),g=n(15367),v=n(84163),x=n(24378),m=n(86986),Z=n(94674),y=n(28557),j=n(38101),k=n(76657),P=n(20209),b=n(32320),S=n(97674),w=n(5868),C=n(13740),I=n(42011),D=n(15207),F=n(23435),E=n(57229),O=n(53261),A=n(12701),W=n(66255),T=n(71467),L=n(14851),q=n(9839),H=n(52053),R=n.n(H),N=n(21758),B=n(57190),Y=n(38582),z=n(11527),M=d.Z.Text,V=f.Z.Search,J={0:{icon:(0,z.jsx)(y.Z,{spin:!0}),color:"processing"},1:{icon:(0,z.jsx)(j.Z,{}),color:"success"},2:{icon:(0,z.jsx)(k.Z,{}),color:"error"},3:{icon:(0,z.jsx)(y.Z,{spin:!0}),color:"processing"},4:{icon:(0,z.jsx)(j.Z,{}),color:"success"},5:{icon:(0,z.jsx)(k.Z,{}),color:"error"},6:{icon:(0,z.jsx)(P.Z,{}),color:"default"},7:{icon:(0,z.jsx)(b.Z,{}),color:"default"}},K=function(){var e=(0,L.useOutletContext)(),t=e.headerStyle,n=e.isPhone,i=[{title:l.ZP.get("序号"),width:90,render:function(e,t,n){return(0,z.jsxs)("span",{style:{cursor:"text"},children:[n+1," "]})}},{title:l.ZP.get("名称"),dataIndex:"name",width:180,key:"name"},{title:l.ZP.get("状态"),key:"status",width:120,dataIndex:"status",filters:[{text:l.ZP.get("队列中"),value:B.DependenceStatus.queued},{text:l.ZP.get("安装中"),value:B.DependenceStatus.installing},{text:l.ZP.get("已安装"),value:B.DependenceStatus.installed},{text:l.ZP.get("安装失败"),value:B.DependenceStatus.installFailed},{text:l.ZP.get("删除中"),value:B.DependenceStatus.removing},{text:l.ZP.get("已删除"),value:B.DependenceStatus.removed},{text:l.ZP.get("删除失败"),value:B.DependenceStatus.removeFailed},{text:l.ZP.get("已取消"),value:B.DependenceStatus.cancelled}],render:function(e,t,n){var i,a;return(0,z.jsx)(h.Z,{size:"middle",style:{cursor:"text"},children:(0,z.jsx)(p.Z,{color:null===(i=J[t.status])||void 0===i?void 0:i.color,icon:null===(a=J[t.status])||void 0===a?void 0:a.icon,style:{marginRight:0},children:l.ZP.get(B.Status[t.status])})})}},{title:l.ZP.get("备注"),dataIndex:"remark",width:100,key:"remark"},{title:l.ZP.get("更新时间"),key:"updatedAt",dataIndex:"updatedAt",width:150,render:function(e){return(0,z.jsx)("span",{children:R()(e).format("YYYY-MM-DD HH:mm:ss")})}},{title:l.ZP.get("创建时间"),key:"createdAt",dataIndex:"createdAt",width:150,render:function(e){return(0,z.jsx)("span",{children:R()(e).format("YYYY-MM-DD HH:mm:ss")})}},{title:l.ZP.get("操作"),key:"action",width:140,render:function(e,t,i){var a=!n;return(0,z.jsxs)(h.Z,{size:"middle",children:[![B.Status["队列中"],B.Status["已取消"]].includes(t.status)&&(0,z.jsx)(g.Z,{title:a?l.ZP.get("日志"):"",children:(0,z.jsx)("a",{onClick:function(){ue(o()(o()({},t),{},{timestamp:Date.now()}))},children:(0,z.jsx)(S.Z,{})})}),[B.Status["队列中"],B.Status["安装中"],B.Status["删除中"]].includes(t.status)?(0,z.jsx)(g.Z,{title:a?l.ZP.get("取消安装"):"",children:(0,z.jsx)("a",{onClick:function(){return be(t)},children:(0,z.jsx)(Y.Z,{type:"ql-icon-quxiaoanzhuang"})})}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(g.Z,{title:a?l.ZP.get("重新安装"):"",children:(0,z.jsx)("a",{onClick:function(){return Pe(t,i)},children:(0,z.jsx)(w.Z,{})})}),B.Status["已安装"]===t.status&&(0,z.jsx)(g.Z,{title:a?l.ZP.get("删除"):"",children:(0,z.jsx)("a",{onClick:function(){return ke(t,i)},children:(0,z.jsx)(C.Z,{})})}),(0,z.jsx)(g.Z,{title:a?l.ZP.get("强制删除"):"",children:(0,z.jsx)("a",{onClick:function(){return ke(t,i,!0)},children:(0,z.jsx)(I.Z,{})})})]})]})}}],s=(0,u.useState)([]),r=c()(s,2),d=r[0],f=r[1],y=(0,u.useState)(!0),j=c()(y,2),k=j[0],P=j[1],b=(0,u.useState)(!1),H=c()(b,2),K=H[0],_=H[1],G=(0,u.useState)(),U=c()(G,2),Q=U[0],X=U[1],$=(0,u.useState)([]),ee=c()($,2),te=ee[0],ne=ee[1],ie=(0,u.useState)(""),ae=c()(ie,2),se=ae[0],ce=ae[1],re=(0,u.useState)(),oe=c()(re,2),le=oe[0],ue=oe[1],de=(0,u.useState)(!1),fe=c()(de,2),he=fe[0],pe=fe[1],ge=(0,u.useState)("nodejs"),ve=c()(ge,2),xe=ve[0],me=ve[1],Ze=(0,u.useRef)(null),ye=(0,q.Z)(Ze,59),je=function(e){P(!0),E.W.get("".concat(D.Z.apiPrefix,"dependencies?searchValue=").concat(se,"&type=").concat(xe,"&status=").concat(e||"")).then((function(e){var t=e.code,n=e.data;200===t&&f(n)})).finally((function(){return P(!1)}))},ke=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];v.Z.confirm({title:l.ZP.get("确认删除"),content:(0,z.jsxs)(z.Fragment,{children:[l.ZP.get("确认删除依赖")," ",(0,z.jsx)(M,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗")]}),onOk:function(){E.W.delete("".concat(D.Z.apiPrefix,"dependencies").concat(n?"/force":""),{data:[e.id]}).then((function(e){var t=e.code,i=e.data;if(200===t&&n){var s=d.findIndex((function(e){return e.id===i[0].id}));if(-1!==s){var c=a()(d);c.splice(s,1),f(c)}}}))},onCancel:function(){console.log("Cancel")}})},Pe=function(e,t){v.Z.confirm({title:l.ZP.get("确认重新安装"),content:(0,z.jsxs)(z.Fragment,{children:[l.ZP.get("确认重新安装")," ",(0,z.jsx)(M,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗")]}),onOk:function(){E.W.put("".concat(D.Z.apiPrefix,"dependencies/reinstall"),[e.id]).then((function(e){var t=e.code,n=e.data;200===t&&Se(n[0])}))},onCancel:function(){console.log("Cancel")}})},be=function(e){v.Z.confirm({title:l.ZP.get("确认取消安装"),content:(0,z.jsxs)(z.Fragment,{children:[l.ZP.get("确认取消安装")," ",(0,z.jsx)(M,{style:{wordBreak:"break-all"},type:"warning",children:e.name})," ",l.ZP.get("吗")]}),onOk:function(){E.W.put("".concat(D.Z.apiPrefix,"dependencies/cancel"),[e.id]).then((function(){je()}))},onCancel:function(){console.log("Cancel")}})},Se=function(e){var t=a()(d);if(Array.isArray(e))t.unshift.apply(t,a()(e));else{var n=d.findIndex((function(t){return t.id===e.id}));-1!==n&&t.splice(n,1,o()({},e))}f(t)},we={selectedRowKeys:te,onChange:function(e){ne(e)}},Ce=function(e){var t=e?"/force":"";v.Z.confirm({title:l.ZP.get("确认删除"),content:(0,z.jsx)(z.Fragment,{children:l.ZP.get("确认删除选中的依赖吗")}),onOk:function(){E.W.delete("".concat(D.Z.apiPrefix,"dependencies").concat(t),{data:te}).then((function(e){var t=e.code;e.data;200===t&&(ne([]),je())}))},onCancel:function(){console.log("Cancel")}})};(0,u.useEffect)((function(){je()}),[se,xe]),(0,u.useEffect)((function(){le&&(localStorage.setItem("logDependence",le.id),pe(!0))}),[le]);var Ie=(0,u.useCallback)((function(e){var t=e.message,n=e.references,i=void 0;t.includes("开始时间")&&n.length>0&&(i=t.includes("安装")?B.Status["安装中"]:B.Status["删除中"]),t.includes("结束时间")&&n.length>0&&(i=t.includes("安装")?t.includes("成功")?B.Status["已安装"]:B.Status["安装失败"]:t.includes("成功")?B.Status["已删除"]:B.Status["删除失败"])===B.Status["已删除"]?setTimeout((function(){f((function(e){for(var t=a()(e),i=function(i){var a=e.findIndex((function(e){return e.id===n[i]}));-1!==a&&t.splice(a,1)},s=0;s<n.length;s++)i(s);return t}))}),300):"number"==typeof i&&f((function(e){for(var t=a()(e),s=function(a){var s=e.findIndex((function(e){return e.id===n[a]}));-1!==s&&t.splice(s,1,o()(o()({},e[s]),{},{status:i}))},c=0;c<n.length;c++)s(c);return t}))}),[]);(0,u.useEffect)((function(){var e=N.Z.getInstance();return e.subscribe("installDependence",Ie),e.subscribe("uninstallDependence",Ie),function(){e.unsubscribe("installDependence",Ie),e.unsubscribe("uninstallDependence",Ie)}}),[]);return(0,z.jsxs)(F.ZP,{className:"ql-container-wrapper dependence-wrapper ql-container-wrapper-has-tab",title:l.ZP.get("依赖管理"),extra:[(0,z.jsx)(V,{placeholder:l.ZP.get("请输入名称"),style:{width:"auto"},enterButton:!0,loading:k,onSearch:function(e){ce(e.trim())}}),(0,z.jsx)(x.Z,{type:"primary",onClick:function(){return X(null),void _(!0)},children:l.ZP.get("创建依赖")},"2")],header:{style:t},children:[(0,z.jsx)(m.Z,{defaultActiveKey:"nodejs",size:"small",tabPosition:"top",onChange:function(e){ne([]),me(e)},items:[{key:"nodejs",label:"NodeJs"},{key:"python3",label:"Python3"},{key:"linux",label:"Linux"}]}),(0,z.jsxs)("div",{ref:Ze,children:[te.length>0&&(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsx)(x.Z,{type:"primary",style:{marginBottom:5,marginLeft:8},onClick:function(){v.Z.confirm({title:l.ZP.get("确认重新安装"),content:(0,z.jsx)(z.Fragment,{children:l.ZP.get("确认重新安装选中的依赖吗")}),onOk:function(){E.W.put("".concat(D.Z.apiPrefix,"dependencies/reinstall"),te).then((function(e){var t=e.code;e.data,200===t&&(ne([]),je())}))},onCancel:function(){console.log("Cancel")}})},children:l.ZP.get("批量安装")}),(0,z.jsx)(x.Z,{type:"primary",style:{marginBottom:5,marginLeft:8},onClick:function(){return Ce(!1)},children:l.ZP.get("批量删除")}),(0,z.jsx)(x.Z,{type:"primary",style:{marginBottom:5,marginLeft:8},onClick:function(){return Ce(!0)},children:l.ZP.get("批量强制删除")}),(0,z.jsxs)("span",{style:{marginLeft:8},children:[l.ZP.get("已选择"),(0,z.jsx)("a",{children:null==te?void 0:te.length}),l.ZP.get("项")]})]}),(0,z.jsx)(A.W,{backend:W.PD,children:(0,z.jsx)(Z.Z,{columns:i,rowSelection:we,pagination:!1,dataSource:d,rowKey:"id",size:"middle",scroll:{x:768,y:ye},loading:k,onChange:function(e,t){je(null==t?void 0:t.status)}})})]}),(0,z.jsx)(O.default,{visible:K,handleCancel:function(e){_(!1),e&&Se(e)},dependence:Q,defaultType:xe}),le&&(0,z.jsx)(T.default,{visible:he,handleCancel:function(e){if(pe(!1),e){var t=d.findIndex((function(e){return e.id===le.id})),n=a()(d);-1!==t&&(n.splice(t,1),f(n))}else a()(d).map((function(e){return e.id})).includes(le.id)&&function(e){E.W.get("".concat(D.Z.apiPrefix,"dependencies/").concat(e.id)).then((function(t){var n=t.code,i=t.data;if(200===n){var s=d.findIndex((function(t){return t.id===e.id})),c=a()(d);-1!==s&&(c.splice(s,1,o()(o()({},e),i)),f(c))}})).finally((function(){return P(!1)}))}(le)},dependence:le})]})}},71467:function(e,t,n){n.r(t);var i=n(54306),a=n.n(i),s=n(88265),c=n(63313),r=n(84163),o=n(24378),l=n(57229),u=n(15207),d=n(65601),f=n(38101),h=n(4574),p=n(99120),g=n.n(p),v=n(21758),x=n(57190),m=n(11527);t.default=function(e){var t=e.dependence,n=e.handleCancel,i=e.visible,p=(0,c.useState)(""),Z=a()(p,2),y=Z[0],j=Z[1],k=(0,c.useState)(!0),P=a()(k,2),b=P[0],S=P[1],w=(0,c.useState)(!1),C=a()(w,2),I=C[0],D=C[1],F=(0,c.useState)(!0),E=a()(F,2),O=E[0],A=E[1],W=(0,c.useState)(!1),T=a()(W,2),L=T[0],q=T[1],H=(0,c.useState)(!1),R=a()(H,2),N=R[0],B=R[1],Y=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];localStorage.removeItem("logDependence"),n(e)};(0,c.useEffect)((function(){t&&(A(!0),l.W.get("".concat(u.Z.apiPrefix,"dependencies/").concat(t.id)).then((function(e){var n=e.code,i=e.data;if(200===n&&localStorage.getItem("logDependence")===String(t.id)){var a=((null==i?void 0:i.log)||[]).join("");j(a),S(!a.includes("结束时间")),q(a.includes("删除失败"))}})).finally((function(){A(!1)})))}),[t]);var z=function(e){var n=e.message,i=e.references;i.length>0&&i.includes(t.id)&&[x.Status["删除中"],x.Status["安装中"]].includes(t.status)&&(n.includes("结束时间")&&(S(!1),q(n.includes("删除失败"))),j((function(e){return"".concat(e).concat(n)})))};return(0,c.useEffect)((function(){var e=v.Z.getInstance();return e.subscribe("installDependence",z),e.subscribe("uninstallDependence",z),function(){e.unsubscribe("installDependence",z),e.unsubscribe("uninstallDependence",z)}}),[t]),(0,c.useEffect)((function(){D(document.body.clientWidth<768)}),[]),(0,m.jsx)(r.Z,{title:(0,m.jsxs)(m.Fragment,{children:[b&&(0,m.jsx)(d.Z,{spin:!0}),!b&&(0,m.jsx)(f.Z,{}),(0,m.jsxs)("span",{style:{marginLeft:5},children:[s.ZP.get("日志 -")," ",t&&t.name]})," "]}),open:i,centered:!0,className:"log-modal",forceRender:!0,onOk:function(){return Y()},onCancel:function(){return Y()},footer:[(0,m.jsx)(o.Z,{type:"primary",onClick:function(){L?(B(!0),l.W.delete("".concat(u.Z.apiPrefix,"dependencies/force"),{data:[t.id]}).then((function(e){var t=e.code;e.data,200===t&&Y(!0)})).finally((function(){B(!1)}))):Y()},loading:N,children:L?s.ZP.get("强制删除"):s.ZP.get("知道了")})],children:(0,m.jsx)("div",{className:"log-container",children:O?(0,m.jsx)(h.Z,{}):(0,m.jsx)("pre",{style:I?{fontFamily:"Source Code Pro",zoom:.83}:{},children:(0,m.jsx)(g(),{children:y})})})})}},53261:function(e,t,n){n.r(t);var i=n(25359),a=n.n(i),s=n(57213),c=n.n(s),r=n(49811),o=n.n(r),l=n(54306),u=n.n(l),d=n(88265),f=n(63313),h=n(28756),p=n(67393),g=n(84163),v=n(84468),x=n(22159),m=n(57229),Z=n(15207),y=n(11527),j=h.Z.Option,k=function(e){return e[e.nodejs=0]="nodejs",e[e.python3=1]="python3",e[e.linux=2]="linux",e}(k||{});t.default=function(e){var t=e.dependence,n=e.handleCancel,i=e.visible,s=e.defaultType,r=p.Z.useForm(),l=u()(r,1)[0],P=(0,f.useState)(!1),b=u()(P,2),S=b[0],w=b[1],C=function(){var e=o()(a()().mark((function e(i){var s,r,o,l,u,d,f,h,p,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),s=i.name,r=i.split,o=i.type,l=i.remark,u=t?"put":"post",t?d=c()(c()({},i),{},{id:t.id}):"1"===r?(f=s.includes("&")?"&":"\n",d=s.split(f).map((function(e){return{name:e,type:o,remark:l}}))):d=[{name:s,type:o,remark:l}],e.prev=4,e.next=7,m.W[u]("".concat(Z.Z.apiPrefix,"dependencies"),d);case 7:h=e.sent,p=h.code,g=h.data,200===p&&n(g),w(!1),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),w(!1);case 17:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}();return(0,f.useEffect)((function(){l.resetFields()}),[t,i]),(0,y.jsx)(g.Z,{title:t?d.ZP.get("编辑依赖"):d.ZP.get("创建依赖"),open:i,forceRender:!0,centered:!0,maskClosable:!1,onOk:function(){l.validateFields().then((function(e){C(e)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){return n()},confirmLoading:S,children:(0,y.jsxs)(p.Z,{form:l,layout:"vertical",name:"dependence_modal",initialValues:t,children:[(0,y.jsx)(p.Z.Item,{name:"type",label:d.ZP.get("依赖类型"),initialValue:k[s],children:(0,y.jsx)(h.Z,{children:Z.Z.dependenceTypes.map((function(e,t){return(0,y.jsx)(j,{value:t,children:e},t)}))})}),!t&&(0,y.jsx)(p.Z.Item,{name:"split",label:d.ZP.get("自动拆分"),initialValue:"0",tooltip:d.ZP.get("多个依赖是否换行分割"),children:(0,y.jsxs)(v.ZP.Group,{children:[(0,y.jsx)(v.ZP,{value:"1",children:d.ZP.get("是")}),(0,y.jsx)(v.ZP,{value:"0",children:d.ZP.get("否")})]})}),(0,y.jsx)(p.Z.Item,{name:"name",label:d.ZP.get("名称"),rules:[{required:!0,message:d.ZP.get("请输入依赖名称，支持指定版本"),whitespace:!0}],children:(0,y.jsx)(x.Z.TextArea,{rows:4,autoSize:{minRows:1,maxRows:5},placeholder:d.ZP.get("请输入依赖名称")})}),(0,y.jsx)(p.Z.Item,{name:"remark",label:d.ZP.get("备注"),children:(0,y.jsx)(x.Z,{placeholder:d.ZP.get("请输入备注")})})]})})}},57190:function(e,t,n){n.r(t),n.d(t,{DependenceStatus:function(){return i},Status:function(){return a}});var i=function(e){return e[e.installing=0]="installing",e[e.installed=1]="installed",e[e.installFailed=2]="installFailed",e[e.removing=3]="removing",e[e.removed=4]="removed",e[e.removeFailed=5]="removeFailed",e[e.queued=6]="queued",e[e.cancelled=7]="cancelled",e}({}),a=function(e){return e[e["安装中"]=0]="安装中",e[e["已安装"]=1]="已安装",e[e["安装失败"]=2]="安装失败",e[e["删除中"]=3]="删除中",e[e["已删除"]=4]="已删除",e[e["删除失败"]=5]="删除失败",e[e["队列中"]=6]="队列中",e[e["已取消"]=7]="已取消",e}({})},21758:function(e,t,n){var i=n(93525),a=n.n(i),s=n(12342),c=n.n(s),r=n(25359),o=n.n(r),l=n(49811),u=n.n(l),d=n(21140),f=n.n(d),h=n(63466),p=n.n(h),g=n(52510),v=n.n(g),x=n(78078),m=n.n(x),Z=["type"],y=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f()(this,e),v()(this,"url",void 0),v()(this,"socket",null),v()(this,"subscriptions",new Map),v()(this,"options",void 0),v()(this,"reconnectAttempts",0),v()(this,"heartbeatTimeout",null),v()(this,"state","closed"),this.url=t,this.options={maxReconnectAttempts:n.maxReconnectAttempts||5,reconnectInterval:n.reconnectInterval||3e3,heartbeatInterval:n.heartbeatInterval||3e4},this.init()}var t,n;return p()(e,[{key:"init",value:(n=u()(o()().mark((function e(){var t=this;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.state="connecting",this.emit("connecting");case 3:if(!(this.reconnectAttempts<this.options.maxReconnectAttempts)){e.next=16;break}return this.socket=new(m())(this.url),this.setupEventListeners(),this.startHeartbeat(),e.next=9,this.waitForClose();case 9:return this.stopHeartbeat(),this.socket=null,this.reconnectAttempts++,e.next=14,new Promise((function(e){return setTimeout(e,t.options.reconnectInterval)}));case 14:e.next=3;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.handleError(e.t0);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(){return n.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var e=this;this.socket&&(this.socket.onopen=function(){e.state="open",e.emit("open")},this.socket.onmessage=function(t){var n=JSON.parse(t.data);e.dispatchMessage(n)},this.socket.onclose=function(){e.state="closed",e.emit("close")})}},{key:"waitForClose",value:(t=u()(o()().mark((function e(){var t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=this.socket)||void 0===t?void 0:t.readyState)===m().CLOSED){e.next=5;break}return e.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"subscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(!n.has(t)){n.add(t),this.subscriptions.set(e,n);var i={action:"subscribe",topic:e};this.send(i)}}},{key:"unsubscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(n.has(t)){n.delete(t);var i={action:"unsubscribe",topic:e};this.send(i)}}},{key:"send",value:function(e){var t;(null===(t=this.socket)||void 0===t?void 0:t.readyState)===m().OPEN&&this.socket.send(JSON.stringify(e))}},{key:"dispatchMessage",value:function(e){var t=e.type,n=c()(e,Z),i=this.subscriptions.get(t)||new Set;a()(i).forEach((function(e){return e(n)}))}},{key:"startHeartbeat",value:function(){var e=this;this.heartbeatTimeout=setInterval((function(){var t;(null===(t=e.socket)||void 0===t?void 0:t.readyState)===m().OPEN&&e.socket.send(JSON.stringify({type:"heartbeat"}))}),this.options.heartbeatInterval)}},{key:"stopHeartbeat",value:function(){this.heartbeatTimeout&&clearInterval(this.heartbeatTimeout)}},{key:"close",value:function(){this.socket&&(this.state="closed",this.stopHeartbeat(),this.socket.close(),this.emit("close"))}},{key:"handleError",value:function(e){console.error("WebSocket错误:",e),this.emit("error",e)}},{key:"on",value:function(e,t){}},{key:"emit",value:function(e,t){}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return e.instance||(e.instance=new e(t,n)),e.instance}}]),e}();v()(y,"instance",null),t.Z=y}}]);