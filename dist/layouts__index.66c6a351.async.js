"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1717],{44224:function(e,t,n){var i=(0,n(19919).Z)({scriptUrl:["//at.alicdn.com/t/c/font_3354854_lc939gab1iq.js"]});t.Z=i},84903:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var i=n(26068),a=n.n(i),o=n(48305),s=n.n(o),r=n(3475),c=n(9364),u=n(16314),l=n(81379),d=n(1371),h=n(5323),p=n(41206),f=n(34014),m=n(99192),g=n(98783),v=n(71571),x=n(65823),k=n(59816),b=n(87893),y=n(85950),Z=n(70892),j=n(75271),w=n(72317),P=n(86563),S=n.n(P),I=n(76991),E=n(44224),L=n(52676),C={route:{routes:[{name:w.ZP.get("登录"),path:"/login",hideInMenu:!0,component:"@/pages/login/index"},{name:w.ZP.get("初始化"),path:"/initialization",hideInMenu:!0,component:"@/pages/initialization/index"},{name:w.ZP.get("错误"),path:"/error",hideInMenu:!0,component:"@/pages/error/index"},{path:"/crontab",name:w.ZP.get("定时任务"),icon:(0,L.jsx)(E.Z,{type:"ql-icon-crontab"}),component:"@/pages/crontab/index"},{path:"/subscription",name:w.ZP.get("订阅管理"),icon:(0,L.jsx)(E.Z,{type:"ql-icon-subs"}),component:"@/pages/subscription/index"},{path:"/env",name:w.ZP.get("环境变量"),icon:(0,L.jsx)(E.Z,{type:"ql-icon-env"}),component:"@/pages/env/index"},{path:"/config",name:w.ZP.get("配置文件"),icon:(0,L.jsx)(E.Z,{type:"ql-icon-config"}),component:"@/pages/config/index"},{path:"/script",name:w.ZP.get("脚本管理"),icon:(0,L.jsx)(E.Z,{type:"ql-icon-script"}),component:"@/pages/script/index"},{path:"/dependence",name:w.ZP.get("依赖管理"),icon:(0,L.jsx)(E.Z,{type:"ql-icon-dependence"}),component:"@/pages/dependence/index"},{path:"/log",name:w.ZP.get("日志管理"),icon:(0,L.jsx)(E.Z,{type:"ql-icon-log"}),component:"@/pages/log/index"},{path:"/diff",name:w.ZP.get("对比工具"),icon:(0,L.jsx)(E.Z,{type:"ql-icon-diff"}),component:"@/pages/diff/index"},{path:"/setting",name:w.ZP.get("系统设置"),icon:(0,L.jsx)(I.Z,{}),component:"@/pages/password/index"}]},navTheme:"light",fixSiderbar:!0,contentWidth:"Fixed",splitMenus:!1,siderWidth:180},q=n(83383);var z=n(65814);function A(){var e=(0,g.useLocation)(),t=(0,c.e)(),n=(0,c.F)(),i=n.theme,o=n.reloadTheme,P=(0,j.useState)({}),I=s()(P,2),E=I[0],A=I[1],M=(0,j.useState)(!0),T=s()(M,2),N=T[0],_=T[1],O=(0,j.useState)(),F=s()(O,2),R=F[0],W=F[1],H=(0,j.useState)(!1),U=s()(H,2),D=U[0],J=U[1],K=(0,j.useState)(!0),B=s()(K,2),Q=B[0],G=B[1],V=v||{},X=V.enable,Y=V.disable,$=(V.exportGeneratedCSS,V.setFetchMethod),ee=V.auto,te=function(){u.W.get("".concat(r.Z.apiPrefix,"system")).then((function(e){var t=e.code,n=e.data;200===t&&(W(n),n.isInitialized?(n.version,q._m.config({paths:{vs:"".concat(r.Z.baseUrl,"monaco-editor/min/vs")},"vs/nls":{availableLanguages:{"*":"zh-cn"}}}),ne()):g.history.push("/initialization"))})).catch((function(e){console.log(e)}))},ne=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&_(!0),u.W.get("".concat(r.Z.apiPrefix,"user")).then((function(n){var i=n.code,a=n.data;200===i&&a.username&&(A(a),"/"===e.pathname&&g.history.push("/crontab")),t&&_(!1)})).catch((function(e){console.log(e)}))},ie=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];ne(e)};if((0,j.useEffect)((function(){R&&R.isInitialized&&!E&&ne()}),[e.pathname]),(0,j.useEffect)((function(){u.W.get("".concat(r.Z.apiPrefix,"public/health")).then((function(e){var t;1===(null==e||null===(t=e.data)||void 0===t?void 0:t.status)?te():g.history.push("/error")})).catch((function(e){g.history.push("/error")})).finally((function(){return G(!1)}))}),[]),(0,j.useEffect)((function(){"vs-dark"===i?document.body.setAttribute("data-dark","true"):document.body.setAttribute("data-dark","false")}),[i]),(0,j.useEffect)((function(){S()();var e=localStorage.getItem("qinglong_dark_theme")||"auto";if("undefined"!=typeof window&&void 0!==window.matchMedia)return v?($(fetch),"dark"===e?X({}):"light"===e?Y():ee({}),function(){Y()}):function(){return null}}),[]),(0,j.useEffect)((function(){if(E&&E.username){var e=z.Z.getInstance("".concat(window.location.origin).concat(r.Z.apiPrefix,"ws?token=").concat(localStorage.getItem(r.Z.authKey)));return function(){e.close()}}}),[E]),(0,j.useEffect)((function(){window.onload=function(){var e=performance.timing;console.log("白屏时间: ".concat(e.responseStart-e.navigationStart)),console.log("请求完毕至DOM加载: ".concat(e.domInteractive-e.responseEnd)),console.log("解释dom树耗时: ".concat(e.domComplete-e.domInteractive)),console.log("从开始至load总耗时: ".concat(e.loadEventEnd-e.navigationStart))}}),[]),Q)return(0,L.jsx)(f.Z,{});if(["/login","/initialization","/error"].includes(e.pathname)&&(null!=R&&R.isInitialized&&"/initialization"===e.pathname&&g.history.push("/crontab"),R||"/error"===e.pathname))return(0,L.jsx)(g.Outlet,{context:a()(a()({},t),{},{theme:i,user:E,reloadUser:ie,reloadTheme:o})});var ae=navigator.userAgent.includes("Firefox"),oe=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),se=navigator.userAgent.includes("QQBrowser"),re={items:[{label:w.ZP.get("退出登录"),className:"side-menu-user-drop-menu",onClick:function(){u.W.post("".concat(r.Z.apiPrefix,"user/logout")).then((function(){localStorage.removeItem(r.Z.authKey),g.history.push("/login")}))},key:"logout",icon:(0,L.jsx)(l.Z,{})}]};return N?(0,L.jsx)(f.Z,{}):(0,L.jsx)(m.ZP,a()(a()({selectedKeys:[e.pathname],loading:N,logo:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(x.Z,{preview:!1,src:"https://qn.whyour.cn/logo.png"}),(0,L.jsxs)("div",{className:"title",children:[(0,L.jsx)("span",{className:"title",children:w.ZP.get("青龙")}),(0,L.jsx)("span",{onClick:function(e){e.stopPropagation(),window.open(null==R?void 0:R.changeLogLink,"_blank")},children:(0,L.jsx)(k.Z,{title:"develop"===(null==R?void 0:R.branch)?w.ZP.get("开发版"):w.ZP.get("正式版"),children:(0,L.jsx)(b.Z,{size:"small",dot:"develop"===(null==R?void 0:R.branch),children:(0,L.jsxs)("span",{style:{fontSize:ae?9:12,color:"#666",marginLeft:2,zoom:oe?.66:.8,letterSpacing:se?-2:0},children:["v",null==R?void 0:R.version]})})})})]})]}),title:!1,menuItemRender:function(t,n){return t.isUrl||!t.path||e.pathname===t.path?n:(0,L.jsx)(g.Link,{to:t.path,children:n})},pageTitleRender:function(t,n,i){var a=r.Z.documentTitleMap[e.pathname]||w.ZP.get("未找到");return"".concat(a," - ").concat(w.ZP.get("青龙"))},onCollapse:J,collapsed:D,rightContentRender:function(){return t.isPhone&&(0,L.jsx)(y.Z,{menu:re,placement:"bottomRight",trigger:["click"],children:(0,L.jsxs)("span",{className:"side-menu-user-wrapper",children:[(0,L.jsx)(Z.C,{shape:"square",size:"small",icon:(0,L.jsx)(d.Z,{}),src:E.avatar?"".concat(r.Z.apiPrefix,"static/").concat(E.avatar):""}),(0,L.jsx)("span",{style:{marginLeft:5},children:E.username})]})})},collapsedButtonRender:function(e){return(0,L.jsxs)("span",{className:"side-menu-container",onClick:function(e){e.preventDefault(),e.stopPropagation()},children:[!e&&!t.isPhone&&(0,L.jsx)(y.Z,{menu:re,placement:"topLeft",trigger:["hover"],children:(0,L.jsxs)("span",{className:"side-menu-user-wrapper",children:[(0,L.jsx)(Z.C,{shape:"square",size:"small",icon:(0,L.jsx)(d.Z,{}),src:E.avatar?"".concat(r.Z.apiPrefix,"static/").concat(E.avatar):""}),(0,L.jsx)("span",{style:{marginLeft:5},children:E.username})]})}),(0,L.jsx)("span",{className:"side-menu-collapse-button",onClick:function(){return J(!e)},children:e?(0,L.jsx)(h.Z,{}):(0,L.jsx)(p.Z,{})})]})}},C),{},{children:(0,L.jsx)(g.Outlet,{context:a()(a()({},t),{},{theme:i,user:E,reloadUser:ie,reloadTheme:o,systemInfo:R})})}))}},9364:function(e,t,n){n.d(t,{F:function(){return c},e:function(){return r}});var i=n(48305),a=n.n(i),o=n(75271),s=n(52076),r=function(){var e=(0,o.useState)("100%"),t=a()(e,2),n=t[0],i=t[1],r=(0,o.useState)(0),c=a()(r,2),u=c[0],l=c[1],d=(0,o.useState)(-48),h=a()(d,2),p=h[0],f=h[1],m=(0,o.useState)(!1),g=a()(m,2),v=g[0],x=g[1],k=(0,o.useMemo)((function(){return(0,s.ZP)()}),[]).platform;return(0,o.useEffect)((function(){"mobile"===k&&document.body.offsetWidth<768?(i("auto"),l(0),f(0),x(!0),document.body.setAttribute("data-mode","phone")):(i("100%"),l(0),f(-48),x(!1),document.body.setAttribute("data-mode","desktop"))}),[]),{headerStyle:{padding:"4px 16px 4px 15px",position:"sticky",top:0,left:0,zIndex:20,marginTop:p,width:n,marginLeft:u},isPhone:v}},c=function(){var e=(0,o.useState)(),t=a()(e,2),n=t[0],i=t[1];return(0,o.useEffect)((function(){var e=window.matchMedia("(prefers-color-scheme: dark)"),t=localStorage.getItem("qinglong_dark_theme"),n=e.matches&&"light"!==t||"dark"===t;i(n?"vs-dark":"vs");var a=function(e){"auto"!==t&&t||(e.matches?i("vs-dark"):i("vs"))};"function"==typeof e.addEventListener?e.addEventListener("change",a):"function"==typeof e.addListener&&e.addListener(a)}),[]),{theme:n,reloadTheme:function(){var e=window.matchMedia("(prefers-color-scheme: dark)"),t=localStorage.getItem("qinglong_dark_theme"),n=e.matches&&"light"!==t||"dark"===t;i(n?"vs-dark":"vs")}}}},65814:function(e,t,n){var i=n(15558),a=n.n(i),o=n(67825),s=n.n(o),r=n(90228),c=n.n(r),u=n(87999),l=n.n(u),d=n(25298),h=n.n(d),p=n(17069),f=n.n(p),m=n(82092),g=n.n(m),v=n(78078),x=n.n(v),k=["type"],b=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h()(this,e),g()(this,"url",void 0),g()(this,"socket",null),g()(this,"subscriptions",new Map),g()(this,"options",void 0),g()(this,"reconnectAttempts",0),g()(this,"heartbeatTimeout",null),g()(this,"state","closed"),this.url=t,this.options={maxReconnectAttempts:n.maxReconnectAttempts||5,reconnectInterval:n.reconnectInterval||3e3,heartbeatInterval:n.heartbeatInterval||3e4},this.init()}var t,n;return f()(e,[{key:"init",value:(n=l()(c()().mark((function e(){var t=this;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.state="connecting",this.emit("connecting");case 3:if(!(this.reconnectAttempts<this.options.maxReconnectAttempts)){e.next=16;break}return this.socket=new(x())(this.url),this.setupEventListeners(),this.startHeartbeat(),e.next=9,this.waitForClose();case 9:return this.stopHeartbeat(),this.socket=null,this.reconnectAttempts++,e.next=14,new Promise((function(e){return setTimeout(e,t.options.reconnectInterval)}));case 14:e.next=3;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.handleError(e.t0);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(){return n.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var e=this;this.socket&&(this.socket.onopen=function(){e.state="open",e.emit("open")},this.socket.onmessage=function(t){var n=JSON.parse(t.data);e.dispatchMessage(n)},this.socket.onclose=function(){e.state="closed",e.emit("close")})}},{key:"waitForClose",value:(t=l()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=this.socket)||void 0===t?void 0:t.readyState)===x().CLOSED){e.next=5;break}return e.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"subscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(!n.has(t)){n.add(t),this.subscriptions.set(e,n);var i={action:"subscribe",topic:e};this.send(i)}}},{key:"unsubscribe",value:function(e,t){var n=this.subscriptions.get(e)||new Set;if(n.has(t)){n.delete(t);var i={action:"unsubscribe",topic:e};this.send(i)}}},{key:"send",value:function(e){var t;(null===(t=this.socket)||void 0===t?void 0:t.readyState)===x().OPEN&&this.socket.send(JSON.stringify(e))}},{key:"dispatchMessage",value:function(e){var t=e.type,n=s()(e,k),i=this.subscriptions.get(t)||new Set;a()(i).forEach((function(e){return e(n)}))}},{key:"startHeartbeat",value:function(){var e=this;this.heartbeatTimeout=setInterval((function(){var t;(null===(t=e.socket)||void 0===t?void 0:t.readyState)===x().OPEN&&e.socket.send(JSON.stringify({type:"heartbeat"}))}),this.options.heartbeatInterval)}},{key:"stopHeartbeat",value:function(){this.heartbeatTimeout&&clearInterval(this.heartbeatTimeout)}},{key:"close",value:function(){this.socket&&(this.state="closed",this.stopHeartbeat(),this.socket.close(),this.emit("close"))}},{key:"handleError",value:function(e){console.error("WebSocket错误:",e),this.emit("error",e)}},{key:"on",value:function(e,t){}},{key:"emit",value:function(e,t){}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return e.instance||(e.instance=new e(t,n)),e.instance}}]),e}();g()(b,"instance",null),t.Z=b}}]);